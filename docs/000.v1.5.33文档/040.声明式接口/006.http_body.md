---
id: http_body
title: ğŸ‘” è¯·æ±‚ä½“
date: 2022-07-01 12:44:20
permalink: /pages/1.5.33/http_body/
---


åœ¨`POST`å’Œ`PUT`ç­‰è¯·æ±‚æ–¹æ³•ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ HTTP è¯·æ±‚ä½“è¿›è¡Œä¼ è¾“æ•°æ®ã€‚åœ¨ Forest ä¸­æœ‰å¤šç§æ–¹å¼è®¾ç½®è¯·æ±‚ä½“æ•°æ®ã€‚

## @Body æ³¨è§£

æ‚¨å¯ä»¥ä½¿ç”¨`@Body`æ³¨è§£ä¿®é¥°å‚æ•°çš„æ–¹å¼ï¼Œå°†ä¼ å…¥å‚æ•°çš„æ•°æ®ç»‘å®šåˆ° HTTP è¯·æ±‚ä½“ä¸­ã€‚

`@Body`æ³¨è§£ä¿®é¥°çš„å‚æ•°ä¸€å®šä¼šç»‘å®šåˆ°è¯·æ±‚ä½“ä¸­ï¼Œä¸ç”¨æ‹…å¿ƒå®ƒä¼šå‡ºç°åœ¨å…¶ä»–åœ°æ–¹

```java
/**
 * é»˜è®¤bodyæ ¼å¼ä¸º application/x-www-form-urlencodedï¼Œå³ä»¥è¡¨å•å½¢å¼åºåˆ—åŒ–æ•°æ®
 */
@Post("http://localhost:8080/user")
String sendPost(@Body("username") String username,  @Body("password") String password);
```


## è¡¨å•æ ¼å¼

ä¸Šé¢ä½¿ç”¨ @Body æ³¨è§£çš„ä¾‹å­ç”¨çš„æ˜¯æ™®é€šçš„è¡¨å•æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯`contentType`å±æ€§ä¸º`application/x-www-form-urlencoded`çš„æ ¼å¼ï¼Œå³`contentType`ä¸åšé…ç½®æ—¶çš„é»˜è®¤å€¼ã€‚

è¡¨å•æ ¼å¼çš„è¯·æ±‚ä½“ä»¥å­—ç¬¦ä¸² `key1=value1&key2=value2&...&key{n}=value{n}` çš„å½¢å¼è¿›è¡Œä¼ è¾“æ•°æ®ï¼Œå…¶ä¸­`value`éƒ½æ˜¯å·²ç»è¿‡ URL Encode ç¼–ç è¿‡çš„å­—ç¬¦ä¸²ã€‚


```java{9}
/**
 * contentTypeå±æ€§è®¾ç½®ä¸º application/x-www-form-urlencoded å³ä¸ºè¡¨å•æ ¼å¼ï¼Œ
 * å½“ç„¶ä¸è®¾ç½®çš„æ—¶å€™é»˜è®¤å€¼ä¹Ÿä¸º application/x-www-form-urlencodedï¼Œ ä¹ŸåŒæ ·æ˜¯è¡¨å•æ ¼å¼ã€‚
 * åœ¨ @Body æ³¨è§£çš„ value å±æ€§ä¸­è®¾ç½®çš„åç§°ä¸ºè¡¨å•é¡¹çš„ key åï¼Œ
 * è€Œæ³¨è§£æ‰€ä¿®é¥°çš„å‚æ•°å€¼å³ä¸ºè¡¨å•é¡¹çš„å€¼ï¼Œå®ƒå¯ä»¥ä¸ºä»»ä½•ç±»å‹ï¼Œä¸è¿‡æœ€ç»ˆéƒ½ä¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œä¼ è¾“ã€‚
 */
@Post(
    url = "http://localhost:8080/user",
    contentType = "application/x-www-form-urlencoded"
)
String sendPost(@Body("key1") String value1,  @Body("key2") Integer value2, @Body("key3") Long value3);
```

è°ƒç”¨åäº§ç”Ÿçš„ç»“æœå¯èƒ½å¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/x-www-form-urlencoded
    BODY:
        key1=xxx&key2=1000&key3=9999



å½“`@Body`æ³¨è§£ä¿®é¥°çš„å‚æ•°ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æ³¨è§£çš„`value`å±æ€§ä¸è®¾ç½®ä»»ä½•åç§°çš„æ—¶å€™ï¼Œä¼šå°†æ³¨è§£æ‰€ä¿®é¥°å‚æ•°å€¼å¯¹è±¡è§†ä¸ºä¸€æ•´ä¸ªè¡¨å•ï¼Œå…¶å¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§å°†æŒ‰ `å±æ€§å1=å±æ€§å€¼1&å±æ€§å2=å±æ€§å€¼2&...&å±æ€§å{n}=å±æ€§å€¼{n}` çš„å½¢å¼é€šè¿‡è¯·æ±‚ä½“è¿›è¡Œä¼ è¾“æ•°æ®ã€‚

```java
/**
 * contentType å±æ€§ä¸è®¾ç½®é»˜è®¤ä¸º application/x-www-form-urlencoded
 * è¦ä»¥å¯¹è±¡ä½œä¸ºè¡¨è¾¾ä¼ è¾“é¡¹æ—¶ï¼Œå…¶ @Body æ³¨è§£çš„ value åç§°ä¸èƒ½è®¾ç½®
 */
@Post("http://localhost:8080/hello/user")
String send(@Body User user);
```

è°ƒç”¨åäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/x-www-form-urlencoded
    BODY:
        username=foo&password=bar

## JSONæ ¼å¼

### @JSONBodyæ³¨è§£ä¿®é¥°å¯¹è±¡

å‘é€JSONéå¸¸ç®€å•ï¼Œåªè¦ç”¨`@JSONBody`æ³¨è§£ä¿®é¥°ç›¸å…³å‚æ•°å°±å¯ä»¥äº†ï¼Œè¯¥æ³¨è§£è‡ª`1.5.0-RC1`ç‰ˆæœ¬èµ·å¯ä»¥ä½¿ç”¨ã€‚
ä½¿ç”¨@JSONBodyæ³¨è§£çš„åŒæ—¶å°±å¯ä»¥çœç•¥ contentType = "application/json"å±æ€§è®¾ç½®ã€‚


```java
/**
 * è¢«@JSONBodyæ³¨è§£ä¿®é¥°çš„å‚æ•°ä¼šæ ¹æ®å…¶ç±»å‹è¢«è‡ªå®šè§£æä¸ºJSONå­—ç¬¦ä¸²
 * ä½¿ç”¨@JSONBodyæ³¨è§£æ—¶å¯ä»¥çœç•¥ contentType = "application/json"å±æ€§è®¾ç½®
 */
@Post("http://localhost:8080/hello/user")
String helloUser(@JSONBody User user);

```

è°ƒç”¨åäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        {"username": "foo", "password": "bar"}


### @JSONBodyæ³¨è§£ä¿®é¥°é”®å€¼å¯¹

@JSONBodyæ³¨è§£å¯ä»¥æŒ‰é”®å€¼å¯¹æ‹†åˆ†æˆå¤šä¸ªå‚æ•°è¿›è¡Œä¼ å…¥ï¼Œåœ¨å‘é€çš„æ—¶å€™å†åˆæˆä¸€ä¸ªå®Œæˆçš„JSONå­—ç¬¦ä¸²ï¼š

```java

/**
 * æŒ‰é”®å€¼å¯¹åˆ†åˆ«ä¿®é¥°ä¸åŒçš„å‚æ•°
 * è¿™æ—¶æ¯ä¸ªå‚æ•°å‰çš„ @JSONBody æ³¨è§£å¿…é¡»å¡«ä¸Š value å±æ€§æˆ– name å±æ€§çš„å€¼ï¼Œä½œä¸ºJSONçš„å­—æ®µåç§°
 */
@Post("http://localhost:8080/hello/user")
String helloUser(@JSONBody("username") String username, @JSONBody("password") String password);
```

å¦‚è°ƒç”¨`helloUser("foo", "bar");`ä¼šäº§ç”Ÿå¦‚ä¸‹ç»“æœï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        {"username": "foo", "password": "bar"}


### @JSONBodyæ³¨è§£ä¿®é¥°é›†åˆå¯¹è±¡

@JSONBodyæ³¨è§£ä¹Ÿæ”¯æŒMapã€Listç­‰é›†åˆç±»å‹å‚æ•°

```java
/**
 * è¢«@JSONBodyæ³¨è§£ä¿®é¥°çš„Mapç±»å‹å‚æ•°ä¼šè¢«è‡ªå®šè§£æä¸ºJSONå­—ç¬¦ä¸²
 */
@Post(url = "http://localhost:8080/hello/user")
String helloUser(@JSONBody Map<String, Object> user);
```

è‹¥è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š

```java
Map<String, Object> map = new HashMap<>();
map.put("name", "foo");
map.put("password", "bar");
client.helloUser(map);
```

ä¼šäº§ç”Ÿå¦‚ä¸‹ç»“æœï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        {"username": "foo", "password": "bar"}


Listç­‰åˆ—è¡¨å¯¹è±¡ä¹ŸåŒç†ï¼š

```java
/**
 * è¢«@JSONBodyæ³¨è§£ä¿®é¥°çš„Listç±»å‹å‚æ•°ä¼šè¢«è‡ªå®šè§£æä¸ºJSONå­—ç¬¦ä¸²
 */
@Post(url = "http://localhost:8080/hello/user-names")
String helloUserNames(@JSONBody List<String> usernames);
```

è‹¥è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š

```java
List<String> names = Lists.newArrayList("A", "B", "C");
client.helloUserNames(names);
```

ä¼šäº§ç”Ÿå¦‚ä¸‹ç»“æœï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        ["A", "B", "C"]


### @JSONBodyæ³¨è§£ä¿®é¥°å­—ç¬¦ä¸²

@JSONBodyæ³¨è§£è¿˜æ”¯æŒå­—ç¬¦ä¸²ç±»å‹å‚æ•°ï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªJSONå­—ç¬¦ä¸²è¿›è¡Œä¼ è¾“

```java
/**
 * ç›´æ¥ä¿®é¥°ä¸€ä¸ªJSONå­—ç¬¦ä¸²
 */
@Post("http://localhost:8080/hello/user")
String helloUser(@JSONBody String userJson);
```

### @Bodyæ³¨è§£ + contentType

é™¤äº†`@JSONBody`æ³¨è§£ï¼Œä½¿ç”¨`@Body`æ³¨è§£ä¹Ÿå¯ä»¥ï¼Œåªè¦å°†`contentType`å±æ€§æˆ–`Content-Type`è¯·æ±‚å¤´æŒ‡å®šä¸º`application/json`ä¾¿å¯ã€‚

```java{3}
@Post(
    url = "http://localhost:8080/hello/user",
    contentType = "application/json"
)
String send(@Body User user);
```
è°ƒç”¨åäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        {"username": "foo", "password": "bar"}


## XMLæ ¼å¼

### @XMLBodyæ³¨è§£ä¿®é¥°å¯¹è±¡

å‘é€XMLä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦ç”¨`@XMLBody`æ³¨è§£ä¿®é¥°ç›¸å…³å‚æ•°å°±å¯ä»¥äº†ï¼Œè¯¥æ³¨è§£è‡ª`1.5.0-RC1`ç‰ˆæœ¬èµ·å¯ä»¥ä½¿ç”¨ã€‚

```java
/**
 * è¢«@JSONBodyæ³¨è§£ä¿®é¥°çš„å‚æ•°ä¼šæ ¹æ®å…¶ç±»å‹è¢«è‡ªå®šè§£æä¸ºXMLå­—ç¬¦ä¸²
 * å…¶ä¿®é¥°çš„å‚æ•°ç±»å‹å¿…é¡»æ”¯æŒJAXBï¼Œå¯ä»¥ä½¿ç”¨JAXBçš„æ³¨è§£è¿›è¡Œä¿®é¥°
 * ä½¿ç”¨@XMLBodyæ³¨è§£æ—¶å¯ä»¥çœç•¥ contentType = "application/xml"å±æ€§è®¾ç½®
 */
@Post("http://localhost:8080/hello/user")
String sendXmlMessage(@XMLBody User user);

```

è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„`User`å¯¹è±¡è¦ç»‘å®š`JAXB`æ³¨è§£ï¼š

```java
@XmlRootElement(name = "misc")
public class User {

    private String usrname;

    private String password;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}
```

è°ƒç”¨ä¼ å…¥`User`å¯¹è±¡åçš„ç»“æœå¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/xml
    BODY:
        <misc><username>foo</username><password>bar</password></misc>


### @XMLBodyæ³¨è§£ä¿®é¥°å­—ç¬¦ä¸²

@XMLBodyæ”¯æŒçš„å¦ä¸€ç§å½¢å¼å°±æ˜¯ç›´æ¥ä¼ å…¥ä¸€ä¸ªXMLå­—ç¬¦ä¸²

```java
/**
 * @XMLBodyæ³¨è§£å¯ä»¥ä¿®é¥°ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œä½œä¸ºè¦ä¼ è¾“çš„XMLå­—ç¬¦ä¸²
 */
@Post("http://localhost:8080/hello/user")
String sendXmlMessage(@XMLBody String userXml);
```

## Protobufæ ¼å¼

åœ¨ä½¿ç”¨ Protobuf ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æœ‰å¼•å…¥ google çš„ protobuf åŒ…ä¾èµ–ï¼Œ å¦‚ä½•åŠ ç›¸å…³ä¾èµ–è¯·å‚è§ã€Š[æ·»åŠ Protobufæ¡†æ¶ä¾èµ–](/pages/1.5.33/spring_boot_install/#protobufæ¡†æ¶ä¾èµ–)ã€‹

å‡è®¾ï¼Œæ‚¨å·²ç»æœ‰äº† protobuf çš„ç›¸å…³ä¾èµ–åŒ…ï¼Œè€Œä¸”ä¹Ÿæœ‰äº† protobuf ç”Ÿæˆçš„æ•°æ®ç±»ï¼Œå¦‚ ProtobufProto.MyData

å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ `@ProtobufBody` æ³¨è§£ä¿®é¥° protobuf ç”Ÿæˆçš„æ•°æ®ç±»ä¸ºç±»å‹çš„å‚æ•°

```java
@Post("/proto/data")
ProtobufProto.MyData protobufTest2(@ProtobufBody ProtobufProto.MyData myData);

// è°ƒç”¨æ”¹æ–¹æ³•ï¼Œä¼šå°† myData æ•°æ®å¯¹è±¡è‡ªåŠ¨è½¬æ¢ä¸º Protobuf æ ¼å¼å­—èŠ‚æµ
// å¹¶å‘é€åˆ°æœåŠ¡ç«¯
// @ProtobufBody åœ¨é»˜è®¤è¯·æƒ…å†µä¸‹ä¼šå°† Content-Type è®¾ä¸º
// application/x-protobuf
```

è‹¥è¦ä¸æƒ³ä½¿ `Content-Type` ä¸º `application/x-protobuf`, å¯ä»¥è‡ªè¡Œè®¾ç½®

```java
@Post(url = "/proto/data", contentType = "application/octet-stream")
ProtobufProto.MyData protobufTest2(@ProtobufBody ProtobufProto.MyData myData);

// è°ƒç”¨æ”¹æ–¹æ³•ï¼Œä¼šå°† myData æ•°æ®å¯¹è±¡è‡ªåŠ¨è½¬æ¢ä¸º Protobuf æ ¼å¼å­—èŠ‚æµ
// å¹¶å‘é€åˆ°æœåŠ¡ç«¯
// ä¸”æ­¤æ—¶ Content-Type ä¸º
// application/octet-stream
```

## äºŒè¿›åˆ¶æ ¼å¼

å¯¹äº`application/otect-stream`ç­‰äºŒè¿›åˆ¶å½¢å¼çš„Bodyæ•°æ®ï¼Œç›´æ¥ç”¨ `@Body` æ³¨è§£ä¿®é¥°å‚æ•°å³å¯ã€‚

ç°åœ¨æ”¯æŒçš„äºŒè¿›åˆ¶ Content-Type æœ‰ï¼š

- application/octect-stream
- image/* (åŒ…æ‹¬ image/png, image/jpeg ç­‰)

```java
/**
 * å‘é€Byteæ•°ç»„ç±»å‹æ•°æ®
 */
@Post(
        url = "/upload/${filename}",
        contentType = "application/octet-stream"
)
String sendByteArryr(@Body byte[] body, @Var("filename") String filename);

/**
 * å‘é€Fileç±»å‹æ•°æ®
 */
@Post(
    url = "/upload/${filename}",
    contentType = "application/octet-stream"
)
String sendFile(@Body File file, @Var("filename") String filename);

/**
 * å‘é€è¾“å…¥æµç±»å‹æ•°æ®
 */
@Post(
    url = "/upload/${filename}",
    contentType = "application/octet-stream"
)
String sendInputStream(@Body InputStream inputStream, @Var("filename") String filename);


```

:::tip æ–‡æ¡£å¯¼èˆª
å…³äºæ›´å¤šäºŒè¿›åˆ¶ä¼ è¾“ä»¥åŠæ–‡ä»¶ä¸Šä¼ å†…å®¹ï¼Œè¯·è§ã€Š[ä¸Šä¼ ä¸‹è½½](/pages/1.5.33/upload_download/)ã€‹
:::


## data å±æ€§

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡`@Request`ã€ä»¥åŠ`@Get`ã€`@Post`ç­‰è¯·æ±‚æ³¨è§£çš„`data`å±æ€§æŠŠæ•°æ®æ·»åŠ åˆ°è¯·æ±‚ä½“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åªæœ‰å½“`type`ä¸º`POST`ã€`PUT`ã€`PATCH`è¿™ç±» HTTP Method æ—¶ï¼Œ`data`å±æ€§ä¸­çš„å€¼æ‰ä¼šç»‘å®šåˆ°è¯·æ±‚ä½“ä¸­ï¼Œè€Œ`GET`è¯·æ±‚åœ¨æœ‰äº›æƒ…å†µä¼šç»‘å®šåˆ°`url`çš„å‚æ•°ä¸­ã€‚

å…·ä½“`type`å±æ€§å’Œ`data`å±æ€§æ•°æ®ç»‘å®šä½ç½®çš„å…·ä½“å…³ç³»å¦‚ä¸‹è¡¨ï¼š

| type      | `data`å±æ€§æ•°æ®ç»‘å®šä½ç½® | æ”¯æŒçš„`contentType`æˆ–`Content-Type`è¯·æ±‚å¤´ |
| --------- | ---------------------- | ----------------------------------------- |
| `GET`     | `url`å‚æ•°éƒ¨åˆ†          | åªæœ‰`application/x-www-form-urlencoded`   |
| `POST`    | è¯·æ±‚ä½“                 | ä»»ä½•`contentType`                         |
| `PUT`     | è¯·æ±‚ä½“                 | ä»»ä½•`contentType`                         |
| `PATCH`   | è¯·æ±‚ä½“                 | ä»»ä½•`contentType`                         |
| `HEAD`    | `url`å‚æ•°éƒ¨åˆ†          | åªæœ‰`application/x-www-form-urlencoded`   |
| `OPTIONS` | `url`å‚æ•°éƒ¨åˆ†          | åªæœ‰`application/x-www-form-urlencoded`   |
| `DELETE`  | `url`å‚æ•°éƒ¨åˆ†          | åªæœ‰`application/x-www-form-urlencoded`   |
| `TRACE`   | `url`å‚æ•°éƒ¨åˆ†          | åªæœ‰`application/x-www-form-urlencoded`   |

`data`å±æ€§åœ¨`POST`è¯·æ±‚ä¸­ç»‘å®šè¯·æ±‚ä½“

```java
public interface MyClient {

    @Request(
            url = "http://localhost:8080/hello/user",
            type = "post",
            data = "username=foo&password=bar",
            headers = {"Accept:text/plain"}
    )
    String dataPost();
}
```

è¯¥æ¥å£è°ƒç”¨åæ‰€å®é™…äº§ç”Ÿçš„ HTTP è¯·æ±‚å¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Accept:text/plain
    BODY:
        username=foo&password=bar

åœ¨`data`å±æ€§ä¸­è¿›è¡Œæ•°æ®ç»‘å®šï¼š

```java
public interface MyClient {

    /**
     * è¿™é‡Œ data å±æ€§ä¸­è®¾ç½®çš„å­—ç¬¦ä¸²å†…å®¹ä¼šç»‘å®šåˆ°è¯·æ±‚ä½“ä¸­
     * å…¶ä¸­ ${0} å’Œ ${1} ä¸ºå‚æ•°åºå·ç»‘å®šï¼Œä¼šå°†åºå·å¯¹åº”çš„å‚æ•°ç»‘å®šåˆ°å­—ç¬¦ä¸²ä¸­å¯¹åº”çš„ä½ç½®
     * ${0} ä¼šæ›¿æ¢ä¸º username çš„å€¼ï¼Œ${1} ä¼šæ›¿æ¢ä¸º password çš„å€¼
     */
    @Request(
            url = "http://localhost:8080/hello/user",
            type = "post",
            data = "username=${0}&password=${1}",
            headers = {"Accept:text/plain"}
    )
    String dataPost(String username, String password);
}
```

:::tip æç¤º
å…¶ä¸­${æ•°å­—}çš„è¯­æ³•ç”¨åˆ°äº†ã€Š[å‚æ•°åºå·å¼•ç”¨](/pages/1.5.31/refer_index/)ã€‹
:::

å¦‚æœè°ƒç”¨æ–¹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
myClient.dataPost("foo", "bar");
```

å®é™…äº§ç”Ÿçš„ HTTP è¯·æ±‚å¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Accept: text/plain
    BODY:
        username=foo&password=bar

æ‚¨å¯ä»¥ç›´æ¥æŠŠ JSON æ•°æ®åŠ å…¥åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå…¶ä¸­`header`è®¾ç½®ä¸º`Content-Type: application/json`

```java
public interface MyClient {

    @Request(
            url = "http://localhost:8080/hello/user",
            type = "post",
            data = "{\"username\": \"${0}\", \"password\": \"${1}\"}",
            headers = {"Content-Type: application/json"}
    )
    String postJson(String username, String password);
}
```

å¦‚æœè°ƒç”¨æ–¹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
myClient.postJson("foo", "bar");
```

å®é™…äº§ç”Ÿçš„ HTTP è¯·æ±‚å¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        {"username": "foo", "password": "bar"}

æŠŠ XML æ•°æ®åŠ å…¥åˆ°è¯·æ±‚ä½“ä¸­ï¼Œå…¶ä¸­`header`è®¾ç½®ä¸º`Content-Type: application/json`

```java
public interface MyClient {

    @Request(
            url = "http://localhost:8080/hello/user",
            type = "post",
            data = "<misc><username>${0}</username><password>${1}</password></misc>",
            headers = {"Content-Type: application/xml"}
    )
    String postXml(String username, String password);
}
```

å¦‚æœè°ƒç”¨æ–¹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
myClient.postXml("foo", "bar");
```

å®é™…äº§ç”Ÿçš„ HTTP è¯·æ±‚å¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/xml
    BODY:
        <misc><username>foo</username><password>bar</password></misc>


## è¯·æ±‚ä½“ç±»å‹

:::tip å‹æƒ…æç¤º
è¯·æ±‚ä½“ç±»å‹çš„æ¦‚å¿µåœ¨`v1.5.14`ç‰ˆæœ¬åå¼•å…¥çš„ï¼Œå¦‚æœç‰ˆæœ¬è¿‡ä½è¯·ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ 
:::

ä»¥ä¸Šä¾‹å­éƒ½æ˜¯é€šè¿‡è®¾ç½® Content-Type å¤´æ¥ç¡®å®šè¯·æ±‚ä½“çš„ç±»å‹ (ä¹Ÿæ˜¯æ¯”è¾ƒ<b>æ¨è</b>çš„æ–¹å¼)

ä½†äº‹å®ä¸Šï¼Œè¯·æ±‚ä½“çš„æœ€ç»ˆå‘é€çš„æ ¼å¼æ˜¯ç”±`Encoder`ï¼ˆç¼–ç å™¨ï¼‰å†³å®šçš„ï¼Œè€Œä¸€ä¸ªè¯·æ±‚ç”¨ä½•ç¼–ç å™¨åˆ™ä½¿ç”¨è¯·æ±‚ä½“ç±»å‹å†³å®šçš„ï¼Œè€Œä¸”è¯·æ±‚ä½“ç±»å‹åœ¨ä¸è®¾ç½®çš„æƒ…å†µä¸‹å¯ä»¥ç”±`Content-Type`æ¨å¯¼å‡ºæ¥ï¼

æœ‰ç‚¹ç»•å“ˆ~ï¼Œä½†çœ‹ä¸‹é¢å°±æ¸…æ¥šäº†

```
è¯·æ±‚ä½“æ•°æ®æ ¼å¼çš„æ¨å¯¼è¿‡ç¨‹ï¼š

Content-Type å¤´ => BodyType è¯·æ±‚ä½“ç±»å‹ => Encoder ç¼–ç å™¨ => å…·ä½“çš„è¯·æ±‚ä½“æ•°æ®æ ¼å¼
```
æ¯”å¦‚ï¼šå¦‚æœè®¾ç½®äº† Content-Type è¯·æ±‚å¤´ä¸º`application/json`ï¼Œè€Œè¯·æ±‚ä½“ç±»å‹æ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆè¯·æ±‚ä½“ç±»å‹å°±ä¼šè¢«æ¨å¯¼ä¸º`json`ç±»å‹ï¼Œä¸‹ä¸€æ­¥åˆ™ä¼šæ ¹æ®æ¥å£é…ç½®ä¿¡æ¯å’Œå…¨å±€é…ç½®ä¿¡æ¯é€‰æ‹©ä¸€ä¸ªé€‚é…çš„ JSON ç¼–ç å™¨ï¼ˆå¦‚ï¼šJackson è½¬æ¢å™¨ï¼‰

ä¹Ÿå³æ˜¯è¯´ï¼Œå¦‚æœè®¾ç½®äº†è¯·æ±‚ä½“ç±»å‹ï¼Œé‚£ä¹ˆ Content-Type å¤´å°±ä¸ä¼šå†å½±å“åˆ°æœ€ç»ˆè¯·æ±‚ä½“çš„å…·ä½“æ•°æ®æ ¼å¼

åŒç†ï¼Œå¦‚æœè®¾ç½®äº†`Encoder`ï¼Œé‚£ä¹ˆè¯·æ±‚ä½“ç±»å‹å°±è¢«æ— è§†äº†ï¼ŒContent-Type å¤´è®¾ç½®æˆä»€ä¹ˆä¹Ÿæ— å…³ç´§è¦

```
è¯·æ±‚ä½“æ•°æ®æ ¼å¼ç›¸å…³å±æ€§ä¼˜å…ˆçº§ï¼š

Encoder ç¼–ç å™¨ > BodyType è¯·æ±‚ä½“ç±»å‹ > Content-Type å¤´
```

å¦‚æœæ˜ç™½äº†è¿™ä¸€ç‚¹ï¼Œå°±å¯ä»¥å®ç°ä¸€äº›ä¸å¸¸è§çš„è¯·æ±‚ï¼Œå¦‚ï¼š

â‘  ä¸å¡« Content-Type å¤´ï¼Œè€Œè¯·æ±‚ä½“æ˜¯æ‚¨æƒ³è¦çš„æ ¼å¼ï¼ˆå¦‚ JSONï¼‰ï¼›

â‘¡ Content-Type ä¸º`application/json`ï¼Œä½†è¯·æ±‚ä½“å´æ˜¯è¡¨å•æ ¼å¼


### @BodyType æ³¨è§£

è¯·æ±‚ä½“ç±»å‹å¯ä»¥é€šè¿‡`@BodyType`æ³¨è§£æ¥æŒ‡å®š

```java
/**
 * è¯¥æ–¹æ³•ä¸è®¾ç½® Content-Type, ä¹Ÿå¯ä»¥æŒ‡å®š JSON æ ¼å¼è¯·æ±‚ä½“
 */
@Post(url = "/")
@BodyType("json")
String send(@Body("name") String name, @Body("value") Object value);
```

è°ƒç”¨åäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    BODY:
        {"name": "foo", "value": "bar"}

å¯ä»¥çœ‹åˆ°ï¼Œè¯¥è¯·æ±‚ä¸­æ²¡æœ‰ Content-Type è¯·æ±‚å¤´ï¼Œä½†è¯·æ±‚ä½“æ˜¯ JSON æ•°æ®

`@BodyType`æ³¨è§£ä¹Ÿå¯ç”¨äºå‘é€è¯·æ±‚ä½“æ ¼å¼ä¸ ContentType å¤´ç›¸å¼‚çš„æ•°æ®

```java
/**
 * æ­¤è¯·æ±‚Content-Typeå¤´ä¸º application/json
 * è€Œè¯·æ±‚ä½“çš„æ ¼å¼å´å¯ä»¥æ˜¯è¡¨å•æ ¼å¼
 */
@BodyType("form")
@Post(url = "/", contentType = "application/json")
String send(@Body("name") String name, @Body("value") Object value);
```

è°ƒç”¨åäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹ï¼š

    POST http://localhost:8080/hello/user
    HEADER:
        Content-Type: application/json
    BODY:
        name=foo&value=bar

è¯¥è¯·æ±‚ Content-Type ä¸º application/jsonï¼Œä½†è¯·æ±‚ä½“å´æ˜¯è¡¨å•æ ¼å¼æ•°æ®

### å¯æŒ‡å®šçš„è¯·æ±‚ä½“ç±»å‹

Forestæœ‰å¤šç§è¯·æ±‚ä½“ç±»å‹å¯ä¾›é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ï¼š`text`,`form`, `json`, `xml`, `binary`, `multipart`, `protobuf`

| è¯·æ±‚ä½“ç±»å‹ | æè¿° |
| --------- | ---------- |
| text | æ–‡æœ¬æ ¼å¼ï¼Œå³æ™®é€šçš„å­—ç¬¦ä¸² |
| form | è¡¨å•æ ¼å¼ï¼Œå³ x-www-form-urlencoded æ ¼å¼ |
| json | JSON æ ¼å¼ |
| xml | XML æ ¼å¼ |
| binary | äºŒè¿›åˆ¶æ ¼å¼ï¼Œå³äºŒè¿›åˆ¶å­—èŠ‚æµ |
| multipart | å¤šéƒ¨ä»¶æ ¼å¼ï¼Œå³ multipart/data-form æ ¼å¼ |
| protobuf | Protobuf æ ¼å¼ |

### æŒ‡å®š Encoder

`@BodyType`æ³¨è§£åŒæ—¶å¯ä»¥æŒ‡å®šEncoder

```java
/**
 * æŒ‡å®šè¯·æ±‚ä½“æ ¼å¼ä¸ºjsonçš„åŒæ—¶ï¼ŒæŒ‡å®šEncoderä¸ºJacksonè½¬æ¢å™¨
 */
@BodyType(type = "json", encoder = ForestJacksonConverter.class)
@Post(url = "/", contentType = ContentType.APPLICATION_X_WWW_FORM_URLENCODED)
String send(@Body Entry entry);
```

### JSON ç¼–ç å™¨å¿«æ·æ³¨è§£

å¦‚æœè¦æŒ‡å®šç‰¹å®šJSONè½¬æ¢å™¨ä¸ºæŸä¸€è¯·æ±‚çš„Encoderï¼Œå¯ä»¥ä½¿ç”¨å¯¹åº” JSON ç¼–ç å™¨çš„å¿«æ·æ³¨è§£

```java
/**
 * æŒ‡å®š Fastjson ä¸º Encoder
 */
@FastjsonEncoder
@Post("/")
String sendFastjson(@Body Entry entry);

/**
 * æŒ‡å®š Jackson ä¸º Encoder
 */
@JacksonEncoder
@Post("/")
String sendJackson(@Body Entry entry);

/**
 * æŒ‡å®š Gson ä¸º Encoder
 */
@GsonEncoder
@Post("/")
String sendGson(@Body Entry entry);
```

## å»¶è¿Ÿè¯·æ±‚ä½“å‚æ•°

å»¶è¿Ÿè¯·æ±‚ä½“å‚æ•° ï¼ˆä¹Ÿç§°ä½œ Lambda è¯·æ±‚ä½“å‚æ•°ï¼‰ï¼Œåœ¨æ‚¨éœ€è¦ä¸é©¬ä¸Šæ±‚å€¼çš„æƒ…å†µä½¿ç”¨ã€‚

æœ‰å¾ˆå¤šæƒ…å†µï¼ŒBodyçš„å‚æ•°å€¼ä¸èƒ½é©¬ä¸Šå¾—å‡ºï¼Œè€Œæ˜¯åœ¨è¯·æ±‚å‘é€å‰çš„é‚£ä¸€åˆ»ï¼ˆæ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½åˆ°ä½æ—¶ï¼‰æ‰èƒ½å¾—å‡ºï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯åŠ ç­¾éªŒè¯çš„åœºæ™¯ï¼ˆåœ¨è¯·æ±‚ä½“å‚æ•°ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•°tokenï¼Œè€Œtokençš„å€¼æ˜¯å¯¹æ•´ä¸ªbody(é™¤tokenä¹‹å¤–æ‰€æœ‰å‚æ•°)åšåŠ å¯†çš„ç»“æœï¼‰

```java
// ä½¿ç”¨ Lazy ä½œä¸º Body çš„å‚æ•°ç±»å‹
@Post("/data")
String sendData(@Body("a") String a, @Body("b") String b, @Body("token") Lazy<String> token);
```

åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥ Lambda

```java
myClient.sendData("Foo", "Bar", req -> {
    // req ä¸ºè¯·æ±‚å¯¹è±¡
    // è¿”å›å€¼å°†ä½œä¸ºå‚æ•°å€¼æ·»åŠ åˆ°è¯·æ±‚ä½“ä¸­
    return "";
});
```

åœ¨ Lambda ä»£ç å—ä¸­å¯ä»¥è°ƒç”¨`req.body().encode()`å¯ä»¥ç«‹å³åºåˆ—åŒ–æ•´ä¸ªè¯·æ±‚ä½“çš„æ•°æ®

ä½†ä¼šè‡ªåŠ¨æ’é™¤ Lambda æ‰€å¯¹åº”çš„ Body é¡¹ï¼ˆå³ token å­—æ®µï¼‰ï¼Œè€Œä¸ç”¨æ‹…å¿ƒä¼šé€ æˆæ­»å¾ªç¯


```java
// Lambda çš„å‚æ•°ä¸º ForestRequest è¯·æ±‚å¯¹è±¡
// è°ƒç”¨ req.body().encode() å¯ä»¥ç«‹å³åºåˆ—åŒ–æ•´ä¸ªè¯·æ±‚ä½“çš„æ•°æ®
myClient.sendData("Foo", "Bar", req -> Base64.encode(req.body().encode()));
```
