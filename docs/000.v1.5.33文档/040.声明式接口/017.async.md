---
id: async
title: ğŸŸ å¼‚æ­¥è¯·æ±‚
date: 2022-07-01 12:44:20
permalink: /pages/1.5.33/async/
---

## è®¾ç½®å¼‚æ­¥/åŒæ­¥

åœ¨Forestä½¿ç”¨å¼‚æ­¥è¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®`@Request`æ³¨è§£çš„`async`å±æ€§ä¸º`true`å®ç°ï¼Œä¸è®¾ç½®æˆ–è®¾ç½®ä¸º`false`å³ä¸ºåŒæ­¥è¯·æ±‚

```java
/**
 * async å±æ€§ä¸º true å³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œä¸º false åˆ™ä¸ºåŒæ­¥è¯·æ±‚
 * ä¸è®¾ç½®è¯¥å±æ€§æ—¶ï¼Œé»˜è®¤ä¸º false
 */
@Get(
        url = "http://localhost:8080/hello/user?username=${0}",
        async = true
)
String asyncGet(String username);
```

## ä½¿ç”¨å›è°ƒå‡½æ•°

å¼‚æ­¥è¯·æ±‚çš„æ–¹æ³•æ— æ³•ç›´æ¥é€šè¿‡è¿”å›å€¼æ¥å—æœåŠ¡ç«¯å“åº”çš„ç»“æœï¼Œå› ä¸ºåœ¨ç½‘ç»œè¿˜åœ¨æ²¡å®Œæˆè¿æ¥å’Œå“åº”çš„è¿‡ç¨‹ä¸­ï¼Œæ–¹æ³•å·²ç»è¿”å›äº†

æ­¤æ—¶éœ€è¦æˆåŠŸ/å¤±è´¥å›è°ƒå‡½æ•°æ¥å“åº”ç½‘ç»œè¯·æ±‚çš„ç»“æœ

```java
@Get(
        url = "http://localhost:8080/hello/user?username=${0}",
        async = true,
        headers = {"Accept:text/plain"}
)
void asyncGet(String usernameï¼Œ OnSuccess<String> onSuccess,OnError onError);
```

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¼‚æ­¥è¯·æ±‚éƒ½é€šè¿‡`OnSuccess<T>`
å›è°ƒå‡½æ•°æ¥æ¥å—å“åº”è¿”å›çš„æ•°æ®ï¼Œè€Œä¸æ˜¯é€šè¿‡æ¥å£æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥è¿™é‡Œçš„è¿”å›å€¼ç±»å‹ä¸€èˆ¬ä¼šå®šä¹‰ä¸º`void`ã€‚

:::tip æ–‡æ¡£å¯¼èˆª
å…³äºå›è°ƒå‡½æ•°çš„ä½¿ç”¨è¯·å‚è§ ã€Š[å›è°ƒå‡½æ•°](/pages/1.5.33/callback/)ã€‹
:::

```java
// å¼‚æ­¥æ‰§è¡Œ
myClient.asyncGet("foo",(result,req,res)->{
        // è¯·æ±‚æˆåŠŸï¼Œå¤„ç†å“åº”ç»“æœ
        System.out.println(result);
        },(ex,req,res)->{
        // è¯·æ±‚å¤±è´¥ï¼Œå¤„ç†å¤±è´¥ä¿¡æ¯
        System.out.println(ex.getMessage());
        });
```

## ä½¿ç”¨ Future æ¥å—å¼‚æ­¥æ•°æ®

æ­¤å¤–ï¼Œè‹¥æœ‰äº›å°ä¼™ä¼´ä¸ä¹ æƒ¯è¿™ç§å‡½æ•°å¼çš„ç¼–ç¨‹æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ç”¨`Future<T>`ç±»å‹å®šä¹‰æ–¹æ³•è¿”å›å€¼çš„æ–¹å¼æ¥æ¥å—å“åº”æ•°æ®ã€‚

```java
@Request(
        url = "http://localhost:8080/hello/user?username=foo",
        async = true,
        headers = {"Accept:text/plain"}
)
Future<String> asyncFuture();
```

è¿™é‡Œ`Future<T>`ç±»å°±æ˜¯`JDK`è‡ªå¸¦çš„`java.util.concurrent.Future`ç±», å…¶æ³›å‹å‚æ•°`T`ä»£è¡¨æ‚¨æƒ³æ¥å—çš„å“åº”æ•°æ®çš„ç±»å‹ã€‚

å…³äºå¦‚ä½•ä½¿ç”¨`Future`ç±»ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

```java
// å¼‚æ­¥æ‰§è¡Œ
Future<String> future=myClient.asyncFuture();

// åšä¸€äº›å…¶å®ƒäº‹æƒ…

// ç­‰å¾…æ•°æ®
        String result=future.get();
```

## å¼€å¯ Kotlin åç¨‹

è‡ª`1.5.27`ç‰ˆæœ¬å¼€å§‹ Forest æ”¯æŒ Kotlin è¯­è¨€çš„åç¨‹ç‰¹æ€§ï¼Œå¯ä»¥åœ¨å‘é€å¼‚æ­¥è¯·æ±‚çš„æ—¶å€™ä½¿ç”¨ Kotlin åç¨‹ä»£æ›¿ JVM çš„çº¿ç¨‹æ± 

åœ¨ä½¿ç”¨ Kotlin åç¨‹ä¹‹å‰ï¼Œéœ€è¦å…ˆç¡®ä¿å¯ä»¥ä½¿ç”¨ Kotlin è¯­è¨€ï¼Œå¹¶æœ‰ä»¥ä¸‹ä¾èµ–

<code-group>
<code-block title="Maven" active>

```xml
<dependency>
    <groupId>org.jetbrains.kotlin</groupId>
    <artifactId>kotlin-stdlib</artifactId>
    <version>1.6.20</version>
</dependency>

<dependency>
    <groupId>org.jetbrains.kotlinx</groupId>
    <artifactId>kotlinx-coroutines-core</artifactId>
    <version>1.6.2</version>
</dependency>
```

</code-block>
<code-block title="Gradle">

```groovy
compile group: 'org.jetbrains.kotlin', name: 'kotlin-stdlib', version: '1.6.20'
compile group: 'org.jetbrains.kotlinx', name: 'kotlinx-coroutines-core', version: '1.6.2'
```

</code-block>
</code-group>

Forest é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯·æ±‚çš„å¼‚æ­¥æ¨¡å¼ä¸º`platform`ï¼Œå³ JVM å¹³å°è‡ªå¸¦çš„çº¿ç¨‹æ± 

å¦‚æœè¦å¯ç”¨ Kotlin çº¿ç¨‹ï¼Œéœ€è¦å°†å¼‚æ­¥æ¨¡å¼è®¾ç½®ä¸º`kotlin_coroutine`

<code-group>
<code-block title="Yaml" active>

```yaml
forest:
  async-mode: kotlin_coroutine
```

</code-block>

<code-block title="Properties">

```properties
forest.async-mode=kotlin_coroutine
```

</code-block>


<code-block title="åŸç”Ÿ Java">

```java
Forest.config().setAsyncMode(ForestAsyncMode.KOTLIN_COROUTINE);
```

</code-block>
</code-group>

