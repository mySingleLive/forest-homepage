---
id: custom_converter
title: ğŸ¥‘ è‡ªå®šä¹‰è½¬æ¢å™¨
date: 2022-07-20 23:48:08
permalink: /pages/1.5.33/custom_converter/
---

åœ¨Forestä¸­ï¼Œæ¯ä¸ªè½¬æ¢ç±»å‹éƒ½å¯¹åº”ä¸€ä¸ªè½¬æ¢å™¨å¯¹è±¡ï¼Œæ¯”å¦‚`JSON`æ ¼å¼çš„è½¬æ¢å™¨æœ‰`com.dtflys.forest.converter.json.ForestFastjsonConverter`ã€`com.dtflys.forest.converter.json.ForestGsonConverter`ã€`com.dtflys.forest.converter.json.ForestJacksonConverter`ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯åŸºäº`FastJson`ã€`Gson`ã€`Jackson`ä¸‰ç§ä¸åŒçš„`JSON`åºåˆ—åŒ–æ¡†æ¶ã€‚

å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„è½¬æ¢å™¨ï¼Œä»¥é€‚åº”è‡ªå·±é¡¹ç›®çš„éœ€è¦ã€‚åªéœ€ä¸‰æ­¥ä¾¿å¯å®Œæˆè‡ªå®šä¹‰æ‰©å±•è½¬æ¢å™¨ã€‚

## å®ç° ForestConverter æ¥å£

å®šä¹‰ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼Œå¹¶å®ç°`com.dtflys.forest.converter.ForestConverter`æ¥å£

```java
/**
 *  è‡ªå®šä¹‰ä¸€ä¸ªProtobufçš„è½¬æ¢å™¨ï¼Œå¹¶å®ç°ForestConverteræ¥å£ä¸‹çš„convertToJavaObjectæ–¹æ³•
 */
public class MyProtobufConverter implements ForestConverter {

    public <T> T convertToJavaObject(String source, Class<T> targetType) {
        // å°†å­—ç¬¦ä¸²å‚æ•°sourceè½¬æ¢æˆç›®æ ‡Classå¯¹è±¡
    }

    public <T> T convertToJavaObject(String source, Type targetType) {
        // å°†å­—ç¬¦ä¸²å‚æ•°sourceè½¬æ¢æˆç›®æ ‡Type(å¯èƒ½æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹)å¯¹è±¡
    }

}
```

## æ³¨å†Œå…¨å±€è‡ªå®šä¹‰è½¬æ¢å™¨

æ³¨å†Œåˆ°å…¨å±€é…ç½®ä¸­

<code-group>
<code-block title="Yaml" active>

```yaml
forest:
  converters:
    # JSONè½¬æ¢å™¨
    json:
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºMyJsonConverterè½¬æ¢å™¨
      type: com.xxx.MyJsonConverter
      
    # XMLè½¬æ¢å™¨
    xml:
      # é…ç½®ä¸ºMyXmlConverterè½¬æ¢å™¨
      type: com.xxx.MyXmlConverter
```


</code-block>
<code-block title="Properties">

```properties
# JSONè½¬æ¢å™¨
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºMyJsonConverterè½¬æ¢å™¨
forest.converters.json.type=com.xxx.MyJsonConverter
# XMLè½¬æ¢å™¨
# é…ç½®ä¸ºMyXmlConverterè½¬æ¢å™¨
forest.converters.xml.type=com.xxx.MyXmlConverter
```


</code-block>
<code-block title="Spring">

```xml
<forest:configuration>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ å¼€å§‹ -->
    <!-- è®¾ç½®JSONè½¬æ¢å™¨ -->
    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºMyJsonConverterè½¬æ¢å™¨ -->
    <forest:converter dataType="json" class="com.xxx.MyJsonConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
    <!-- è®¾ç½®XMLè½¬æ¢å™¨ -->
    <!-- è®¾ç½®ä¸ºMyXmlConverterè½¬æ¢å™¨ -->
    <forest:converter dataType="xml" class="com.xxx.MyXmlConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
</forest:configuration>
```

</code-block>
<code-block title="Java">

```java
// è®¾ç½®JSONè½¬æ¢å™¨
forestConfiguration.setJsonConverter(new MyJsonConverter());
// è®¾ç½®XMLè½¬æ¢å™¨
forestConfiguration.getConverterMap().put(ForestDataType.XML, new MyXmlConverter());

```

</code-block>
</code-group>

## Springboot ä¸‹æ³¨å†Œå…¨å±€è½¬æ¢å™¨

åŒä¸Šæ–‡çš„ ã€Š[springboot ä¸‹é…ç½®å…¨å±€è½¬æ¢å™¨](/pages/1.5.33/converter/#springboot-ä¸‹é…ç½®å…¨å±€è½¬æ¢å™¨)ã€‹ä¸€æ ·ï¼Œå¯é€šè¿‡`@Bean`æ³¨è§£æ–¹æ³•å°†è‡ªå®šä¹‰è½¬æ¢å™¨å®ä¾‹æ³¨å…¥åˆ° Spring ä¸Šä¸‹æ–‡

```java
@Bean
public MyProtobufConverter myProtobufConverter() {
    return new MyProtobufConverter();
}
```

## æ¥å£/æ–¹æ³•çº§åˆ«è‡ªå®šä¹‰è½¬æ¢å™¨

ä¹ŸåŒä¸Šæ–‡çš„ ã€Š[é…ç½®æ¥å£/æ–¹æ³•çº§åˆ«è½¬æ¢å™¨](/pages/1.5.33/converter/#é…ç½®æ¥å£-æ–¹æ³•çº§åˆ«è½¬æ¢å™¨)ã€‹ä¸€æ ·ï¼Œé€šè¿‡`@BodyType`æ³¨è§£æ¥æŒ‡å®šè‡ªå®šä¹‰çš„è½¬æ¢å™¨ç±»

```java
// æ¥å£çº§åˆ«è½¬æ¢å™¨å®šä¹‰
@BodyType(type = "protobuf", encoder = MyProtobufConverter.class)
public interface MyClient {

    // æ–¹æ³•çº§åˆ«è½¬æ¢å™¨å®šä¹‰
    @Get("/data")
    @BodyType(type = "protobuf", encoder = MyProtobufConverter2.class)
    String sendData(@Body MyData data);
}
```
