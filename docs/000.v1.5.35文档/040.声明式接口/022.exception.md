---
id: exception
title: ğŸš‘ å¼‚å¸¸å¤„ç†
date: 2022-07-01 12:44:20
permalink: /pages/1.5.35/exception/
---

å‘é€HTTPè¯·æ±‚ä¸ä¼šæ€»æ˜¯æˆåŠŸçš„ï¼Œæ€»ä¼šæœ‰å¤±è´¥çš„æƒ…å†µã€‚Forestæä¾›å¤šç§å¼‚å¸¸å¤„ç†çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚å¤±è´¥çš„è¿‡ç¨‹ã€‚

### try-catchæ–¹å¼

æœ€å¸¸ç”¨çš„æ˜¯ç›´æ¥ç”¨`try-catch`ã€‚Forestè¯·æ±‚å¤±è´¥çš„æ—¶å€™é€šå¸¸ä¼šä»¥æŠ›å¼‚å¸¸çš„æ–¹å¼æŠ¥å‘Šé”™è¯¯ï¼Œ è·å–é”™è¯¯ä¿¡æ¯åªéœ€æ•è·`ForestNetworkException`å¼‚å¸¸ç±»çš„å¯¹è±¡ï¼Œå¦‚ç¤ºä¾‹ä»£ç æ‰€ç¤ºï¼š

```java
/**
 * try-catchæ–¹å¼ï¼šæ•è·ForestNetworkExceptionå¼‚å¸¸ç±»çš„å¯¹è±¡
 */
try {
    String result = myClient.send();
} catch (ForestNetworkException ex) {
    int status = ex.getStatusCode(); // è·å–è¯·æ±‚å“åº”çŠ¶æ€ç 
    ForestResponse response = ex.getResponse(); // è·å–Responseå¯¹è±¡
    String content = response.getContent(); // è·å–è¯·æ±‚çš„å“åº”å†…å®¹
    String resResult = response.getResult(); // è·å–æ–¹æ³•è¿”å›ç±»å‹å¯¹åº”çš„æœ€ç»ˆæ•°æ®ç»“æœ
}
```

### å›è°ƒå‡½æ•°æ–¹å¼

ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨`OnError`å›è°ƒå‡½æ•°ï¼Œå¦‚ç¤ºä¾‹ä»£ç æ‰€ç¤ºï¼š

```java
/**
 * åœ¨è¯·æ±‚æ¥å£ä¸­å®šä¹‰OnErrorå›è°ƒå‡½æ•°ç±»å‹å‚æ•°
 */
@Request(
        url = "http://localhost:8080/hello/user",
        headers = {"Accept:text/plain"},
        data = "username=${username}"
)
String send(@Var("username") String username, OnError onError);
```

è°ƒç”¨çš„ä»£ç å¦‚ä¸‹ï¼š

```java
// åœ¨è°ƒç”¨æ¥å£æ—¶ï¼Œåœ¨Lambdaä¸­å¤„ç†é”™è¯¯ç»“æœ
myClient.send("foo",  (ex, request, response) -> {
    int status = response.getStatusCode(); // è·å–è¯·æ±‚å“åº”çŠ¶æ€ç 
    String content = response.getContent(); // è·å–è¯·æ±‚çš„å“åº”å†…å®¹
    String result = response.getResult(); // è·å–æ–¹æ³•è¿”å›ç±»å‹å¯¹åº”çš„æœ€ç»ˆæ•°æ®ç»“æœ
});
```

:::warning æ³¨æ„
åŠ ä¸Š<b>OnError</b>å›è°ƒå‡½æ•°åä¾¿<b>ä¸ä¼šå†å‘ä¸ŠæŠ›å‡ºå¼‚å¸¸</b>ï¼Œæ‰€æœ‰é”™è¯¯ä¿¡æ¯å‡é€šè¿‡<b>OnError</b>å›è°ƒå‡½æ•°çš„å‚æ•°è·å¾—ã€‚
:::


### ForestResponse

ç¬¬ä¸‰ç§ï¼Œç”¨`ForestResponse`ç±»ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```java
/**
 * ç”¨`ForestResponse`ç±»ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›å€¼ç±»å‹, å…¶æ³›å‹å‚æ•°ä»£è¡¨å®é™…è¿”å›æ•°æ®çš„ç±»å‹
 */
@Request(
        url = "http://localhost:8080/hello/user",
        headers = {"Accept:text/plain"},
        data = "username=${username}"
)
ForestResponse<String> send(@Var("username") String username);
```

è°ƒç”¨å’Œå¤„ç†çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

```java
ForestResponse<String> response = myClient.send("foo");
// ç”¨isErroræ–¹æ³•åˆ¤æ–­è¯·æ±‚æ˜¯å¦å¤±è´¥, æ¯”å¦‚404, 500ç­‰æƒ…å†µ
if (response.isError()) {
    int status = response.getStatusCode(); // è·å–è¯·æ±‚å“åº”çŠ¶æ€ç 
    String content = response.getContent(); // è·å–è¯·æ±‚çš„å“åº”å†…å®¹
    String result = response.getResult(); // è·å–æ–¹æ³•è¿”å›ç±»å‹å¯¹åº”çš„æœ€ç»ˆæ•°æ®ç»“æœ
}
```

:::warning æ³¨æ„
ä»¥<b>ForestResponse</b>ç±»ä¸ºè¿”å›å€¼ç±»å‹çš„æ–¹æ³•ä¹Ÿ<b>ä¸ä¼šå‘ä¸ŠæŠ›å‡ºå¼‚å¸¸</b>ï¼Œé”™è¯¯ä¿¡æ¯å‡é€šè¿‡<b>ForestResponse</b>å¯¹è±¡è·å¾—ã€‚
:::


### æ‹¦æˆªå™¨æ–¹å¼

è‹¥è¦æ‰¹é‡å¤„ç†å„ç§ä¸åŒè¯·æ±‚çš„å¼‚å¸¸æƒ…å†µï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨, å¹¶åœ¨æ‹¦æˆªå™¨çš„`onError`æ–¹æ³•ä¸­å¤„ç†å¼‚å¸¸ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

````java
public class ErrorInterceptor implements Interceptor<String> {

    // ... ...

    @Override
    public void onError(ForestRuntimeException ex, ForestRequest request, ForestResponse response) {
        int status = response.getStatusCode(); // è·å–è¯·æ±‚å“åº”çŠ¶æ€ç 
        String content = response.getContent(); // è·å–è¯·æ±‚çš„å“åº”å†…å®¹
        Object result = response.getResult(); // è·å–æ–¹æ³•è¿”å›ç±»å‹å¯¹åº”çš„è¿”å›æ•°æ®ç»“æœ
    }
}
````

:::tip æç¤º
 å…³äºå…·ä½“å¦‚ä½•ä½¿ç”¨æ‹¦æˆªå™¨è¯·å‚è§ ã€Š[æ‹¦æˆªå™¨](/pages/1.5.35/interceptor/)ã€‹
:::
