---
id: api_request_body
title: ğŸš‹ è¯·æ±‚ä½“
date: 2022-07-14 12:40:43
permalink: /pages/1.5.30/api_request_body/
---


ForestRequest å¯¹è±¡æä¾›çš„æ·»åŠ /ä¿®æ”¹è¯·æ±‚ä½“æ•°æ®é¡¹çš„æ–¹æ³•

> `addBody(String bodyString)` æ·»åŠ å­—ç¬¦ä¸²Bodyæ•°æ®é¡¹

```java
request.addBody("xxxx")   // æ·»åŠ å­—ç¬¦ä¸²è¯·æ±‚ä½“ xxxx
       .addBody("yyyy");  // æ·»åŠ å­—ç¬¦ä¸²è¯·æ±‚ä½“ yyyy
// æœ€ç»ˆè¯·æ±‚ä½“ä¸º:
// xxxxyyyy
```

> `addBody(String name, Object value)` æ·»åŠ é”®å€¼å¯¹å½¢å¼çš„Bodyæ•°æ®é¡¹

```java
request.addBody("a", 1)  // æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹ï¼Œé”®å€¼å¯¹: a, 1
       .addBody("b", 2); // æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹ï¼Œé”®å€¼å¯¹: b, 2
```
ç°åœ¨ ForestRequest å¯¹è±¡ä¸­æœ‰äº†ä¸¤ä¸ªè¯·æ±‚ä½“æ•°æ®é¡¹ï¼Œé£åˆ«æ˜¯é”®å€¼å¯¹`<a, 1>` å’Œ `<b, 2>`
è‡³äºå®ƒä»¬æœ€ç»ˆä»¥ä»€ä¹ˆæ•°æ®æ ¼å¼å‘é€ï¼Œå–å†³äºè¯·æ±‚å¤´ä¸­çš„ `Content-Type` çš„å€¼

> `addBody(Object obj)` æ·»åŠ å¯¹è±¡å½¢å¼çš„Bodyæ•°æ®é¡¹
>- å‚æ•° `obj`: ä½œä¸ºè¯·æ±‚ä½“æ•°æ®çš„ä»»æ„ç±»å‹å¯¹è±¡

```java
// æ·»åŠ è‡ªå®šä¹‰ç±»å¯¹è±¡
MyUserInfo userInfo = new MyUserInfo();
userInfo.setName("foo");
request.addBody(userInfo);

// æ·»åŠ Mapå¯¹è±¡
Map<String, Object> map = new HashMap<>();
map.put("name", "foo");
map.put("value", "bar");
request.addBody(map);
```

## è¡¨å•æ•°æ®

åœ¨è°ƒç”¨ addBody æ–¹æ³•å‰ï¼Œéœ€è¦å…ˆæŒ‡å®š Content-Type ä¸º `application/x-www-form-urlencoded`

æ’å…¥é”®å€¼å¯¹å½¢å¼çš„è¡¨å•æ•°æ®

```java
// åˆ›å»ºè¡¨æ ¼æ ¼å¼è¯·æ±‚ä½“
// æŒ‰é”®å€¼å¯¹å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentFormUrlEncoded()  // æŒ‡å®šè¯·æ±‚ä½“ä¸ºè¡¨å•æ ¼å¼
    .addBody("name", "foo")   // æ·»åŠ Bodyé”®å€¼å¯¹: name, foo
    .addBody("value", "bar"); // æ·»åŠ Bodyé”®å€¼å¯¹: value, bar
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// name=foo&value=bar
```

æ’å…¥Mapå½¢å¼çš„è¡¨å•æ•°æ®

```java
// æ„å»ºMapå¯¹è±¡
Map<String, Object> map = new HashMap();
map.put("name", "foo");
map.put("value" "bar");
// åˆ›å»ºè¡¨æ ¼æ ¼å¼è¯·æ±‚ä½“
// æŒ‰Mapå½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentFormUrlEncoded() // æŒ‡å®šè¯·æ±‚ä½“ä¸ºè¡¨å•æ ¼å¼
    .addBody(map);           // æ·»åŠ Mapå¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// name=foo&value=bar
```

æ’å…¥è‡ªå®šä¹‰å¯¹è±¡å½¢å¼çš„è¡¨å•æ•°æ®

```java
// ç”¨è‡ªå®šä¹‰çš„ MyUserInfo ç±»å¯¹è±¡
MyUserInfo user = new MyUserInfo();
user.setUsername("Jack");
user.setAge(20);
// åˆ›å»ºè¡¨æ ¼æ ¼å¼è¯·æ±‚ä½“
// æŒ‰è‡ªå®šä¹‰å¯¹è±¡å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentFormUrlEncoded()  // æŒ‡å®šè¯·æ±‚ä½“ä¸ºè¡¨å•æ ¼å¼
    .addBody(user);           // æ·»åŠ è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// username=Jack&age=20
```

æ··åˆä½¿ç”¨å¤šç§å½¢å¼

```java
// æ„å»ºMapå¯¹è±¡
Map<String, Object> map = new HashMap();
map.put("name", "foo");
map.put("value" "bar");
// æ„å»ºè‡ªå®šä¹‰ç±»å¯¹è±¡
MyUserInfo user = new MyUserInfo();
user.setUsername("Jack");
user.setAge(20);
// åˆ›å»ºè¡¨æ ¼æ ¼å¼è¯·æ±‚ä½“
// æŒ‰è‡ªå®šä¹‰å¯¹è±¡å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentFormUrlEncoded() // æŒ‡å®šè¯·æ±‚ä½“ä¸ºè¡¨å•æ ¼å¼
    .addBody("a", 1)         // æ·»åŠ Bodyé”®å€¼å¯¹: a, 1
    .addBody("b", 2)         // æ·»åŠ Bodyé”®å€¼å¯¹: b, 2
    .addBody(map)            // æ·»åŠ Mapå¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
    .addBody(user);          // æ·»åŠ è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// a=1&b=2&name=foo&value=bar&username=Jack&age=20
```

## JSONæ•°æ®

åœ¨è°ƒç”¨ addBody æ–¹æ³•å‰ï¼Œéœ€è¦å…ˆæŒ‡å®š Content-Type ä¸º `application/json` æˆ–å…¶ä»–`json`å­—ç¬¦ä¸²ç»“å°¾çš„ Content-Type å€¼

æ’å…¥é”®å€¼å¯¹å½¢å¼çš„JSONæ•°æ®

```java
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰é”®å€¼å¯¹å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentTypeJson()        // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .addBody("name", "foo")   // æ·»åŠ Bodyé”®å€¼å¯¹: name, foo
    .addBody("value", "bar"); // æ·»åŠ Bodyé”®å€¼å¯¹: value, bar
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// {"name": "foo", "value": "bar"}
```

æ’å…¥Mapæˆ–Listå½¢å¼çš„è¡¨å•æ•°æ®

```java
// æ„å»ºMapå¯¹è±¡
Map<String, Object> map = new HashMap();
map.put("name", "foo");
map.put("value" "bar");
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰Mapå½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentTypeJson() // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .addBody(map);     // æ·»åŠ Mapå¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// {"name": "foo", "value": "bar"}

// æ„å»ºListå¯¹è±¡
List<Integer> list = new ArrayList();
value.add(1);
value.add(2);
value.add(3);
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰Mapå½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentTypeJson() // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .addBody(list);    // æ·»åŠ Listå¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// [1, 2, 3]
```

æ’å…¥è‡ªå®šä¹‰å¯¹è±¡å½¢å¼çš„è¡¨å•æ•°æ®

```java
// æ„å»ºè‡ªå®šä¹‰ç±»å¯¹è±¡
MyUserInfo user = new MyUserInfo();
user.setUsername("Jack");
user.setAge(20);
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰è‡ªå®šä¹‰å¯¹è±¡å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentTypeJson()  // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .addBody(user);     // æ·»åŠ è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// {"username": "Jack", "age", 20}
```

JSONæ•°æ®è¯·æ±‚ä½“ï¼ŒåŒæ ·å¯ä»¥æ··åˆå¤šç§å½¢å¼æ·»åŠ 

```java
// æ„å»ºMapå¯¹è±¡
Map<String, Object> map = new HashMap();
map.put("name", "foo");
map.put("value" "bar");
// æ„å»ºè‡ªå®šä¹‰ç±»å¯¹è±¡
MyUserInfo user = new MyUserInfo();
user.setUsername("Jack");
user.setAge(20);
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰è‡ªå®šä¹‰å¯¹è±¡å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentTypeJson()  // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .addBody("a", 1)    // æ·»åŠ Bodyé”®å€¼å¯¹: a, 1
    .addBody("b", 2)    // æ·»åŠ Bodyé”®å€¼å¯¹: b, 2
    .addBody(map)       // æ·»åŠ Mapå¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
    .addBody(user);     // æ·»åŠ è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// {"a": 1, "b", 2, "name": "foo": "value", "bar": "username": "Jack&age": 20}
```

æœ€åï¼Œä»‹ç»ä¸€ç§æœ€ç®€å•ç›´ç™½çš„æ·»åŠ JSONè¯·æ±‚ä½“çš„åŠæ³•

```java
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰å­—ç¬¦ä¸²å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
     // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .contentTypeJson()
     // æ’å…¥JSONå­—ç¬¦ä¸²åˆ°è¯·æ±‚ä½“ä¸­
    .addBody("{\"name\": \"foo\", \"value\": \"bar\"}")
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// {"name": "foo", "value": "bar"}
```

## XMLæ•°æ®

åœ¨è°ƒç”¨ addBody æ–¹æ³•å‰ï¼Œéœ€è¦å…ˆæŒ‡å®š Content-Type ä¸º `application/xml` æˆ–å…¶ä»–`xml`å­—ç¬¦ä¸²ç»“å°¾çš„ Content-Type å€¼

Forestä»…æ”¯æŒç”¨JAXBé…åˆè‡ªå®šä¹‰ç±»å¯¹è±¡çš„å½¢å¼æ·»åŠ XMLæ ¼å¼è¯·æ±‚ä½“

```java
@XmlRootElement(name = "user")
public MyUserInfo {

    private String usrname;

    private String password;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}
```
åœ¨Bodyä¸­æ’å…¥ MyUserInfo å¯¹è±¡

```java
// æ„å»ºè‡ªå®šä¹‰ç±»å¯¹è±¡
MyUserInfo user = new MyUserInfo();
user.setUsername("foo");
user.setPassword("bar");
// åˆ›å»ºXMLæ ¼å¼è¯·æ±‚ä½“
// æŒ‰è‡ªå®šä¹‰å¯¹è±¡å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
    .contentTypeXml()  // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .addBody(user);     // æ·»åŠ è‡ªå®šä¹‰ç±»å¯¹è±¡åˆ°è¯·æ±‚ä½“ä¸­
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// <user><username>foo</username><password>bar</password></user>
```

åŒæ ·ï¼ŒXMLæ ¼å¼è¯·æ±‚ä½“ä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²å½¢å¼ç›´æ¥æ’å…¥

```java
// åˆ›å»ºJSONæ ¼å¼è¯·æ±‚ä½“
// æŒ‰å­—ç¬¦ä¸²å½¢å¼æ·»åŠ è¯·æ±‚ä½“æ•°æ®é¡¹
Forest.post("/")
     // æŒ‡å®šè¯·æ±‚ä½“ä¸ºJSONæ ¼å¼
    .contentTypeJson()
     // æ’å…¥XMLå­—ç¬¦ä¸²åˆ°è¯·æ±‚ä½“ä¸­
    .addBody("<user><username>foo</username><password>bar</password></user>")
// æœ€ç»ˆè¯·æ±‚ä½“æ•°æ®ä¸º
// <user><username>foo</username><password>bar</password></user>
```

## æ–‡ä»¶

åœ¨è°ƒç”¨ addBody æ–¹æ³•å‰ï¼Œéœ€è¦å…ˆæŒ‡å®š Content-Type ä¸º `multipart/form-data`

ç„¶åè°ƒç”¨ addFile æ–¹æ³•ï¼Œæ·»åŠ æ–‡ä»¶æ•°æ®

æ·»åŠ  `File` å¯¹è±¡


> `addFile(String name, File file, String filename, String contentType)` æ·»åŠ æ–‡ä»¶ (**æ¥å—Fileå¯¹è±¡**)
>
>- å‚æ•° `name`:  å‚æ•°åç§°
>
>- å‚æ•° `file`: æ–‡ä»¶, File ç±»å‹å¯¹è±¡
>
>- å‚æ•° `filename`: æ–‡ä»¶å, æœŸæœ›ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®åœ¨æœåŠ¡ç«¯ä¿å­˜çš„æ–‡ä»¶å
>
>- å‚æ•° `contentType`: æ–‡ä»¶æ•°æ®çš„ Content-Type
>
> `addFile(String name, File file, String filename)` æ·»åŠ æ–‡ä»¶ (**æ¥å—Fileå¯¹è±¡**)
>
> `addFile(String name, File file)` æ·»åŠ æ–‡ä»¶ (**æ¥å—Fileå¯¹è±¡**)

```java
// æ„å»ºFileå¯¹è±¡
File file = new File(path);
Forest.post("/upload")
      // æŒ‡å®šè¯·æ±‚ä½“ä¸ºMultipartæ ¼å¼
     .contentTypeMultipartFormData()
      // æ·»åŠ Fileå¯¹è±¡
     .addFile("file", file);
```

æ·»åŠ è¾“å…¥æµå¯¹è±¡

- `addFile(String name, InputStream inputStream, String filename, String contentType)` æ·»åŠ æ–‡ä»¶ (**æ¥å—è¾“å…¥æµ**)

> å‚æ•° `name`:  å‚æ•°åç§°
>
> å‚æ•° `inputStream`: æ–‡ä»¶è¾“å…¥æµå¯¹è±¡
>
> å‚æ•° `filename`: æ–‡ä»¶å, æœŸæœ›ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®åœ¨æœåŠ¡ç«¯ä¿å­˜çš„æ–‡ä»¶å
>
> å‚æ•° `contentType`: æ–‡ä»¶æ•°æ®çš„ Content-Type

- `addFile(String name, InputStream inputStream, String filename)` æ·»åŠ æ–‡ä»¶ (**æ¥å—è¾“å…¥æµ**)

```java
// æ„å»ºInputStreamå¯¹è±¡
File file = new File(path);
InputStream in = new FileInputStream(file);
Forest.post("/upload")
      // æŒ‡å®šè¯·æ±‚ä½“ä¸ºMultipartæ ¼å¼
     .contentTypeMultipartFormData()
      // æ·»åŠ InputStreamå¯¹è±¡
     .addFile("file", in, "test.jpg");
```

æ·»åŠ å­—èŠ‚æ•°ç»„

> `addFile(String name, byte[] bytes, String filename, String contentType)` æ·»åŠ æ–‡ä»¶ (**æ¥å—å­—èŠ‚æ•°ç»„**)
>- å‚æ•° `name`:  å‚æ•°åç§°
>- å‚æ•° `bytes`: æ–‡ä»¶å­—èŠ‚æ•°ç»„
>- å‚æ•° `filename`: æ–‡ä»¶å, æœŸæœ›ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®åœ¨æœåŠ¡ç«¯ä¿å­˜çš„æ–‡ä»¶å
>- å‚æ•° `contentType`: æ–‡ä»¶æ•°æ®çš„ Content-Type
>
> `addFile(String name, byte[] bytes, String filename)` æ·»åŠ æ–‡ä»¶ (**æ¥å—å­—èŠ‚æ•°ç»„**)

```java
// æ„å»ºå­—èŠ‚æ•°ç»„
byte[] byteArray = IOUtils.toByteArray(url);
Forest.post("/upload")
      // æŒ‡å®šè¯·æ±‚ä½“ä¸ºMultipartæ ¼å¼
     .contentTypeMultipartFormData()
      // æ·»åŠ å­—èŠ‚æ•°ç»„
     .addFile("file", byteArray, "test.jpg");
```

æ·»åŠ å¤šä¸ªæ–‡ä»¶

```java
Forest.post("/upload")
      // æŒ‡å®šè¯·æ±‚ä½“ä¸ºMultipartæ ¼å¼
     .contentTypeMultipartFormData()
      // æ·»åŠ Fileå¯¹è±¡1
     .addFile("file1", file1);
      // æ·»åŠ Fileå¯¹è±¡2
     .addFile("file2", file2);
      // æ·»åŠ Fileå¯¹è±¡3
     .addFile("file3", file3);
```

## Multipart

åœ¨æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œé™¤äº†è¦æ·»åŠ æ–‡ä»¶å¤–ï¼Œé€šå¸¸ä¹Ÿè¦ä¼ é€’ä¸€äº›æ™®é€šå‚æ•°

åªè¦åœ¨è°ƒç”¨ `addFile` æ–¹æ³•åï¼Œå†è°ƒç”¨ `addBody` æ–¹æ³•å³å¯

```java
Forest.post("/upload")
      // æŒ‡å®šè¯·æ±‚ä½“ä¸ºMultipartæ ¼å¼
     .contentTypeMultipartFormData()
      // æ·»åŠ Fileå¯¹è±¡
     .addFile("file", file)
      // æ·»åŠ  Multipart å‚æ•°1
     .addBody("name", "foo")
      // æ·»åŠ  Multipart å‚æ•°2
     .addBody("value", "bar");
```

æŒ‡å®šMultipartæ•°æ®é¡¹çš„ Content-Type

> addBody(String name, String contentType, Object value) æ·»åŠ é”®å€¼å¯¹å½¢å¼Bodyæ•°æ®
>- å‚æ•°`name`: å­—æ®µå
>- å‚æ•°`contentType`: è¯¥è¯·æ±‚ä½“æ•°æ®é¡¹çš„Content-Type
>- å‚æ•°`value`: å­—æ®µå€¼

```java
Forest.post("/upload")
      // æŒ‡å®šè¯·æ±‚ä½“ä¸ºMultipartæ ¼å¼
     .contentTypeMultipartFormData()
      // æ·»åŠ Fileå¯¹è±¡
     .addFile("file", file)
      // æ·»åŠ  Multipart å‚æ•°1ï¼ŒContent-Type ä¸º  text/plian
     .addBody("name", "text/plian", "foo")
      // æ·»åŠ  Multipart å‚æ•°2ï¼ŒContent-Type ä¸º  text/plian;charset=utf-8
     .addBody("value", "text/plian;charset=utf-8", "bar");
```
