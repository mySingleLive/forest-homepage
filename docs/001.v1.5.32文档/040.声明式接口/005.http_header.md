---
id: http_header
title: ğŸ­ è¯·æ±‚å¤´
date: 2022-07-01 12:44:20
permalink: /pages/1.5.32/http_header/
---


åœ¨ã€Š[æ„å»ºæ¥å£](001.build_interface)ã€‹çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¯ä»¥é€šè¿‡`@Request`æ³¨è§£çš„`headers`å±æ€§è®¾ç½®ä¸€æ¡ HTTP è¯·æ±‚å¤´ã€‚

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ·»åŠ å¤šæ¡è¯·æ±‚å¤´ã€‚

## headerså±æ€§

å…¶ä¸­`headers`å±æ€§æ¥å—çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œåœ¨æ¥å—å¤šä¸ªè¯·æ±‚å¤´ä¿¡æ¯æ—¶ä»¥ä»¥ä¸‹å½¢å¼å¡«å…¥è¯·æ±‚å¤´ï¼š

```java
{
    "è¯·æ±‚å¤´åç§°1: è¯·æ±‚å¤´å€¼1",
    "è¯·æ±‚å¤´åç§°2: è¯·æ±‚å¤´å€¼2",
    "è¯·æ±‚å¤´åç§°3: è¯·æ±‚å¤´å€¼3",
    ...
 }
```

å…¶ä¸­ç»„æ•°æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²ä»£è¡¨ä¸€ä¸ªè¯·æ±‚å¤´ã€‚è¯·æ±‚å¤´çš„åç§°å’Œå€¼ç”¨`:`åˆ†å‰²ã€‚

å…·ä½“ä»£ç è¯·çœ‹å¦‚ä¸‹ç¤ºä¾‹ï¼š

```java
public interface MyClient {

    @Request(
            url = "http://localhost:8080/hello/user",
            headers = {
                "Accept-Charset: utf-8",
                "Content-Type: text/plain"
            }
    )
    String multipleHeaders();
}
```

è¯¥æ¥å£è°ƒç”¨åæ‰€å®é™…äº§ç”Ÿçš„ HTTP è¯·æ±‚å¦‚ä¸‹ï¼š

    GET http://localhost:8080/hello/user
    HEADER:
        Accept-Charset: utf-8
        Content-Type: text/plain

å¦‚æœè¦æ¯æ¬¡è¯·æ±‚ä¼ å…¥ä¸åŒçš„è¯·æ±‚å¤´å†…å®¹ï¼Œå¯ä»¥åœ¨`headers`å±æ€§çš„è¯·æ±‚å¤´å®šä¹‰ä¸­åŠ å…¥`æ•°æ®ç»‘å®š`ã€‚

```java
public interface MyClient {

    @Request(
            url = "http://localhost:8080/hello/user",
            headers = {
                "Accept-Charset: ${encoding}",
                "Content-Type: text/plain"
            }
    )
    String bindingHeader(@Var("encoding") String encoding);
}
```

å¦‚æœè°ƒç”¨æ–¹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
myClient.bindingHeader("gbk");
```

è¿™æ®µè°ƒç”¨æ‰€å®é™…äº§ç”Ÿçš„ HTTP è¯·æ±‚å¦‚ä¸‹ï¼š

    GET http://localhost:8080/hello/user
    HEADER:
        User-Agent: forest/1.5.32
        Accept-Charset: gbk
        Content-Type: text/plain

## User-Agent è¯·æ±‚å¤´

å…¶ä¸­, `User-Agent`æ˜¯ç‰¹æ®Šçš„é€šç”¨è¯·æ±‚å¤´ï¼Œæ‰€æœ‰çš„ Forest è¯·æ±‚éƒ½ä¼šé»˜è®¤è‡ªåŠ¨åŠ ä¸Š`User-Agent: forest/{version}`è¿™æ ·çš„è¯·æ±‚å¤´ã€‚

è¯¥è¯·æ±‚å¤´æ— æ³•åˆ é™¤ï¼Œä½†å¯ä»¥ç”¨å…¶ä»–çš„å€¼æ¥è¦†ç›–

```java
@Request(
        url = "http://localhost:8080/hello/user",
        headers = {
            "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6)",    
            "Accept-Charset: ${encoding}",
            "Content-Type: text/plain"
        }
)
String bindingHeader(@Var("encoding") String encoding);
```

è‹¥è¢«è¦†ç›–ï¼Œåˆ™`User-Agent`è¯·æ±‚å¤´çš„å€¼å°±ä¼šè‡ªå®šä¹‰çš„`User-Agent`å†…å®¹
        
## @Header æ³¨è§£

æƒ³å¿…å¤§å®¶éƒ½å·²ç»äº†è§£é€šè¿‡ `headers` å±æ€§è®¾ç½®è¯·æ±‚å¤´çš„æ–¹æ³•äº†ã€‚ä¸è¿‡è¿™ç§æ–¹å¼è™½ç„¶ç›´è§‚ï¼Œä½†å¦‚è¦æ²¡é€šè¿‡å‚æ•°ä¼ å…¥åˆ°è¯·æ±‚å¤´ä¸­å°±æ˜¾å¾—æ¯”è¾ƒå•°å—¦äº†ã€‚

æ‰€ä»¥Forestè¿˜æä¾›äº† `@Header` æ³¨è§£æ¥å¸®åŠ©æ‚¨æŠŠæ–¹æ³•çš„å‚æ•°ç›´æ¥ç»‘å®šåˆ°è¯·æ±‚ä½“ä¸­ã€‚

```java

/**
 * ä½¿ç”¨ @Header æ³¨è§£å°†å‚æ•°ç»‘å®šåˆ°è¯·æ±‚å¤´ä¸Š
 * @Header æ³¨è§£çš„ value æŒ‡ä¸ºè¯·æ±‚å¤´çš„åç§°ï¼Œå‚æ•°å€¼ä¸ºè¯·æ±‚å¤´çš„å€¼
 * @Header("Accept") String acceptå°†å­—ç¬¦ä¸²ç±»å‹å‚æ•°ç»‘å®šåˆ°è¯·æ±‚å¤´ Accept ä¸Š
 * @Header("accessToken") String accessTokenå°†å­—ç¬¦ä¸²ç±»å‹å‚æ•°ç»‘å®šåˆ°è¯·æ±‚å¤´ accessToken ä¸Š
 */
@Post("http://localhost:8080/hello/user?username=foo")
void postUser(@Header("Accept") String accept, @Header("accessToken") String accessToken);

```

å¦‚æœæœ‰å¾ˆå¤šå¾ˆå¤šçš„è¯·æ±‚å¤´è¦é€šè¿‡å‚æ•°ä¼ å…¥ï¼Œæˆ‘éœ€è¦å®šä¹‰å¾ˆå¤šå¾ˆå¤šå‚æ•°å—ï¼Ÿå½“ç„¶ä¸ç”¨ï¼

```java
/**
 * ä½¿ç”¨ @Header æ³¨è§£å¯ä»¥ä¿®é¥° Map ç±»å‹çš„å‚æ•°
 * Map çš„ Key æŒ‡ä¸ºè¯·æ±‚å¤´çš„åç§°ï¼ŒValue ä¸ºè¯·æ±‚å¤´çš„å€¼
 * é€šè¿‡æ­¤æ–¹å¼ï¼Œå¯ä»¥å°† Map ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹æ‰¹é‡åœ°ç»‘å®šåˆ°è¯·æ±‚å¤´ä¸­
 */
@Post("http://localhost:8080/hello/user?username=foo")
void headHelloUser(@Header Map<String, Object> headerMap);


/**
 * ä½¿ç”¨ @Header æ³¨è§£å¯ä»¥ä¿®é¥°è‡ªå®šä¹‰ç±»å‹çš„å¯¹è±¡å‚æ•°
 * ä¾æ®å¯¹è±¡ç±»çš„ Getter å’Œ Setter çš„è§„åˆ™å–å‡ºå±æ€§
 * å…¶å±æ€§åä¸º URL è¯·æ±‚å¤´çš„åç§°ï¼Œå±æ€§å€¼ä¸ºè¯·æ±‚å¤´çš„å€¼
 * ä»¥æ­¤æ–¹å¼ï¼Œå°†ä¸€ä¸ªå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§æ‰¹é‡åœ°ç»‘å®šåˆ°è¯·æ±‚å¤´ä¸­
 */
@Post("http://localhost:8080/hello/user?username=foo")
void headHelloUser(@Header MyHeaderInfo headersInfo);

```

:::warning æ³¨æ„
- (1) éœ€è¦å•ä¸ªå•ä¸ªå®šä¹‰è¯·æ±‚å¤´çš„æ—¶å€™ï¼Œ<b>@Header</b>æ³¨è§£çš„<b>value</b>å€¼ä¸€å®šè¦æœ‰ï¼Œæ¯”å¦‚ <b>@Header("Content-Type") String contentType</b>

- (2) éœ€è¦ç»‘å®šå¯¹è±¡çš„æ—¶å€™ï¼Œ<b>@Header</b>æ³¨è§£çš„valueå€¼ä¸€å®šè¦ç©ºç€ï¼Œæ¯”å¦‚ <b>@Header MyHeaders headers</b> æˆ– <b>@Header Map headerMap</b>
:::


## å»¶è¿Ÿè¯·æ±‚å¤´å‚æ•°

å»¶è¿Ÿè¯·æ±‚å¤´å‚æ•° ï¼ˆä¹Ÿç§°ä½œ Lambda è¯·æ±‚å¤´å‚æ•°ï¼‰ï¼Œåœ¨æ‚¨éœ€è¦ä¸é©¬ä¸Šæ±‚å€¼çš„æƒ…å†µä½¿ç”¨ã€‚

æœ‰å¾ˆå¤šæƒ…å†µï¼Œè¯·æ±‚å¤´çš„å‚æ•°å€¼ä¸èƒ½é©¬ä¸Šå¾—å‡ºï¼Œè€Œæ˜¯åœ¨è¯·æ±‚å‘é€å‰çš„é‚£ä¸€åˆ»ï¼ˆæ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½åˆ°ä½æ—¶ï¼‰æ‰èƒ½å¾—å‡ºï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯åŠ ç­¾éªŒè¯çš„åœºæ™¯

```java
// ä½¿ç”¨ Lazy ä½œä¸º Query çš„å‚æ•°ç±»å‹
@Post("/data")
String sendData(@Body data, @Header("token") Lazy<String> token);
```

åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥ Lambda

```java
myClient.sendData("Foo", "Bar", req -> {
    // req ä¸ºè¯·æ±‚å¯¹è±¡
    // è¿”å›å€¼å°†ä½œä¸ºå‚æ•°å€¼æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­
    return "";
});
```

åœ¨ Lambda ä»£ç å—ä¸­å¯ä»¥è°ƒç”¨`req.body().encodeToString()` å°†æ•´ä¸ªè¯·æ±‚ä½“çš„æ•°æ®åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²


```java
// Lambda çš„å‚æ•°ä¸º ForestRequest è¯·æ±‚å¯¹è±¡
// è°ƒç”¨ req.body().encodeString() å¯ä»¥ç«‹å³å°†æ•´ä¸ªè¯·æ±‚ä½“çš„æ•°æ®åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
// encrypt æ˜¯è‡ªå®šä¹‰çš„åŠ å¯†æ–¹æ³•
myClient.sendData("Foo", "Bar", req -> encrypt(req.body().encodeToString()));
```
