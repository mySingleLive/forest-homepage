---
id: spring_config
title: ğŸ‘ Springç¯å¢ƒé…ç½®é¡¹
date: 2022-07-01 12:44:20
permalink: /pages/1.5.x/spring_config_items/
---

è‹¥æ‚¨çš„é¡¹ç›®ä¾èµ–çš„æ˜¯`Spring`ï¼Œè€Œé`Spring Boot`ï¼Œæˆ–è€…ä½¿ç”¨`xml`æ–¹å¼è¿›è¡Œ`Spring Bean`çš„é…ç½®ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€šè¿‡`Spring xml`çš„æ–¹å¼å®šä¹‰é…ç½®ã€‚

### ä¾èµ–

åœ¨è¿›è¡Œ`Spring`æ–¹å¼é…ç½®å‰ï¼Œéœ€è¦å…ˆç¡®ä¿æ‚¨çš„é¡¹ç›®åœ¨Mavenä¸­é™¤äº†forest-coreå’Œspringå¤–ï¼Œè¿˜ä¾èµ–forest-springåŒ…

```xml
 <dependency>
     <groupId>com.dtflys.forest</groupId>
     <artifactId>forest-spring</artifactId>
     <version>1.5.25</version>
 </dependency>
```

### é…ç½® XML SCEHEMA

æ‰“å¼€`spring`çš„ä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶ï¼Œåœ¨`beans`å¼€å¤´å®šä¹‰çš„å±æ€§ä¸­åŠ å…¥Forestçš„`Schema`

```
xmlns:forest="http://forest.dtflyx.com/schema/forest" 
   ...
xsi:schemaLocation=" ...
http://forest.dtflyx.com/schema/forest
http://forest.dtflyx.com/schema/forest/forest-spring.xsd 
..."
```

åŠ å…¥å®Œæˆåç±»ä¼¼å¦‚ä¸‹æ•ˆæœ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:forest="http://forest.dtflyx.com/schema/forest"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://forest.dtflyx.com/schema/forest
       http://forest.dtflyx.com/schema/forest/forest-spring.xsd">
    
   ...

</beans>
```

### æ·»åŠ ForeståŸºæœ¬é…ç½®çš„å®šä¹‰

```xml
<!-- Forest å…¨å±€é…ç½® -->
<!-- id åœ¨springä¸Šä¸‹æ–‡ä¸­beançš„id, é»˜è®¤å€¼ä¸ºforestConfiguration -->
<!-- backend åç«¯HTTP APIï¼š okhttp3 -->
<!-- timeout è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’, é»˜è®¤å€¼ä¸º3000 -->
<!-- connectTimeout è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’, é»˜è®¤å€¼ä¸º2000 -->
<!-- retryCount è¯·æ±‚å¤±è´¥åé‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º0æ¬¡ä¸é‡è¯• -->
<!-- retryer é‡è¯•å™¨ç±» -->
<!-- sslProtocol å•å‘éªŒè¯çš„HTTPSçš„é»˜è®¤SSLåè®®ï¼Œé»˜è®¤ä¸ºSSLv3 -->
<!-- maxConnections æ¯ä¸ªè·¯ç”±çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º500 -->
<!-- maxRouteConnections æ¯ä¸ªè·¯ç”±çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º500 -->
<!-- maxRequestQueueSize [è‡ªv1.5.22ç‰ˆæœ¬èµ·å¯ç”¨] æœ€å¤§è¯·æ±‚ç­‰å¾…é˜Ÿåˆ—å¤§å° -->
<!-- maxAsyncThreadSize [è‡ªv1.5.21ç‰ˆæœ¬èµ·å¯ç”¨] æœ€å¤§å¼‚æ­¥çº¿ç¨‹æ•° -->
<!-- maxAsyncQueueSize [è‡ªv1.5.22ç‰ˆæœ¬èµ·å¯ç”¨] æœ€å¤§å¼‚æ­¥çº¿ç¨‹æ± é˜Ÿåˆ—å¤§å° -->
<!-- logEnabled æ‰“å¼€æˆ–å…³é—­æ—¥å¿—æ€»å¼€å…³ï¼Œé»˜è®¤ä¸ºtrue -->
<!-- logRequest æ‰“å¼€/å…³é—­Forestè¯·æ±‚æ—¥å¿—ï¼ˆé»˜è®¤ä¸º trueï¼‰ -->
<!-- logResponseStatus æ‰“å¼€/å…³é—­Forestå“åº”çŠ¶æ€æ—¥å¿—ï¼ˆé»˜è®¤ä¸º trueï¼‰ -->
<!-- logResponseContent æ‰“å¼€/å…³é—­Forestå“åº”å†…å®¹æ—¥å¿—ï¼ˆé»˜è®¤ä¸º falseï¼‰ -->
<forest:configuration
    id="config0"
    backend="httpclient"
    timeout="30000"
    connectTimeout="10000"
    retryCount="3"
    retryer="com.dtflys.forest.retryer.NoneRetryer"
    charset="UTF-8"
    sslProtocol="SSLv3"
    maxConnections="500"
    maxRouteConnections="500"
    maxRequestQueueSize="100"
    maxAsyncThreadSize="256"
    maxAsyncQueueSize="128"
    logEnabled="true"
    logRequest="false"
    logResponseStatus="false"
    logResponseContent="true">

   <!-- forestå˜é‡å®šä¹‰ å¼€å§‹ -->
   <forest:var name="baseUrl" value="http://www.xxx.com"/>
   <forest:var name="x" value="0"/>
   <forest:var name="y" value="1"/>
   <!-- forestå˜é‡å®šä¹‰ ç»“æŸ -->

    <!-- SSL KeyStoreå®šä¹‰ å¼€å§‹ -->
    <forest:ssl-keystore id="keystore1" file="test.keystore" keystorePass="123456" certPass="123456"/>
    <forest:ssl-keystore id="keystore2" file="test2.keystore" keystorePass="foo" certPass="bar"/>
    <!-- SSL KeyStoreå®šä¹‰ ç»“æŸ -->
    
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ å¼€å§‹ -->
    <!-- è®¾ç½®JSONè½¬æ¢å™¨ -->
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestGsonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd hh:mm:ss"/>
    </forest:converter>

    <!-- è®¾ç½®XMLè½¬æ¢å™¨ -->
    <forest:converter dataType="xml" class="com.dtflys.forest.converter.xml.ForestJaxbConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
    
</forest:configuration>
```
1. ä½¿ç”¨forest:configurationæ ‡ç­¾åˆ›å»ºåœ¨Springä¸­çš„ForestConfiguration Bean
2. ä½¿ç”¨forest:varæ ‡ç­¾å®šä¹‰å˜é‡

   æ³¨æ„ï¼š***å˜é‡çš„ä½œç”¨åŸŸä¸ºè¯¥ForestConfigurationä¹‹ä¸‹ï¼Œæ‰€æœ‰è·Ÿè¿™ä¸ªé…ç½®å¯¹è±¡ç»‘å®šçš„Clientéƒ½èƒ½è®¿é—®åˆ°å…¶ä¸‹çš„å˜é‡ï¼Œè€Œåˆ«çš„ForestConfigurationä¸‹å®šä¹‰çš„å˜é‡ä¸èƒ½è®¿é—®ã€‚***

#### åˆ›å»ºClient Bean

åˆ›å»ºClient Beanæœ‰ä¸¤ç§æ–¹å¼

1. é€šè¿‡forest:clientæ ‡ç­¾åˆ›å»ºå•ä¸ªClient Bean

```xml
   <forest:client id="siteAClient" configuration="config0" class="com.xxx.client.SiteAClient"/>
```

2. é€šè¿‡forest:scanæ ‡ç­¾åˆ¶å®šback-packageçš„æ–¹å¼æ‰¹é‡åˆ›å»ºClient Bean

```xml
    <forest:scan configuration="config0" base-package="com.xxx.client"/>
```

