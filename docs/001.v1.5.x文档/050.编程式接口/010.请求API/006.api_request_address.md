---
title: ğŸ”® è¯·æ±‚åœ°å€
date: 2022-07-14 12:36:38
permalink: /pages/1.5.x/api_request_address/
---

## URLåœ°å€

ForestRequest å¯¹è±¡æä¾›è®¾ç½®/è·å–URLåœ°å€çš„æ¥å£æ–¹æ³•

`url(String url)` è®¾ç½®è¯·æ±‚URL
- å‚æ•° `url` : URLå­—ç¬¦ä¸²

`url(ForestURL url)` è®¾ç½®è¯·æ±‚URL
- å‚æ•° `url` : ForestURL ç±»å®ä¾‹

```java
// è®¾ç½®è¯·æ±‚URLåœ°å€ï¼Œurl: http://127.0.0.1:8080/test
request.url("http://127.0.0.1:8080/test");
// è®¾ç½®è·¯å¾„ä¸º /abc, ä¸»æœºåœ°å€å’Œç«¯å£éƒ¨åˆ†ä¿ç•™ï¼Œurl: http://127.0.0.1:8080/abc
request.url("/abc");
// è¦†ç›–æ‰æ•´ä¸ªURLåœ°å€ï¼Œurl: http://forest.dtflyx.com/111
request.url("http://forest.dtflyx.com/111");
// ä½¿ç”¨ ForestURL ç±»å‹å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œurl: http://localhost:8080/222
request.url(new ForestURL(new URL("http://localhost:8080/222")));
```

`host(String host)` è®¾ç½®URLçš„ä¸»æœºå/åŸŸå/IPåœ°å€éƒ¨åˆ†
- å‚æ•° `host` : ä¸»æœºå/åŸŸå/IPåœ°å€

```java
// ä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„ä¸»æœºå/IPåœ°å€/åŸŸåéƒ¨åˆ†ï¼Œurl: http://127.0.0.1:8080/222
request.host("127.0.0.1");
// åŒä¸Šï¼Œä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„ä¸»æœºå/IPåœ°å€/åŸŸåéƒ¨åˆ†
        request.url().setHost("127.0.0.1");
```

`port(int port)` è®¾ç½®URLä¸­çš„ç«¯å£
- å‚æ•° `port` : ç«¯å£å·

```java
// ä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„ç«¯å£å·ï¼Œurl: http://127.0.0.1:8888/222
request.port(8888);
// åŒä¸Šï¼Œä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„ç«¯å£å·
        request.url().setPort(8888);
```

`scheme(String scheme)` è®¾ç½®URLä¸­çš„HTTPåè®®å¤´
- å‚æ•° `scheme` : HTTPåè®®å¤´

```java
// ä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„HTTPåè®®å¤´ï¼Œurl: https://127.0.0.1:8888/222
request.scheme("https");
// åŒä¸Šï¼Œä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„HTTPåè®®å¤´
request.url().setScheme("https");
```

`path(String path)` è®¾ç½®URLè·¯å¾„
- å‚æ•° `path` : URLè·¯å¾„

```java
// ä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„è·¯å¾„éƒ¨åˆ†ï¼Œå’Œurlæ–¹æ³•ç±»ä¼¼ï¼Œä½†pathæ–¹æ³•ä¸æ¥å—å®Œæ•´urlåœ°å€ä½œä¸ºå‚æ•°ï¼Œurl: https://127.0.0.1:8888/333
request.path("/333");
// åŒä¸Šï¼Œä¿®æ”¹è¯·æ±‚åœ°å€ä¸­çš„è·¯å¾„éƒ¨åˆ†
        request.url().setPath("/333");
```

`ref(String ref)` è®¾ç½®Reference, å³URLäº•å·åé¢çš„å­—ç¬¦ä¸²
- å‚æ•° `ref`: URLäº•å·åé¢çš„å­—ç¬¦ä¸²

```java
// è®¾ç½®Referenceï¼Œå³URLäº•å·åé¢çš„å­—ç¬¦ä¸²ï¼Œurl: https://127.0.0.1:8888/333#hello
request.ref("hello");
```

## è·å–URLåœ°å€

`urlString()` è·å–è¯·æ±‚URLå­—ç¬¦ä¸²
- è¿”å›å€¼ : URLå­—ç¬¦ä¸²

`url()` è·å–è¯·æ±‚URL
- è¿”å›å€¼ : ForestURL ç±»å®ä¾‹

```java
// è·å–URLåœ°å€å­—ç¬¦ä¸²
// å¦‚ï¼šhttp://localhost:8080/test
String urlStr = request.urlString();
// è·å–ForestURLç±»å¯¹è±¡
ForestURL url = request.url();
```

`schema()` è·å–è¯·æ±‚åœ°å€çš„HTTPåè®®å¤´
- è¿”å›å€¼ : HTTPåè®®å¤´

```java
// è·å–URLåœ°å€çš„HTTPåè®®å¤´
String schema = request.scheme();
```

`host()` è·å–URLä¸­çš„ä¸»æœºå/åŸŸå/IPåœ°å€éƒ¨åˆ†
- è¿”å›å€¼ : ä¸»æœºå/åŸŸå/IPåœ°å€éƒ¨åˆ†å­—ç¬¦ä¸²

```java
// è·å–è¯·æ±‚åœ°å€ä¸­çš„ä¸»æœºå/IPåœ°å€/åŸŸåéƒ¨åˆ†
String host = request.host();
// åŒä¸Šï¼Œè·å–è¯·æ±‚åœ°å€ä¸­çš„ä¸»æœºå/IPåœ°å€/åŸŸåéƒ¨åˆ†
host = request.url().getHost();
```

`port()` è·å–URLä¸­çš„ç«¯å£å·
- è¿”å›å€¼ : int æ•´æ•°, URLä¸­çš„ç«¯å£å·

```java
// è·å–è¯·æ±‚åœ°å€ä¸­çš„ç«¯å£å·
// å¦‚ï¼š8080
// é»˜è®¤ä¸º -1, å³æ²¡æœ‰ç«¯å£å·
// æ²¡æœ‰ç«¯å£å·ä¹Ÿå¯ä»¥ç†è§£ä¸º http ä¸‹çš„ 80 å’Œ https ä¸‹çš„ 443
int port = request.port();
// åŒä¸Šï¼Œè·å–è¯·æ±‚åœ°å€ä¸­çš„ç«¯å£å·
port = request.url().getPort();
```

`path()` è·å–URLè·¯å¾„
- è¿”å›å€¼: URLè·¯å¾„

```java
// è·å–è¯·æ±‚åœ°å€ä¸­çš„è·¯å¾„éƒ¨åˆ†ï¼Œå¦‚ï¼š/test
String path = request.path();
// åŒä¸Šï¼Œè·å–è¯·æ±‚åœ°å€ä¸­çš„è·¯å¾„éƒ¨åˆ†
path = request.url().getPath();
```

> `ref()` è·å–Reference, å³URLäº•å·åé¢çš„å­—ç¬¦ä¸²
>- è¿”å›å€¼: URLäº•å·åé¢çš„å­—ç¬¦ä¸²


```java
// è·å–Referenceï¼Œå³URLäº•å·åé¢çš„å­—ç¬¦ä¸²
// å¦‚ï¼šhttp://localhost/test#hello ä¸­çš„ hello é‚£éƒ¨åˆ†å­—ç¬¦ä¸²
request.ref(); 
```

## ä¸»æœºåœ°å€

ä¸»æœºåœ°å€åŒ…å«: ä¸»æœºå/IPåœ°å€/åŸŸå + ç«¯å£å·

ä½¿ç”¨ address æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œåªä¼šä¿®æ”¹ä¸»æœºåæˆ–ç«¯å£ï¼Œä¸ä¼šå½±å“URLçš„å…¶å®ƒéƒ¨åˆ†ï¼ˆæ¯”å¦‚ Query å‚æ•°ï¼ŒHTTPåè®®å¤´ï¼Œè·¯å¾„éƒ¨åˆ†ç­‰ç­‰ï¼‰

> `address(String host, int port)` è®¾ç½®è¯·æ±‚çš„ä¸»æœºåœ°å€(ä¸»æœºå/åŸŸå/IPåœ°å€ + ç«¯å£å·)
>- å‚æ•° `host`: ä¸»æœºå/åŸŸå/IPåœ°å€
>- å‚æ•° `port`: ç«¯å£å·

```java
// åˆ›å»ºæ–°çš„è¯·æ±‚å¯¹è±¡
// url: http://localhost/test
Forest.get("/test")
     // è®¾ç½®è¯·æ±‚ä¸»æœºåœ°å€ï¼Œä¸ä¼šæ”¹å˜URLåœ°å€çš„å…¶å®ƒéƒ¨åˆ†
     // å‚æ•°1ï¼šä¸»æœºå/IPåœ°å€/åŸŸå
     // å‚æ•°2ï¼šç«¯å£å·
     // url: http://192.168.0.1:8881/test
    .address("192.168.0.1", 8881)
     // åŒä¸Šï¼Œè®¾ç½®è¯·æ±‚ä¸»æœºåœ°å€
     // å‚æ•°ä¸º ForestAddress å¯¹è±¡
     // url: http://192.168.0.2:8882/test
    .address(new ForestAddress("192.168.0.2", 8882));
```


## URLå‚æ•°

URLå‚æ•°ï¼Œä¹Ÿç§°ä¸ºQuery (æŸ¥è¯¢å‚æ•°)ï¼Œæ˜¯è·Ÿéšåœ¨URLåœ°å€ä¸­ `?` åçš„å­—ç¬¦ä¸²ï¼Œå¸¸ä»¥ `key=value` çš„é”®å€¼å¯¹å½¢å¼å‡ºç°ï¼Œç”¨äºå‘æœåŠ¡ç«¯ä¼ é€’æ•°æ®ã€‚

ForestRequest å¯¹è±¡æä¾›äº†æ·»åŠ å’Œä¿®æ”¹ Query å‚æ•°çš„æ–¹æ³•

### æ·»åŠ å‚æ•°

> addQuery(String name, Object value) æ·»åŠ Queryå‚æ•°
>- å‚æ•° `name`: Queryå‚æ•°å
>- å‚æ•° `value`: Queryå‚æ•°å€¼

```java
Forest.get("/")
        .addQuery("a", 1)  // æ·»åŠ  Query å‚æ•° a=1
        .addQuery("b", 2); // æ·»åŠ  Query å‚æ•° b=2
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2
```
é€‚ç”¨ ForestRequest.addQuery æ–¹æ³•å¯ä»¥é‡å¤æ·»åŠ é‡å Query å‚æ•°ã€‚
æ­¤åŠŸèƒ½å¯ç”¨äºä¼ é€’æ•°ç»„

```java

request.addQuery("a", 1)  // æ·»åŠ  Query å‚æ•° a=1
       .addQuery("a", 2)  // æ·»åŠ  Query å‚æ•° a=2
       .addQuery("a", 3); // æ·»åŠ  Query å‚æ•° a=3
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&a=2&a=3
```

### æ·»åŠ Mapå‚æ•°

> addQuery(Map queryMap) æ·»åŠ Mapç±»å‹Queryå‚æ•°
>- å‚æ•° `queryMap`: Mapå¯¹è±¡

```java
Map<String, Object> map = new HashMap();
map.put("a", 1);
map.put("b", 2);
request.addQuery(map)  // æ·»åŠ  Map å¯¹è±¡åˆ° Query å‚æ•°ä¸­
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2
```

### æ·»åŠ å¯¹è±¡å‚æ•°

> addQuery(Object queryParameters) æ·»åŠ Javaå¯¹è±¡ç±»å‹Queryå‚æ•°
>- å‚æ•° `queryParameters`: ä»»æ„ç±»å‹Javaå¯¹è±¡

```java
// è‡ªå®šä¹‰ä¸€ä¸ªæ™®é€šçš„Javaæ•°æ®ç±»
public class MyQuery {
    private int a;
    private int b;
    // getter å’Œ setter ä»£ç ï¼ˆçœç•¥ï¼‰
}

// åˆ›å»ºè‡ªå®šä¹‰çš„Javaå¯¹è±¡å®ä¾‹
MyQuery myQuery = new MyQuery();
myQuery.setA(1);
myQuery.setB(2);
request.addQuery(myQuery)  // æ·»åŠ  Java å¯¹è±¡åˆ° Query å‚æ•°ä¸­
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2
```



### å¼ºåˆ¶ç¼–ç 

:::warnging æ³¨æ„
ä½¿ç”¨ `addQuery(String name, String value)` æ–¹æ³•æ—¶, ç»å¤§éƒ¨åˆ†Queryå‚æ•°å€¼éƒ½ä¼šè¢«è‡ªåŠ¨UrlEncodeç¼–ç ï¼Œä½†æœ‰æŸäº›ç‰¹æ®Šçš„å‚æ•°å€¼ä¸ä¼šè¢«ç¼–ç ï¼Œå¦‚: `http://www.baidu.com` è¿™æ ·çš„urlåœ°å€ä¼šè¢«åŸå°ä¸åŠ¨ä¿ç•™ã€‚

è¿™æ—¶å€™éœ€è¦ä½¿ç”¨ `addQuery(String name, String value, boolean isUrlEncode, String charset)` æ–¹æ³•æ¥å¼ºåˆ¶UrlEncodeã€‚
:::

> `addQuery(String name, String value, boolean isUrlEncode, String charset)` æ·»åŠ Queryå‚æ•°
>- å‚æ•° `name`: Queryå‚æ•°å
>- å‚æ•° `value`: Queryå‚æ•°å€¼
>- å‚æ•° `isUrlEncode`: æ˜¯å¦å¼ºåˆ¶UrlEncode
>- å‚æ•° `charset`: ç¼–ç å­—ç¬¦é›†


```java
Forest.get("http://127.0.0.1:8080/")
         // ä¸å¼ºåˆ¶UrlEncode
        .addQuery("url1", "http://localhost/test");
         // å¼ºåˆ¶UrlEncode
        .addQuery("url2", "http://localhost/test", true, "UTF-8");
// æœ€ç»ˆurlä¸º
// http://127.0.0.1:8080/?url1=http://localhost/test&url2=http%3A%2F%2Flocalhost%2Ftest
```

### ä¿®æ”¹å‚æ•°

ä¿®æ”¹å·²å­˜åœ¨çš„ Query å‚æ•°

> `replaceQuery(String name, Object value)` æ›¿æ¢Queryå‚æ•°å€¼
>- å‚æ•° `name`: Queryå‚æ•°å
>- å‚æ•° `value`: Queryå‚æ•°å€¼

```java
request.addQuery("a", 1)      // æ·»åŠ  Query å‚æ•° a=1
       .replaceQuery("a", 2); // ä¿®æ”¹ Query å‚æ•° a=2
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=2
```

ForestRequest.replaceQuery å¯ä»¥æ–¹æ³•ä¿®æ”¹ Query å‚æ•°ï¼Œä½†å¯¹äºè¿˜ä¸å­˜åœ¨çš„ Query å‚æ•°å°±æ— æ³•å¤„ç†äº†

```java
// åˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚å¯¹è±¡
// url: http://localhost/
Forest.get("/")
       // è¿™æ—¶å€™è¿˜ä¸å­˜åœ¨ Query å‚æ•° a
       // æ‰€ä»¥æ­¤æ—¶è°ƒç”¨ replaceQuery æ˜¯æ— æ•ˆçš„
      .replaceQuery("a", "1");
// æœ€ååœ°å€è¿˜æ˜¯ä¸º http://localhost/
```

è¿™æ—¶å€™å¯ä»¥ç”¨ ForestRequest.replaceOrAddQuery æ–¹æ³•ï¼Œå®ƒåœ¨ Query å‚æ•°ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ·»åŠ å‚æ•°ï¼Œåœ¨å·²å­˜åœ¨çš„æƒ…å†µä¸‹ä¿®æ”¹å‚æ•°

> `replaceOrAddQuery(String name, String value)` æ›¿æ¢æˆ–æ·»åŠ Queryå‚æ•°
>- å‚æ•° `name`: Queryå‚æ•°å
>- å‚æ•° `value`: Queryå‚æ•°å€¼

```java
// åˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚å¯¹è±¡
// url: http://localhost/
Forest.get("/");
      .replaceOrAddQuery("a", "1")  // æ·»åŠ æˆ–ä¿®æ”¹ Query å‚æ•° a=1
      .addQuery("b", "2")           // ä¿®æ”¹ Query å‚æ•° a=2
      .replaceOrAddQuery("b", "3"); // æ·»åŠ æˆ–ä¿®æ”¹ Query å‚æ•° b=3
// æœ€ååœ°å€è¿˜æ˜¯ä¸º http://localhost/?a=1&b=3
```

### æ•°ç»„å‚æ•°

æœ‰äº›æ—¶å€™ï¼Œéœ€è¦é€šè¿‡URLå‚æ•°ä¼ é€’ä¸€ä¸ªæ•°ç»„æˆ–è€…ä¸€ä¸ªåˆ—è¡¨

```java
// æ·»åŠ åˆ—è¡¨åˆ°Queryå‚æ•°
List<Integer> list = Arrays.asList(1, 2, 3);
Forest.get("/")
     .addQuery("a", list)
     .execute();
// queryå‚æ•°ä¸º a=1&a=2&a=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•°
Object[] array = new Object[] {1, 2, 3};
Forest.get("/")
     .addQuery("a", array)
     .execute();
// Queryå‚æ•°ä¸º a=1&a=2&a=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•° (å¯å˜å‚æ•°)
Forest.get("/")
     .addQuery("a", 1, 2, 3)
     .execute();
// Queryå‚æ•°ä¸º a=1&a=2&a=3
```

å¸¦æ–¹æ‹¬å·`[]`å‚æ•°åçš„æ ·å¼

```java
// æ·»åŠ åˆ—è¡¨åˆ°Queryå‚æ•°
List<Integer> list = Arrays.asList(1, 2, 3);
Forest.get("/")
     .addArrayQuery("a", list)
     .execute();
// queryå‚æ•°ä¸º a[]=1&a[]=2&a[]=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•°
Object[] array = new Object[] {1, 2, 3};
Forest.get("/")
     .addArrayQuery("a", array)
     .execute();
// Queryå‚æ•°ä¸º a[]=1&a[]=2&a[]=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•° (å¯å˜å‚æ•°)
Forest.get("/")
     .addArrayQuery("a", 1, 2, 3)
     .execute();
// Queryå‚æ•°ä¸º a[]=1&a[]=2&a[]=3
```

### JSONå‚æ•°

å¦‚æœä¸æƒ³ä»¥URLå‚æ•°çš„æ ‡å‡†æ ¼å¼ä¼ é€’åˆ—è¡¨ï¼ŒJSONå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©

> `addJSONQuery(String name, Object value)` æ·»åŠ  JSON Query å‚æ•°
>- å‚æ•°`name`:  Queryå‚æ•°å
>- å‚æ•°`value`: Queryå‚æ•°å€¼ï¼Œå°†è¢«åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²

```java
// æ·»åŠ åˆ—è¡¨åˆ°Queryæ•°ç»„å‚æ•°
Forest.get("/")
     .addJSONQuery("a", Arrays.asList(1, 2, 3))
     .execute();
// queryå‚æ•°ä¸º a=[1,2,3]
// æ³¨æ„ï¼šè¿™é‡Œçš„JSONæ•°æ®æœ€ç»ˆä¼šè¢« URLEncode
// æ‰€ä»¥æœ€ç»ˆè¯·æ±‚çš„å‚æ•°ä¸º a=%5B1%2C2%2C3%5D
```


### è·å–å‚æ•°

è·å–è¯·æ±‚çš„æ•´ä¸ª Query å‚æ•°è¡¨

> `getQuery()` è·å–è¯·æ±‚çš„Queryå‚æ•°è¡¨
>- è¿”å›å€¼:  Queryå‚æ•°è¡¨ï¼ŒForestQueryMap ç±»å®ä¾‹

```java
// æ„å»ºè¯·æ±‚
// Query å‚æ•°ä¸º a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2)
        .addQuery("b", 3);
// è·å– Query å‚æ•°è¡¨
ForestQueryMap queries = request.getQuery();
// è¿”å›å‚æ•°ä¸º a=1 çš„ ForestQueryParameter å¯¹è±¡
ForestQueryParameter param1 = queries.getQuery("a");
// è¿”å›åŒ…å« b=2å’Œb=3 çš„ ForestQueryParameter å¯¹è±¡åˆ—è¡¨
List<ForestQueryParameter> params = queries.getQueries("b"); 
```

è·å–å•ä¸ª Query å‚æ•°

> `getQuery(String name)` æ ¹æ®åç§°è·å–è¯·æ±‚çš„Queryå‚æ•°å€¼
>- å‚æ•°`name`: Queryå‚æ•°åç§°
>- è¿”å›å€¼: Queryå‚æ•°å€¼

```java
// æ„å»ºè¯·æ±‚
// Query å‚æ•°ä¸º a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2);

request.getQuery("a"); // è·å– 1
request.getQuery("b"); // è·å– 2
```

è·å–æ•´ä¸ªè¯·æ±‚çš„ Query å‚æ•°å­—ç¬¦ä¸²

> `getQueryString()` è·å–è¯·æ±‚çš„URL Queryå‚æ•°å­—ç¬¦ä¸²
>- è¿”å›å€¼: Queryå‚æ•°å­—ç¬¦ä¸²

```java
// æ„å»ºè¯·æ±‚
// Query å‚æ•°ä¸º a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2)
        .addQuery("c", 3);

request.getQueryString(); // è·å– a=1&b=2&c=3
```
