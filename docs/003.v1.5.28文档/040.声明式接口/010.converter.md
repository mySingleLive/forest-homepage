---
id: converter
title: ğŸ› æ•°æ®è½¬æ¢
date: 2022-07-01 12:44:20
permalink: /pages/1.5.28/converter/
---

Forestæ”¯æŒJSONã€XMLã€æ™®é€šæ–‡æœ¬ç­‰æ•°æ®è½¬æ¢å½¢å¼ã€‚ä¸éœ€è¦æ¥å£è°ƒç”¨è€…è‡ªå·±å†™å…·ä½“çš„æ•°æ®è½¬æ¢ä»£ç 

## åºåˆ—åŒ–

å‡ ä¹æ‰€æœ‰æ•°æ®æ ¼å¼çš„è½¬æ¢éƒ½åŒ…å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ŒForestçš„æ•°æ®è½¬æ¢åŒæ ·å¦‚æ­¤

**åºåˆ—åŒ–**æ˜¯æŒ‡ï¼Œå°†åŸå§‹çš„ Java ç±»å‹æ•°æ®å¯¹è±¡è½¬åŒ–ä¸º HTTP è¯·æ±‚æƒ³è¦å‘é€çš„æ•°æ®æ ¼å¼ï¼ˆå¦‚ï¼š**JSON**ã€**XML**ã€**Protobuf** ç­‰ï¼‰

### Content-Type è¯·æ±‚å¤´

Forestä¸­å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å¯ä»¥é€šè¿‡æŒ‡å®š`contentType`å±æ€§æˆ–`Content-Type`å¤´æŒ‡å®šå†…å®¹æ ¼å¼

```java{3}
@Post(
        url = "http://localhost:8080/hello/user",
        contentType = "application/json"    // æŒ‡å®šcontentTypeä¸ºapplication/json
)
String postJson(@Body MyUser user);   // è‡ªåŠ¨å°†userå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONæ ¼å¼
```

åŒç†ï¼ŒæŒ‡å®šä¸º`application/xml`ä¼šå°†å‚æ•°åºåˆ—åŒ–ä¸º`XML`æ ¼å¼ï¼Œ`text/plain`åˆ™ä¸ºæ–‡æœ¬ï¼Œé»˜è®¤çš„`application/x-www-form-urlencoded`åˆ™ä¸ºè¡¨æ ¼æ ¼å¼ã€‚

### è¯·æ±‚ä½“ç±»å‹

æˆ–è€…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`@BodyType`æ³¨è§£æŒ‡å®š`type`å±æ€§

```java{4}
// è‡ªåŠ¨å°†userå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONæ ¼å¼
// ä½†æ­¤æ–¹å¼ä¸ä¼šåœ¨è¯·æ±‚ä¸­å¸¦æœ‰ Content-Type è¯·æ±‚å¤´
@Post("http://localhost:8080/hello/user")
@BodyType("json")
String postJson(@Body MyUser user);
```

`@BodyType`çš„å…·ä½“ä½¿ç”¨æ–¹å¼ï¼Œè¯·å‚è§ã€Š[@BodyType æ³¨è§£](/pages/1.5.28/http_body/#bodytype-æ³¨è§£)ã€‹

### Encoder

é€šè¿‡`@BodyType`çš„`encoder`å±æ€§è®¾ç½®ä¸€ä¸ªå…·ä½“çš„è½¬æ¢å™¨ç±»

```java{3}
// æŒ‡å®šä»…ä»…ä½¿ç”¨ Jackson è½¬æ¢å™¨æ¥åºåˆ—åŒ–æ•°æ®
@Post("http://localhost:8080/hello/user")
@BodyType(type = "json", encoder = ForestJacksonConverter.class)
String postJson(@Body MyUser user);
```

:::tip æç¤º
åœ¨æ–¹æ³•ä¸æŒ‡å®š Encoder çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå»æ‰¾æ¥å£ä¸Šæœ‰æ²¡æœ‰è®¾ç½® Encoderï¼Œå¦‚æ¥å£ä¸Šä¹Ÿæ²¡æœ‰åˆ™ä½¿ç”¨å…¨å±€çš„è½¬æ¢å™¨ä¸ºæ”¹æ–¹æ³•è¯·æ±‚çš„ Encoder
:::

## ååºåˆ—åŒ–

**ååºåˆ—åŒ–**åˆ™æ˜¯æ­£å¥½ä¸**åºåˆ—åŒ–**çš„é€†è¿‡ç¨‹ï¼Œæ˜¯å°†è¿œç«¯æœåŠ¡æ¥å—åˆ°çš„åŸå§‹æ•°æ®æ ¼å¼ï¼ˆå¦‚ï¼š**JSON**ã€**XML**ã€**Protobuf** ç­‰ï¼‰è½¬æ¢ä¸ºåœ¨ Java ç¨‹åºä¸­å¯ä»¥æ–¹ä¾¿è¯»å–æ“ä½œçš„ Java æ•°æ®å¯¹è±¡

Forest æä¾›äº†å¤šç§ååºåˆ—åŒ–çš„æ–¹å¼

### è‡ªåŠ¨è¯†åˆ«ç»“æœæ•°æ®ç±»å‹

Forest ä¼šå°†æ ¹æ®è¿”å›ç»“æœè‡ªåŠ¨è¯†åˆ«å“åº”çš„æ•°æ®æ ¼å¼ï¼Œå¹¶è¿›è¡Œååºåˆ—åŒ–è½¬æ¢

```java
// å¦‚ç»“æœæ˜¯ä¸€ä¸²ç±»ä¼¼ {"a": 1, "b": 2} å½¢å¼çš„JSONå­—ç¬¦ä¸²
// åˆ™ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶è¿›è¡Œè½¬æ¢

@Get("http://localhost:8080/data")
Map getDataAsMap();  // è‡ªåŠ¨è¯†åˆ«è½¬æ¢ä¸º Map å¯¹è±¡

@Get("http://localhost:8080/data")
MyData getMyData();  // è‡ªåŠ¨è¯†åˆ«è½¬æ¢ä¸ºè‡ªå®šä¹‰ç±»å‹å¯¹è±¡

// å¦‚ç»“æœæ˜¯ä¸€ä¸² XML å­—ç¬¦ä¸²
// ä¹Ÿèƒ½è‡ªåŠ¨è¯†åˆ«å¹¶è½¬æ¢
// ä½†å‰ææ˜¯è‡ªå®šä¹‰çš„ç±»å‹è¦æœ‰ JAXB æ³¨è§£æ ‡æ³¨        
MyXmlData getXmlData();

// å¦‚æœç»“æœæ˜¯ä¸€ä¸²ç±»ä¼¼ [{"name": "xxx"}, {"name": "yyy"}] æ ¼å¼çš„ JSON æ•°ç»„å­—ç¬¦ä¸²
// Forest ä¹Ÿä¸€æ ·èƒ½è‡ªåŠ¨è¯†åˆ«å¹¶è½¬æ¢ä¸º Java é›†åˆå¯¹è±¡
@Get("http://localhost:8080/data/list")
List<MyData> getDataList();
```

### æŒ‡å®šç»“æœæ•°æ®ç±»å‹

æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡`dataType`æŒ‡å®šè¿”å›æ•°æ®çš„ååºåˆ—åŒ–æ ¼å¼

```java{3}
@Get(
    url = "http://localhost:8080/data",
    dataType = "json"        // æŒ‡å®šdataTypeä¸ºjsonï¼Œå°†æŒ‰JSONæ ¼å¼ååºåˆ—åŒ–æ•°æ®
)
Map getData();               // è¯·æ±‚å“åº”çš„ç»“æœå°†è¢«è½¬æ¢ä¸ºMapç±»å‹å¯¹è±¡
```

### Decoder

Forest ä¹Ÿå¯ä»¥é€šè¿‡è¯·æ±‚æ³¨è§£ (è¯¸å¦‚ï¼š`@Request`ã€`@Get`ã€`@Post` ç­‰) çš„`decoder`å±æ€§æ¥æŒ‡å®šå…·ä½“å¤„ç†è¯¥è¯·æ±‚ç»“æœçš„ååºåˆ—åŒ–çš„è½¬æ¢å™¨

```java{4}
// æŒ‡å®šç”± Jackson è½¬æ¢å™¨å¤„ç†è¯·æ±‚çš„ååºåˆ—åŒ–
@Get(
    url = "http://localhost:8080/data",
    decoder = ForestJacksonConverter.class
)
Map getData();
```

:::tip æç¤º
å’Œ Encoder ä¸€æ ·çš„é“ç†ï¼Œå¦‚æ–¹æ³•ä¸æŒ‡å®š Decoderï¼Œåˆ™ä¼šå»æ‰¾æ¥å£ä¸Šæœ‰æ²¡æœ‰è®¾ç½® Decoderï¼Œå¦‚æ¥å£ä¸Šä¹Ÿæ²¡æœ‰åˆ™ä½¿ç”¨å…¨å±€çš„è½¬æ¢å™¨ä¸ºæ”¹æ–¹æ³•è¯·æ±‚çš„ Decoder
:::


## è½¬æ¢å™¨

åœ¨Forestä¸­ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹éƒ½æœ‰Forestè½¬æ¢å™¨æ¥å®ç°ï¼Œå…¶æ•°æ®åœ¨Forestä¸­çš„è½¬æ¢è¿‡ç¨‹å¦‚å›¾æ‰€ç¤º:

<img class="img_margin img_shadow img_bg" src="/img/forest_converter.svg" alt="converter" />

Forestæä¾›äº†é»˜è®¤çš„è½¬æ¢å™¨ï¼Œå…¶åˆ†æˆäº”å¤§ç±»ï¼šæ–‡æœ¬è½¬æ¢å™¨ã€JSONè½¬æ¢å™¨ã€XMLè½¬æ¢å™¨ã€äºŒè¿›åˆ¶è½¬æ¢å™¨ã€è‡ªåŠ¨è½¬æ¢å™¨ã€‚
å„å¤§ç±»è¿˜å¯ä»¥ç»§ç»­ç»†åˆ†ä¸ºæ›´å…·ä½“çš„è½¬æ¢å™¨ï¼Œå¯ä»¥æŒ‰ç±»ç»§æ‰¿ç†è§£å…¶åˆ†ç±»ã€‚

è½¬æ¢å™¨çš„ç»§æ‰¿ä½“ç³»è¯·çœ‹å¦‚ä¸‹æ ‘çŠ¶ç»“æ„ï¼š

```
ForestConverteræ¥å£
 â”œâ”€â”€ DefaultTextConverterç±»
 â”œâ”€â”€ ForestJsonConverteræ¥å£
 |    â”œâ”€â”€ ForestFastjsonConverterç±»
 |    â”œâ”€â”€ ForestJacksonConverterç±»
 |    â””â”€â”€ ForestGsonConverterç±»
 â”œâ”€â”€ ForestXmlConverteræ¥å£
 |    â””â”€â”€ ForestJaxbConverterç±»
 â”œâ”€â”€ DefaultBinaryConverterç±»
 â””â”€â”€ DefaultAutoConverterç±»
```

å¯ä»¥æ›¿æ¢å’Œä½¿ç”¨çš„è½¬æ¢å™¨ç±»å¦‚ä¸‹è¡¨ï¼š

| è½¬æ¢å™¨ç±»                        |  ç±»å‹ | æè¿° |
| ------------------------------- | ----- | ---- |
| DefaultTextConverter            | text  | é»˜è®¤æ–‡æœ¬æ•°æ®è½¬æ¢å™¨ |
| ForestFastjsonConverter         | json  | åŸºäºFastjsonæ¡†æ¶çš„JSONè½¬æ¢å™¨ |
| ForestJacksonConverter          | json  | åŸºäºJacksonæ¡†æ¶çš„JSONè½¬æ¢å™¨ |
| ForestGsonConverter             | json  | åŸºäºGsonæ¡†æ¶çš„JSONè½¬æ¢å™¨ |
| ForestJaxbConverter             | xml   | åŸºäºJaxbæ¡†æ¶çš„XMLè½¬æ¢å™¨ |
| DefaultBinaryConverter          | binary| é»˜è®¤äºŒè¿›åˆ¶è½¬æ¢å™¨ï¼Œå¤šåœ¨æ–‡ä»¶ä¸‹è½½æ—¶ä½¿ç”¨ |
| DefaultAutoConverter            | auto  | è‡ªåŠ¨ç±»å‹è½¬æ¢å™¨ï¼Œå¯ä»¥æ ¹æ®å“åº”è¿”å›çš„æ•°æ®è‡ªåŠ¨å—…æ¢æ•°æ®ç±»å‹å¹¶ä½¿ç”¨å¯¹åº”çš„è½¬æ¢å™¨è¿›è¡Œè½¬æ¢ |


## é…ç½®å…¨å±€è½¬æ¢å™¨

åœ¨Forestä¸­å·²å®šä¹‰å¥½é»˜è®¤çš„è½¬æ¢å™¨ï¼Œæ¯”å¦‚JSONçš„é»˜è®¤è½¬ä¸ºå™¨ä¸º`ForestFastjsonConverter`ï¼Œå³`FastJson`çš„è½¬æ¢å™¨

<code-group>
<code-block title="Yaml" active>

```yaml
forest:
  # è½¬æ¢å™¨é…ç½®ï¼Œæ”¯æŒ json, xml, text, binary å››ç§æ•°æ®ç±»å‹çš„é…ç½®
  converters:
    # JSONè½¬æ¢å™¨
    json:
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºJacksonè½¬æ¢å™¨
      type: com.dtflys.forest.converter.json.ForestJacksonConverter
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºGSONè½¬æ¢å™¨
      # type: com.dtflys.forest.converter.json.ForestGsonConverter
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºFastjsonè½¬æ¢å™¨
      # type: com.dtflys.forest.converter.json.ForestFastjsonConverter
      
      # è½¬æ¢å™¨çš„å‚æ•°è®¾ç½®
      parameters:
        # JSONæ•°æ®è½¬æ¢å™¨çš„å…¨å±€æ—¥æœŸæ ¼å¼åŒ–é…ç½®
        dateFormat: yyyy/MM/dd HH:mm:ss
        
    # XMLè½¬æ¢å™¨
    xml:
      # é…ç½®ä¸ºJAXBè½¬æ¢å™¨
      type: com.dtflys.forest.converter.xml.ForestJaxbConverter

    # äºŒè¿›åˆ¶è½¬æ¢å™¨
    binary:
      # é…ç½®ä¸ºForesté»˜è®¤äºŒè¿›åˆ¶è½¬æ¢å™¨
      type: com.dtflys.forest.converter.binary.DefaultBinaryConverter

    # æ–‡æœ¬è½¬æ¢å™¨
    text:
      # é…ç½®ä¸ºForesté»˜è®¤æ–‡æœ¬è½¬æ¢å™¨
      type: com.dtflys.forest.converter.text.DefaultTextConverter
```

</code-block>

<code-block title="Properties">

```properties
# è½¬æ¢å™¨é…ç½®ï¼Œæ”¯æŒ json, xml, text, binary å››ç§æ•°æ®ç±»å‹çš„é…ç½®

# JSONè½¬æ¢å™¨
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºJacksonçš„è½¬æ¢å™¨
forest.converters.json.type=com.dtflys.forest.converter.json.ForestJacksonConverter
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºGSONè½¬æ¢å™¨
# forest.converters.json.type=com.dtflys.forest.converter.json.ForestGsonConverter
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºFastjsonè½¬æ¢å™¨
# forest.converters.json.type=com.dtflys.forest.converter.json.ForestFastjsonConverter
      
# è½¬æ¢å™¨çš„å‚æ•°è®¾ç½®
# JSONæ•°æ®è½¬æ¢å™¨çš„å…¨å±€æ—¥æœŸæ ¼å¼åŒ–é…ç½®
forest.converters.json.parameters.dateFormat: yyyy/MM/dd HH:mm:ss
        
# XMLè½¬æ¢å™¨
# é…ç½®ä¸ºJAXBè½¬æ¢å™¨
forest.converters.xml.type=com.dtflys.forest.converter.xml.ForestJaxbConverter

# äºŒè¿›åˆ¶è½¬æ¢å™¨
# é…ç½®ä¸ºForesté»˜è®¤äºŒè¿›åˆ¶è½¬æ¢å™¨
forest.converters.binary.type: com.dtflys.forest.converter.binary.DefaultBinaryConverter

# æ–‡æœ¬è½¬æ¢å™¨
# é…ç½®ä¸ºForesté»˜è®¤æ–‡æœ¬è½¬æ¢å™¨
forest.converters.text.type: com.dtflys.forest.converter.text.DefaultTextConverter
```

</code-block>
<code-block title="Spring">

```xml
<forest:configuration>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ å¼€å§‹ -->
    <!-- è®¾ç½®JSONè½¬æ¢å™¨ -->
    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºJacksonçš„è½¬æ¢å™¨ -->
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestJacksonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd HH:mm:ss"/>
    </forest:converter>
    
    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºGSONè½¬æ¢å™¨ -->
    <!--
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestGsonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd HH:mm:ss"/>
    </forest:converter>
    -->

    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºFastjsonè½¬æ¢å™¨ -->
    <!--
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestFastjsonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd HH:mm:ss"/>
    </forest:converter>
    -->

    <!-- è®¾ç½®XMLè½¬æ¢å™¨ -->
    <forest:converter dataType="xml" class="com.dtflys.forest.converter.xml.ForestJaxbConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
</forest:configuration>
```

</code-block>
<code-block title="Java">

```java
// è·å–å…¨å±€é»˜è®¤é…ç½®å¯¹è±¡
ForestConfiguration configuration = Forest.config();
// æ›´æ¢JSONè½¬æ¢å™¨ä¸ºFastJson
configuration.setJsonConverter(new ForestFastjsonConverter());
// æ›´æ¢JSONè½¬æ¢å™¨ä¸ºJackson
configuration.setJsonConverter(new ForestJacksonConverter());
// æ›´æ¢JSONè½¬æ¢å™¨Gson
configuration.setJsonConverter(new ForestGsonConverter());
// æ›´æ¢XMLè½¬æ¢å™¨JAXB
configuration.getConverterMap().put(ForestDataType.XML, new ForestJaxbConverter());
```

</code-block>
</code-group>

## Springboot ä¸‹é…ç½®å…¨å±€è½¬æ¢å™¨

åœ¨ Springboot ç¯å¢ƒä¸‹ï¼Œå¯ä»¥æ— è§†ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªæ›´ç®€å•ã€æ›´çµæ´»ã€æ›´ Springboot çš„åšæ³•ï¼Œå³é€šè¿‡ `@Bean` æ³¨è§£å®šä¹‰çš„æ–¹æ³•è¿”å›ä¸€ä¸ª`ForestConverter`æ¥å£çš„ç°å®ç±»å®ä¾‹

### Fastjson è½¬æ¢å™¨

```java
@Bean
public ForestJsonConverter forestFastjsonConverter() {
    ForestFastjsonConverter converter = new ForestFastjsonConverter();
    // è®¾ç½®æ—¥æœŸæ ¼å¼
    converter.setDateFormat("yyyy-MM-dd HH:mm:ss");
    // è®¾ç½®åºåˆ—åŒ–ç‰¹æ€§
    converter.setSerializerFeature(SerializerFeature.IgnoreErrorGetter);
    return converter;
}
```

### Jackson è½¬æ¢å™¨

```java
@Bean
public ForestJsonConverter forestJacksonConverter() {
    ForestJacksonConverter converter = new ForestJacksonConverter();
    // è®¾ç½®æ—¥æœŸæ ¼å¼
    converter.setDateFormat("yyyy-MM-dd HH:mm:ss");
    // è·å– Jackson çš„ ObjectMapper å¯¹è±¡
    ObjectMapper mapper = converter.getMapper();
    // é€šè¿‡ ObjectMapper å¯¹è±¡å¯ä»¥å¯¹ Jackson è½¬æ¢å™¨åšæ›´ç»†è‡´çš„è®¾ç½®
    return converter;
}
```

### Gson è½¬æ¢å™¨

```java
@Bean
public ForestJsonConverter forestGsonConverter() {
    ForestGsonConverter converter = new ForestGsonConverter();
    // è®¾ç½®æ—¥æœŸæ ¼å¼
    converter.setDateFormat("yyyy-MM-dd HH:mm:ss");
    return converter;
}
```

:::warning æç¤º
å„ç±»è½¬æ¢å™¨ (å¦‚ JSONã€XMLè½¬æ¢å™¨) å…¨å±€çš„ Bean åªèƒ½æœ‰ä¸€ä¸ªï¼ŒåŒæ—¶å®šä¹‰äº†å¤šä¸ª ForestJsonConverter (ä»¥ JSON ä¸ºä¾‹) çš„ Bean åˆ° Spring ä¸Šä¸‹æ–‡ä¸­

åˆ™è¦é€šè¿‡ä¸Šæ–‡ä»‹ç»çš„[é…ç½®æ–¹å¼](/pages/1.5.28/converter/#é…ç½®å…¨å±€è½¬æ¢å™¨)æ¥æŒ‡å®šå…¨å±€è½¬æ¢å…·ä½“æ˜¯å“ªä¸€ä¸ª
:::

## é…ç½®æ¥å£/æ–¹æ³•çº§åˆ«è½¬æ¢å™¨

ä½¿ç”¨`@BodyType`æ³¨è§£å®šä¹‰**encoder** 

```java
// æ¥å£çº§åˆ«è½¬æ¢å™¨å®šä¹‰
@BodyType(type = "json", encoder = ForestJacksonConverter.class)
public interface MyClient {

    // æ–¹æ³•çº§åˆ«è½¬æ¢å™¨å®šä¹‰
    @Get("/data")
    @BodyType(type = "json", encoder = ForestFastjsonConverter.class)
    String sendData(@Body MyData data);
}
```

å…·ä½“ä½¿ç”¨æ–¹å¼ï¼Œè¯·å‚è§ã€Š[æŒ‡å®š Encoder](/pages/1.5.28/http_body/#æŒ‡å®š-encoder)ã€‹å’Œã€Š[JSON ç¼–ç å™¨å¿«æ·æ³¨è§£](/pages/1.5.28/http_body/#json-ç¼–ç å™¨å¿«æ·æ³¨è§£)ã€‹


## è‡ªå®šä¹‰è½¬æ¢å™¨

è¯·å‚è§ ã€Š[è‡ªå®šä¹‰è½¬æ¢å™¨](/pages/1.5.28/custom_converter/)ã€‹
