---
id: api_success
title: ğŸœ æˆåŠŸ/å¤±è´¥æ¡ä»¶
date: 2022-07-14 12:43:44
permalink: /pages/1.5.30/api_success/
---

Forest è¯·æ±‚æ¯æ¬¡å‘é€åéƒ½ä¼šåˆ¤æ–­æ˜¯å¦æˆåŠŸ (ä¸æˆåŠŸå³å¤±è´¥)

é»˜è®¤çš„è¯·æ±‚æˆåŠŸæ¡ä»¶å¦‚ä¸‹

[x] æ²¡æœ‰å¼‚å¸¸: åŒ…æ‹¬ç½‘ç»œè¿æ¥ä¸é€šã€IOé”™è¯¯ã€è¶…æ—¶ç­‰å¼‚å¸¸

[x] å“åº”çŠ¶æ€ç åœ¨æ­£å¸¸èŒƒå›´å†…: >= `100` å¹¶ä¸” < `400`

ä¸€èˆ¬æˆåŠŸçš„çŠ¶æ€ç ä¸º`200`, æ‰€ä»¥é»˜è®¤æˆåŠŸæ¡ä»¶æ»¡è¶³ç»å¤§å¤šæ•°åœºæ™¯ï¼Œä½†ä¹Ÿå…ä¸äº†æœ‰äº›APIæ¥å£ä¸ä»¥æ­¤ä¸ºæ ‡å‡†ï¼Œæ¯”å¦‚`400`ä¹Ÿä¸ºæ­£å¸¸çŠ¶æ€ç ; è¿˜æœ‰çŠ¶æ€ç ä¸º `200`, ä½†è¿”å›JSONæ•°æ®ä¸­çš„çŠ¶æ€ä¸ºå¤±è´¥ä¹Ÿä¸ºå¤±è´¥ã€‚

ä¸ºé€‚åº”è¿™ç§ï¼ŒForest æä¾›äº†å¯è‡ªå®šä¹‰çš„æˆåŠŸ/å¤±è´¥æ¡ä»¶

> `successWhen(SuccessWhen successWhen)` è®¾ç½®æˆåŠŸæ¡ä»¶: ç”¨äºåˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ/å¤±è´¥
>- å‚æ•°`successWhen`: SuccessWhen æ¥å£å®ç°ç±»å®ä¾‹

```java
Forest.post("/")
     // è®¾ç½®æˆåŠŸ/å¤±è´¥æ¡ä»¶
     // è¿”å› true ä¸ºæˆåŠŸï¼Œfalse ä¸ºå¤±è´¥
    .successWhen(((req, res) -> {
        // req ä¸ºForestè¯·æ±‚å¯¹è±¡ï¼Œå³ ForestRequest ç±»å®ä¾‹
        // res ä¸ºForestå“åº”å¯¹è±¡ï¼Œå³ ForestResponse ç±»å®ä¾‹
        return res.noException() &&   // è¯·æ±‚è¿‡ç¨‹æ²¡æœ‰å¼‚å¸¸
                res.statusOk() &&     // çŠ¶æ€ç åœ¨ 100 ~ 399 èŒƒå›´å†…
                res.statusIsNot(203); // ä½†ä¸èƒ½æ˜¯ 203
    }))
    .onError((ex, req, res) -> {
        System.out.println("å¤±è´¥!");
    })
    .exeute();
// è‹¥æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç ä¸º 203ï¼Œ 
// å³ä¾¿è¯·æ±‚è¿‡ç¨‹éƒ½æˆåŠŸï¼Œ
// ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯å¤±è´¥ï¼Œå¹¶æ‰§è¡Œ onError
```

ä½¿ç”¨è‡ªå®šä¹‰æˆåŠŸ/å¤±è´¥æ¡ä»¶å®ç°ç±»

> `setSuccessWhen(Class<? extends SuccessWhen> conditionClass)` è®¾ç½®æˆåŠŸæ¡ä»¶ï¼Œç”¨äºåˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ/å¤±è´¥
>- å‚æ•°`conditionClass`: SuccessWhen å®ç°ç±»çš„ Class å¯¹è±¡

å…ˆå®šä¹‰æˆåŠŸ/å¤±è´¥æ¡ä»¶å®ç°ç±»

```java
// è‡ªå®šä¹‰æˆåŠŸ/å¤±è´¥æ¡ä»¶å®ç°ç±»
// éœ€è¦å®ç° SuccessWhen æ¥å£
public class MySuccessCondition implements SuccessWhen {

    /**
     * è¯·æ±‚æˆåŠŸæ¡ä»¶
     * @param req Forestè¯·æ±‚å¯¹è±¡
     * @param res Forestå“åº”å¯¹è±¡
     * @return true è¯·æ±‚æˆåŠŸï¼Œfalse è¯·æ±‚å¤±è´¥
     */
    @Override
    public boolean successWhen(ForestRequest req, ForestResponse res) {
        return res.noException() &&   // è¯·æ±‚è¿‡ç¨‹æ²¡æœ‰å¼‚å¸¸
                res.statusOk() &&     // çŠ¶æ€ç åœ¨ 100 ~ 399 èŒƒå›´å†…
                res.statusIsNot(203); // ä½†ä¸èƒ½æ˜¯ 203
    }
}
```

é€šè¿‡ Forest è¯·æ±‚å¯¹è±¡çš„`setSuccessWhen(Class<? extends SuccessWhen> conditionClass)`æ–¹æ³•è®¾ç½®è¯¥æ¡ä»¶ç±»

```java
Forest.post("/")
     // è®¾ç½®æˆåŠŸ/å¤±è´¥æ¡ä»¶å®ç°ç±»
    .successWhen(MySuccessCondition.class)
    .onError((ex, req, res) -> {
        System.out.println("å¤±è´¥!");
    })
    .exeute();
// è‹¥æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç ä¸º 203ï¼Œ 
// å³ä¾¿è¯·æ±‚è¿‡ç¨‹éƒ½æˆåŠŸï¼Œ
// ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯å¤±è´¥ï¼Œå¹¶æ‰§è¡Œ onError
```
