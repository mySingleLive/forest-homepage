---
id: converter
title: ğŸ› æ•°æ®è½¬æ¢
date: 2022-07-01 12:44:20
permalink: /pages/1.5.x/converter/
---

Forestæ”¯æŒJSONã€XMLã€æ™®é€šæ–‡æœ¬ç­‰æ•°æ®è½¬æ¢å½¢å¼ã€‚ä¸éœ€è¦æ¥å£è°ƒç”¨è€…è‡ªå·±å†™å…·ä½“çš„æ•°æ®è½¬æ¢ä»£ç 

### åºåˆ—åŒ–

å‡ ä¹æ‰€æœ‰æ•°æ®æ ¼å¼çš„è½¬æ¢éƒ½åŒ…å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ŒForestçš„æ•°æ®è½¬æ¢åŒæ ·å¦‚æ­¤

Forestä¸­å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å¯ä»¥é€šè¿‡æŒ‡å®š`contentType`å±æ€§æˆ–`Content-Type`å¤´æŒ‡å®šå†…å®¹æ ¼å¼

```java

@Request(
        url = "http://localhost:8080/hello/user",
        type = "post",
        contentType = "application/json"    // æŒ‡å®šcontentTypeä¸ºapplication/json
)
String postJson(@Body MyUser user);   // è‡ªåŠ¨å°†userå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONæ ¼å¼
```

åŒç†ï¼ŒæŒ‡å®šä¸º`application/xml`ä¼šå°†å‚æ•°åºåˆ—åŒ–ä¸º`XML`æ ¼å¼ï¼Œ`text/plain`åˆ™ä¸ºæ–‡æœ¬ï¼Œé»˜è®¤çš„`application/x-www-form-urlencoded`åˆ™ä¸ºè¡¨æ ¼æ ¼å¼ã€‚

### ååºåˆ—åŒ–

HTTPè¯·æ±‚å“åº”åè¿”å›ç»“æœçš„æ•°æ®åŒæ ·éœ€è¦è½¬æ¢ï¼ŒForeståˆ™ä¼šå°†è¿”å›ç»“æœè‡ªåŠ¨è½¬æ¢ä¸ºæ‚¨é€šè¿‡æ–¹æ³•è¿”å›ç±»å‹æŒ‡å®šå¯¹è±¡ç±»å‹ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ååºåˆ—åŒ–ï¼Œæ‚¨å¯ä»¥é€šè¿‡`dataType`æŒ‡å®šè¿”å›æ•°æ®çš„ååºåˆ—åŒ–æ ¼å¼ã€‚

```java
@Request(
    url = "http://localhost:8080/data",
    dataType = "json"        // æŒ‡å®šdataTypeä¸ºjsonï¼Œå°†æŒ‰JSONæ ¼å¼ååºåˆ—åŒ–æ•°æ®
)
Map getData();               // è¯·æ±‚å“åº”çš„ç»“æœå°†è¢«è½¬æ¢ä¸ºMapç±»å‹å¯¹è±¡
```

### è½¬æ¢å™¨

åœ¨Forestä¸­ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹éƒ½æœ‰Forestè½¬æ¢å™¨æ¥å®ç°ï¼Œå…¶æ•°æ®åœ¨Forestä¸­çš„è½¬æ¢è¿‡ç¨‹å¦‚å›¾æ‰€ç¤º:

<img class="img_margin img_shadow" src="/img/doc/forest_converter.svg" alt="architecture" />

Forestæä¾›äº†é»˜è®¤çš„è½¬æ¢å™¨ï¼Œå…¶åˆ†æˆäº”å¤§ç±»ï¼šæ–‡æœ¬è½¬æ¢å™¨ã€JSONè½¬æ¢å™¨ã€XMLè½¬æ¢å™¨ã€äºŒè¿›åˆ¶è½¬æ¢å™¨ã€è‡ªåŠ¨è½¬æ¢å™¨ã€‚
å„å¤§ç±»è¿˜å¯ä»¥ç»§ç»­ç»†åˆ†ä¸ºæ›´å…·ä½“çš„è½¬æ¢å™¨ï¼Œå¯ä»¥æŒ‰ç±»ç»§æ‰¿ç†è§£å…¶åˆ†ç±»ã€‚

è½¬æ¢å™¨çš„ç»§æ‰¿ä½“ç³»è¯·çœ‹å¦‚ä¸‹æ ‘çŠ¶ç»“æ„ï¼š

```
ForestConverteræ¥å£
 â”œâ”€â”€ DefaultTextConverterç±»
 â”œâ”€â”€ ForestJsonConverteræ¥å£
 |    â”œâ”€â”€ ForestFastjsonConverterç±»
 |    â”œâ”€â”€ ForestJacksonConverterç±»
 |    â””â”€â”€ ForestGsonConverterç±»
 â”œâ”€â”€ ForestXmlConverteræ¥å£
 |    â””â”€â”€ ForestJaxbConverterç±»
 â”œâ”€â”€ DefaultBinaryConverterç±»
 â””â”€â”€ DefaultAutoConverterç±»
```

å¯ä»¥æ›¿æ¢å’Œä½¿ç”¨çš„è½¬æ¢å™¨ç±»å¦‚ä¸‹è¡¨ï¼š

| è½¬æ¢å™¨ç±»                        |  ç±»å‹ | æè¿° |
| ------------------------------- | ----- | ---- |
| DefaultTextConverter            | text  | é»˜è®¤æ–‡æœ¬æ•°æ®è½¬æ¢å™¨ |
| ForestFastjsonConverter         | json  | åŸºäºFastjsonæ¡†æ¶çš„JSONè½¬æ¢å™¨ |
| ForestJacksonConverter          | json  | åŸºäºJacksonæ¡†æ¶çš„JSONè½¬æ¢å™¨ |
| ForestGsonConverter             | json  | åŸºäºGsonæ¡†æ¶çš„JSONè½¬æ¢å™¨ |
| ForestJaxbConverter             | xml   | åŸºäºJaxbæ¡†æ¶çš„XMLè½¬æ¢å™¨ |
| DefaultBinaryConverter          | binary| é»˜è®¤äºŒè¿›åˆ¶è½¬æ¢å™¨ï¼Œå¤šåœ¨æ–‡ä»¶ä¸‹è½½æ—¶ä½¿ç”¨ |
| DefaultAutoConverter            | auto  | è‡ªåŠ¨ç±»å‹è½¬æ¢å™¨ï¼Œå¯ä»¥æ ¹æ®å“åº”è¿”å›çš„æ•°æ®è‡ªåŠ¨å—…æ¢æ•°æ®ç±»å‹å¹¶ä½¿ç”¨å¯¹åº”çš„è½¬æ¢å™¨è¿›è¡Œè½¬æ¢ |


### è®¾ç½®è½¬æ¢å™¨ 

åœ¨Forestä¸­å·²å®šä¹‰å¥½é»˜è®¤çš„è½¬æ¢å™¨ï¼Œæ¯”å¦‚JSONçš„é»˜è®¤è½¬ä¸ºå™¨ä¸º`ForestFastjsonConverter`ï¼Œå³`FastJson`çš„è½¬æ¢å™¨

<code-group>
<code-block title="Yaml" active>

```yaml
forest:
  # è½¬æ¢å™¨é…ç½®ï¼Œæ”¯æŒ json, xml, text, binary å››ç§æ•°æ®ç±»å‹çš„é…ç½®
  converters:
    # JSONè½¬æ¢å™¨
    json:
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºJacksonè½¬æ¢å™¨
      type: com.dtflys.forest.converter.json.ForestJacksonConverter
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºGSONè½¬æ¢å™¨
      # type: com.dtflys.forest.converter.json.ForestGsonConverter
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºFastjsonè½¬æ¢å™¨
      # type: com.dtflys.forest.converter.json.ForestFastjsonConverter
      
      # è½¬æ¢å™¨çš„å‚æ•°è®¾ç½®
      parameters:
        # JSONæ•°æ®è½¬æ¢å™¨çš„å…¨å±€æ—¥æœŸæ ¼å¼åŒ–é…ç½®
        dateFormat: yyyy/MM/dd hh:mm:ss
        
    # XMLè½¬æ¢å™¨
    xml:
      # é…ç½®ä¸ºJAXBè½¬æ¢å™¨
      type: com.dtflys.forest.converter.xml.ForestJaxbConverter

    # äºŒè¿›åˆ¶è½¬æ¢å™¨
    binary:
      # é…ç½®ä¸ºForesté»˜è®¤äºŒè¿›åˆ¶è½¬æ¢å™¨
      type: com.dtflys.forest.converter.binary.DefaultBinaryConverter

    # æ–‡æœ¬è½¬æ¢å™¨
    text:
      # é…ç½®ä¸ºForesté»˜è®¤æ–‡æœ¬è½¬æ¢å™¨
      type: com.dtflys.forest.converter.text.DefaultTextConverter
```

</code-block>

<code-block title="Properties">

```properties
# è½¬æ¢å™¨é…ç½®ï¼Œæ”¯æŒ json, xml, text, binary å››ç§æ•°æ®ç±»å‹çš„é…ç½®

# JSONè½¬æ¢å™¨
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºJacksonçš„è½¬æ¢å™¨
forest.converters.json.type=com.dtflys.forest.converter.json.ForestJacksonConverter
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºGSONè½¬æ¢å™¨
# forest.converters.json.type=com.dtflys.forest.converter.json.ForestGsonConverter
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºFastjsonè½¬æ¢å™¨
# forest.converters.json.type=com.dtflys.forest.converter.json.ForestFastjsonConverter
      
# è½¬æ¢å™¨çš„å‚æ•°è®¾ç½®
# JSONæ•°æ®è½¬æ¢å™¨çš„å…¨å±€æ—¥æœŸæ ¼å¼åŒ–é…ç½®
forest.converters.json.parameters.dateFormat: yyyy/MM/dd hh:mm:ss
        
# XMLè½¬æ¢å™¨
# é…ç½®ä¸ºJAXBè½¬æ¢å™¨
forest.converters.xml.type=com.dtflys.forest.converter.xml.ForestJaxbConverter

# äºŒè¿›åˆ¶è½¬æ¢å™¨
# é…ç½®ä¸ºForesté»˜è®¤äºŒè¿›åˆ¶è½¬æ¢å™¨
forest.converters.binary.type: com.dtflys.forest.converter.binary.DefaultBinaryConverter

# æ–‡æœ¬è½¬æ¢å™¨
# é…ç½®ä¸ºForesté»˜è®¤æ–‡æœ¬è½¬æ¢å™¨
forest.converters.text.type: com.dtflys.forest.converter.text.DefaultTextConverter
```

</code-block>
<code-block title="Spring">

```xml
<forest:configuration>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ å¼€å§‹ -->
    <!-- è®¾ç½®JSONè½¬æ¢å™¨ -->
    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºJacksonçš„è½¬æ¢å™¨ -->
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestJacksonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd hh:mm:ss"/>
    </forest:converter>
    
    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºGSONè½¬æ¢å™¨ -->
    <!--
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestGsonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd hh:mm:ss"/>
    </forest:converter>
    -->

    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºFastjsonè½¬æ¢å™¨ -->
    <!--
    <forest:converter dataType="json" class="com.dtflys.forest.converter.json.ForestFastjsonConverter">
        <forest:parameter name="dateFormat" value="yyyy/MM/dd hh:mm:ss"/>
    </forest:converter>
    -->

    <!-- è®¾ç½®XMLè½¬æ¢å™¨ -->
    <forest:converter dataType="xml" class="com.dtflys.forest.converter.xml.ForestJaxbConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
</forest:configuration>
```

</code-block>
<code-block title="Java">

```java
// è·å–å…¨å±€é»˜è®¤é…ç½®å¯¹è±¡
ForestConfiguration configuration = Forest.config();
// æ›´æ¢JSONè½¬æ¢å™¨ä¸ºFastJson
configuration.setJsonConverter(new ForestFastjsonConverter());
// æ›´æ¢JSONè½¬æ¢å™¨ä¸ºJackson
configuration.setJsonConverter(new ForestJacksonConverter());
// æ›´æ¢JSONè½¬æ¢å™¨Gson
configuration.setJsonConverter(new ForestGsonConverter());
// æ›´æ¢XMLè½¬æ¢å™¨JAXB
configuration.getConverterMap().put(ForestDataType.XML, new ForestJaxbConverter());
```

</code-block>
</code-group>



### è‡ªå®šä¹‰è½¬æ¢å™¨

åœ¨Forestä¸­ï¼Œæ¯ä¸ªè½¬æ¢ç±»å‹éƒ½å¯¹åº”ä¸€ä¸ªè½¬æ¢å™¨å¯¹è±¡ï¼Œæ¯”å¦‚`JSON`æ ¼å¼çš„è½¬æ¢å™¨æœ‰`com.dtflys.forest.converter.json.ForestFastjsonConverter`ã€`com.dtflys.forest.converter.json.ForestGsonConverter`ã€`com.dtflys.forest.converter.json.ForestJacksonConverter`ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯åŸºäº`FastJson`ã€`Gson`ã€`Jackson`ä¸‰ç§ä¸åŒçš„`JSON`åºåˆ—åŒ–æ¡†æ¶ã€‚

å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„è½¬æ¢å™¨ï¼Œä»¥é€‚åº”è‡ªå·±é¡¹ç›®çš„éœ€è¦ã€‚åªéœ€ä¸‰æ­¥ä¾¿å¯å®Œæˆè‡ªå®šä¹‰æ‰©å±•è½¬æ¢å™¨ã€‚

ç¬¬ä¸€æ­¥. å®šä¹‰ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼Œå¹¶å®ç°`com.dtflys.forest.converter.ForestConverter`æ¥å£

```java
/**
 *  è‡ªå®šä¹‰ä¸€ä¸ªProtobufçš„è½¬æ¢å™¨ï¼Œå¹¶å®ç°ForestConverteræ¥å£ä¸‹çš„convertToJavaObjectæ–¹æ³•
 */
public class MyProtobufConverter implements ForestConverter {

    public <T> T convertToJavaObject(String source, Class<T> targetType) {
        // å°†å­—ç¬¦ä¸²å‚æ•°sourceè½¬æ¢æˆç›®æ ‡Classå¯¹è±¡
    }

    public <T> T convertToJavaObject(String source, Type targetType) {
        // å°†å­—ç¬¦ä¸²å‚æ•°sourceè½¬æ¢æˆç›®æ ‡Type(å¯èƒ½æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹)å¯¹è±¡
    }

}
```

ç¬¬äºŒæ­¥. æ³¨å†Œæ‚¨å®šä¹‰å¥½çš„è½¬æ¢å™¨ç±»åˆ°`ForestConfiguration`

```java
@Autowired
private ForestConfiguration forestConfiguration;

...

// è®¾ç½®æ–‡æœ¬è½¬æ¢å™¨
forestConfiguration.getConverterMap().put(ForestDataType.TEXT, new MyProtobufConverter());
// è®¾ç½®äºŒè¿›åˆ¶è½¬æ¢å™¨
forestConfiguration.getConverterMap().put(ForestDataType.BINARY, new MyProtobufConverter());
// è®¾ç½®äºŒè¿›åˆ¶è½¬æ¢å™¨
forestConfiguration.getConverterMap().put(ForestDataType.BINARY, new MyProtobufConverter());

```

JSONè½¬æ¢å™¨å’ŒXMLè½¬æ¢å™¨æ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦ `implements` çš„ç±»ä¸æ˜¯ `ForestConverter`

```java

/**
 *  JSONè½¬æ¢å™¨éœ€è¦å®ç° ForestJsonConverter æ¥å£
 */
public class MyJsonConverter implements ForestJsonConverter {
   ... ...
}


/**
 *  XMLè½¬æ¢å™¨éœ€è¦å®ç° ForestXmlConverter æ¥å£
 */
public class MyXmlConverter implements ForestXmlConverter {
   ... ...
}


```


æ³¨å†Œåˆ°é…ç½®ä¸­

<code-group>
<code-block title="Yaml" active>

```yaml
forest:
  converters:
    # JSONè½¬æ¢å™¨
    json:
      # JSONè½¬æ¢å™¨è®¾ç½®ä¸ºMyJsonConverterè½¬æ¢å™¨
      type: com.xxx.MyJsonConverter
      
    # XMLè½¬æ¢å™¨
    xml:
      # é…ç½®ä¸ºMyXmlConverterè½¬æ¢å™¨
      type: com.xxx.MyXmlConverter
```


</code-block>
<code-block title="Properties">

```properties
# JSONè½¬æ¢å™¨
# JSONè½¬æ¢å™¨è®¾ç½®ä¸ºMyJsonConverterè½¬æ¢å™¨
forest.converters.json.type=com.xxx.MyJsonConverter
# XMLè½¬æ¢å™¨
# é…ç½®ä¸ºMyXmlConverterè½¬æ¢å™¨
forest.converters.xml.type=com.xxx.MyXmlConverter
```


</code-block>
<code-block title="Spring">

```xml
<forest:configuration>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ å¼€å§‹ -->
    <!-- è®¾ç½®JSONè½¬æ¢å™¨ -->
    <!-- JSONè½¬æ¢å™¨è®¾ç½®ä¸ºMyJsonConverterè½¬æ¢å™¨ -->
    <forest:converter dataType="json" class="com.xxx.MyJsonConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
    <!-- è®¾ç½®XMLè½¬æ¢å™¨ -->
    <!-- è®¾ç½®ä¸ºMyXmlConverterè½¬æ¢å™¨ -->
    <forest:converter dataType="xml" class="com.xxx.MyXmlConverter">
    </forest:converter>
    <!-- Forestè½¬æ¢å™¨å®šä¹‰ ç»“æŸ -->
</forest:configuration>
```

</code-block>
<code-block title="Java">

```java

// è®¾ç½®JSONè½¬æ¢å™¨
forestConfiguration.setJsonConverter(new MyJsonConverter());
// è®¾ç½®XMLè½¬æ¢å™¨
forestConfiguration.getConverterMap().put(ForestDataType.XML, new MyXmlConverter());

```

</code-block>
</code-group>

