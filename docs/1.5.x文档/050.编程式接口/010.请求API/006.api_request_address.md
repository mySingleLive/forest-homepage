---
title: 请求地址
date: 2022-07-14 12:36:38
permalink: /pages/1.5.x/api_request_address/
---

## URL地址

ForestRequest 对象提供设置/获取URL地址的接口方法

> `url(String url)` 设置请求URL
>- 参数 `url`: URL字符串
>
> `url(ForestURL url)` 设置请求URL
>- 参数 `url`: ForestURL 类实例
>
>
>  `host(String host)` 设置URL的主机名/域名/IP地址部分
>- 参数 `host`: 主机名/域名/IP地址
>
>
>  `port(int port)` 设置URL中的端口
>- 参数 `port`: 端口号
>
>
>  `scheme(String scheme)` 设置URL中的HTTP协议头
>- 参数 `scheme`: HTTP协议头
>
>
>  `path(String path)` 设置URL路径
>- 参数 `path`: URL路径
>
>
>  `ref(String ref)` 设置Reference, 即URL井号后面的字符串
>- 参数 `ref`: URL井号后面的字符串

```java
// 设置请求URL地址，url: http://127.0.0.1:8080/test
request.url("http://127.0.0.1:8080/test");
// 设置路径为 /abc, 主机地址和端口部分保留，url: http://127.0.0.1:8080/abc
request.url("/abc");
// 覆盖掉整个URL地址，url: http://forest.dtflyx.com/111
request.url("http://forest.dtflyx.com/111");
// 使用 ForestURL 类型对象作为参数，url: http://localhost:8080/222
request.url(new ForestURL(new URL("http://localhost:8080/222")));
// 修改请求地址中的主机名/IP地址/域名部分，url: http://127.0.0.1:8080/222
request.host("127.0.0.1");
// 同上，修改请求地址中的主机名/IP地址/域名部分
request.url().setHost("127.0.0.1");
// 修改请求地址中的端口号，url: http://127.0.0.1:8888/222
request.port(8888);
// 同上，修改请求地址中的端口号
request.url().setPort(8888);
// 修改请求地址中的HTTP协议头，url: https://127.0.0.1:8888/222
request.scheme("https");
// 同上，修改请求地址中的HTTP协议头
request.url().setScheme("https");
// 修改请求地址中的路径部分，和url方法类似，但path方法不接受完整url地址作为参数，url: https://127.0.0.1:8888/333
request.path("/333");
// 同上，修改请求地址中的路径部分
request.url().setPath("/333");
// 设置Reference，即URL井号后面的字符串，url: https://127.0.0.1:8888/333#hello
request.ref("hello");
```

获取URL地址

> `urlString()` 获取请求URL字符串
>- 返回值: URL字符串
>
> `url()` 获取请求URL
>- 返回值: ForestURL 类实例
>
> `host()` 获取URL中的主机名/域名/IP地址部分
>- 返回值: 主机名/域名/IP地址部分字符串
>
> `port()` 获取URL中的端口号
>- 返回值: int 整数, URL中的端口号
>
> `path()` 获取URL路径
>- 返回值: URL路径
>
> `ref()` 获取Reference, 即URL井号后面的字符串
>- 返回值: URL井号后面的字符串


```java
// 获取URL地址字符串
// 如：http://localhost:8080/test
request.urlString();
// 获取ForestURL类对象
request.url();
// 获取请求地址的HTTP协议头
request.scheme();
// 同上，获取请求地址的HTTP协议头
request.url().getScheme();
// 获取请求地址中的主机名/IP地址/域名部分
request.host();
// 同上，获取请求地址中的主机名/IP地址/域名部分
request.url().getHost();
// 获取请求地址中的端口号
// 如：8080
// 默认为 -1, 即没有端口号
// 没有端口号也可以理解为 http 下的 80 和 https 下的 443
request.port();
// 同上，获取请求地址中的端口号
request.url().getPort();
// 获取请求地址中的路径部分，如：/test
request.path();
// 同上，获取请求地址中的路径部分
request.url().getPath();
// 获取Reference，即URL井号后面的字符串
// 如：http://localhost/test#hello 中的 hello 那部分字符串
request.ref(); 
```

## 主机地址

主机地址包含: 主机名/IP地址/域名 + 端口号

使用 address 方法的好处是，只会修改主机名或端口，不会影响URL的其它部分（比如 Query 参数，HTTP协议头，路径部分等等）

> `address(String host, int port)` 设置请求的主机地址(主机名/域名/IP地址 + 端口号)
>- 参数 `host`: 主机名/域名/IP地址
>- 参数 `port`: 端口号

```java
// 创建新的请求对象
// url: http://localhost/test
Forest.get("/test")
     // 设置请求主机地址，不会改变URL地址的其它部分
     // 参数1：主机名/IP地址/域名
     // 参数2：端口号
     // url: http://192.168.0.1:8881/test
    .address("192.168.0.1", 8881)
     // 同上，设置请求主机地址
     // 参数为 ForestAddress 对象
     // url: http://192.168.0.2:8882/test
    .address(new ForestAddress("192.168.0.2", 8882));
```


## URL参数

URL参数，也称为Query (查询参数)，是跟随在URL地址中 `?` 后的字符串，常以 `key=value` 的键值对形式出现，用于向服务端传递数据。

ForestRequest 对象提供了添加和修改 Query 参数的方法

### 添加参数

> addQuery(String name, Object value) 添加Query参数
>- 参数 `name`: Query参数名
>- 参数 `value`: Query参数值

```java
Forest.get("/")
        .addQuery("a", 1)  // 添加 Query 参数 a=1
        .addQuery("b", 2); // 添加 Query 参数 b=2
// 最后产生 Query 参数 ?a=1&b=2
```
适用 ForestRequest.addQuery 方法可以重复添加重名 Query 参数。
此功能可用于传递数组

```java

request.addQuery("a", 1)  // 添加 Query 参数 a=1
       .addQuery("a", 2)  // 添加 Query 参数 a=2
       .addQuery("a", 3); // 添加 Query 参数 a=3
// 最后产生 Query 参数 ?a=1&a=2&a=3
```

### 添加Map参数

> addQuery(Map queryMap) 添加Map类型Query参数
>- 参数 `queryMap`: Map对象

```java
Map<String, Object> map = new HashMap();
map.put("a", 1);
map.put("b", 2);
request.addQuery(map)  // 添加 Map 对象到 Query 参数中
// 最后产生 Query 参数 ?a=1&b=2
```

### 添加对象参数

> addQuery(Object queryParameters) 添加Java对象类型Query参数
>- 参数 `queryParameters`: 任意类型Java对象

```java
// 自定义一个普通的Java数据类
public class MyQuery {
    private int a;
    private int b;
    // getter 和 setter 代码（省略）
}

// 创建自定义的Java对象实例
MyQuery myQuery = new MyQuery();
myQuery.setA(1);
myQuery.setB(2);
request.addQuery(myQuery)  // 添加 Java 对象到 Query 参数中
// 最后产生 Query 参数 ?a=1&b=2
```



### 强制编码

:::warnging 注意
使用 `addQuery(String name, String value)` 方法时, 绝大部分Query参数值都会被自动UrlEncode编码，但有某些特殊的参数值不会被编码，如: `http://www.baidu.com` 这样的url地址会被原封不动保留。

这时候需要使用 `addQuery(String name, String value, boolean isUrlEncode, String charset)` 方法来强制UrlEncode。
:::

> `addQuery(String name, String value, boolean isUrlEncode, String charset)` 添加Query参数
>- 参数 `name`: Query参数名
>- 参数 `value`: Query参数值
>- 参数 `isUrlEncode`: 是否强制UrlEncode
>- 参数 `charset`: 编码字符集


```java
Forest.get("http://127.0.0.1:8080/")
         // 不强制UrlEncode
        .addQuery("url1", "http://localhost/test");
         // 强制UrlEncode
        .addQuery("url2", "http://localhost/test", true, "UTF-8");
// 最终url为
// http://127.0.0.1:8080/?url1=http://localhost/test&url2=http%3A%2F%2Flocalhost%2Ftest
```

### 修改参数

修改已存在的 Query 参数

> `replaceQuery(String name, Object value)` 替换Query参数值
>- 参数 `name`: Query参数名
>- 参数 `value`: Query参数值

```java
request.addQuery("a", 1)      // 添加 Query 参数 a=1
       .replaceQuery("a", 2); // 修改 Query 参数 a=2
// 最后产生 Query 参数 ?a=2
```

ForestRequest.replaceQuery 可以方法修改 Query 参数，但对于还不存在的 Query 参数就无法处理了

```java
// 创建一个新请求对象
// url: http://localhost/
Forest.get("/")
       // 这时候还不存在 Query 参数 a
       // 所以此时调用 replaceQuery 是无效的
      .replaceQuery("a", "1");
// 最后地址还是为 http://localhost/
```

这时候可以用 ForestRequest.replaceOrAddQuery 方法，它在 Query 参数不存在的情况下添加参数，在已存在的情况下修改参数

> `replaceOrAddQuery(String name, String value)` 替换或添加Query参数
>- 参数 `name`: Query参数名
>- 参数 `value`: Query参数值

```java
// 创建一个新请求对象
// url: http://localhost/
Forest.get("/");
      .replaceOrAddQuery("a", "1")  // 添加或修改 Query 参数 a=1
      .addQuery("b", "2")           // 修改 Query 参数 a=2
      .replaceOrAddQuery("b", "3"); // 添加或修改 Query 参数 b=3
// 最后地址还是为 http://localhost/?a=1&b=3
```

### 数组参数

有些时候，需要通过URL参数传递一个数组或者一个列表

```java
// 添加列表到Query参数
List<Integer> list = Arrays.asList(1, 2, 3);
Forest.get("/")
     .addQuery("a", list)
     .execute();
// query参数为 a=1&a=2&a=3

// 添加数组到Query参数
Object[] array = new Object[] {1, 2, 3};
Forest.get("/")
     .addQuery("a", array)
     .execute();
// Query参数为 a=1&a=2&a=3

// 添加数组到Query参数 (可变参数)
Forest.get("/")
     .addQuery("a", 1, 2, 3)
     .execute();
// Query参数为 a=1&a=2&a=3
```

带方括号`[]`参数名的样式

```java
// 添加列表到Query参数
List<Integer> list = Arrays.asList(1, 2, 3);
Forest.get("/")
     .addArrayQuery("a", list)
     .execute();
// query参数为 a[]=1&a[]=2&a[]=3

// 添加数组到Query参数
Object[] array = new Object[] {1, 2, 3};
Forest.get("/")
     .addArrayQuery("a", array)
     .execute();
// Query参数为 a[]=1&a[]=2&a[]=3

// 添加数组到Query参数 (可变参数)
Forest.get("/")
     .addArrayQuery("a", 1, 2, 3)
     .execute();
// Query参数为 a[]=1&a[]=2&a[]=3
```

### JSON参数

如果不想以URL参数的标准格式传递列表，JSON字符串也是一种选择

> `addJSONQuery(String name, Object value)` 添加 JSON Query 参数
>- 参数`name`:  Query参数名
>- 参数`value`: Query参数值，将被序列化为JSON字符串

```java
// 添加列表到Query数组参数
Forest.get("/")
     .addJSONQuery("a", Arrays.asList(1, 2, 3))
     .execute();
// query参数为 a=[1,2,3]
// 注意：这里的JSON数据最终会被 URLEncode
// 所以最终请求的参数为 a=%5B1%2C2%2C3%5D
```


### 获取参数

获取请求的整个 Query 参数表

> `getQuery()` 获取请求的Query参数表
>- 返回值:  Query参数表，ForestQueryMap 类实例

```java
// 构建请求
// Query 参数为 a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2)
        .addQuery("b", 3);
// 获取 Query 参数表
ForestQueryMap queries = request.getQuery();
// 返回参数为 a=1 的 ForestQueryParameter 对象
ForestQueryParameter param1 = queries.getQuery("a");
// 返回包含 b=2和b=3 的 ForestQueryParameter 对象列表
List<ForestQueryParameter> params = queries.getQueries("b"); 
```

获取单个 Query 参数

> `getQuery(String name)` 根据名称获取请求的Query参数值
>- 参数`name`: Query参数名称
>- 返回值: Query参数值

```java
// 构建请求
// Query 参数为 a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2);

request.getQuery("a"); // 获取 1
request.getQuery("b"); // 获取 2
```

获取整个请求的 Query 参数字符串

> `getQueryString()` 获取请求的URL Query参数字符串
>- 返回值: Query参数字符串

```java
// 构建请求
// Query 参数为 a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2)
        .addQuery("c", 3);

request.getQueryString(); // 获取 a=1&b=2&c=3
```
