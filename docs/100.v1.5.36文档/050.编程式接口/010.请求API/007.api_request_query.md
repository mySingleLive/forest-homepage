---
id: api_request_query
title: ğŸ§€ URL å‚æ•°
date: 2022-07-20 22:09:05
permalink: /pages/1.5.36/api_request_query/
---

URLå‚æ•°ï¼Œä¹Ÿç§°ä¸ºQuery (æŸ¥è¯¢å‚æ•°)ï¼Œæ˜¯è·Ÿéšåœ¨URLåœ°å€ä¸­ `?` åçš„å­—ç¬¦ä¸²ï¼Œå¸¸ä»¥ `key=value` çš„é”®å€¼å¯¹å½¢å¼å‡ºç°ï¼Œç”¨äºå‘æœåŠ¡ç«¯ä¼ é€’æ•°æ®ã€‚

ForestRequest å¯¹è±¡æä¾›äº†æ·»åŠ å’Œä¿®æ”¹ Query å‚æ•°çš„æ–¹æ³•

## æ·»åŠ å‚æ•°

`addQuery(String name, Object value)` æ·»åŠ Queryå‚æ•°
- å‚æ•° `name`: Queryå‚æ•°å
- å‚æ•° `value`: Queryå‚æ•°å€¼

```java
Forest.get("/")
        .addQuery("a", 1)  // æ·»åŠ  Query å‚æ•° a=1
        .addQuery("b", 2); // æ·»åŠ  Query å‚æ•° b=2
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2
```
é€‚ç”¨ ForestRequest.addQuery æ–¹æ³•å¯ä»¥é‡å¤æ·»åŠ é‡å Query å‚æ•°ã€‚
æ­¤åŠŸèƒ½å¯ç”¨äºä¼ é€’æ•°ç»„

```java

request.addQuery("a", 1)  // æ·»åŠ  Query å‚æ•° a=1
       .addQuery("a", 2)  // æ·»åŠ  Query å‚æ•° a=2
       .addQuery("a", 3); // æ·»åŠ  Query å‚æ•° a=3
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&a=2&a=3
```

## æ·»åŠ Mapå‚æ•°

`addQuery(Map queryMap)` æ·»åŠ Mapç±»å‹Queryå‚æ•°
- å‚æ•° `queryMap`: Mapå¯¹è±¡

```java
Map<String, Object> map = new HashMap();
map.put("a", 1);
map.put("b", 2);
request.addQuery(map)  // æ·»åŠ  Map å¯¹è±¡åˆ° Query å‚æ•°ä¸­
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2
```

## æ·»åŠ å¯¹è±¡å‚æ•°

`addQuery(Object queryParameters)` æ·»åŠ Javaå¯¹è±¡ç±»å‹Queryå‚æ•°
- å‚æ•° `queryParameters`: ä»»æ„ç±»å‹Javaå¯¹è±¡

```java
// è‡ªå®šä¹‰ä¸€ä¸ªæ™®é€šçš„Javaæ•°æ®ç±»
public class MyQuery {
    private int a;
    private int b;
    // getter å’Œ setter ä»£ç ï¼ˆçœç•¥ï¼‰
}

// åˆ›å»ºè‡ªå®šä¹‰çš„Javaå¯¹è±¡å®ä¾‹
MyQuery myQuery = new MyQuery();
myQuery.setA(1);
myQuery.setB(2);
request.addQuery(myQuery)  // æ·»åŠ  Java å¯¹è±¡åˆ° Query å‚æ•°ä¸­
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2
```

## æ·»åŠ å»¶è¿Ÿå‚æ•°

å»¶è¿Ÿå‚æ•° ï¼ˆä¹Ÿç§°ä½œ Lambda å‚æ•°ï¼‰ï¼Œåœ¨æ‚¨éœ€è¦ä¸é©¬ä¸Šæ±‚å€¼çš„æƒ…å†µä½¿ç”¨ã€‚

æœ‰å¾ˆå¤šæƒ…å†µï¼ŒQueryçš„å‚æ•°å€¼ä¸èƒ½é©¬ä¸Šå¾—å‡ºï¼Œè€Œæ˜¯åœ¨è¯·æ±‚å‘é€å‰çš„é‚£ä¸€åˆ»ï¼ˆæ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½åˆ°ä½æ—¶ï¼‰æ‰èƒ½å¾—å‡ºï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯åŠ ç­¾éªŒè¯çš„åœºæ™¯ï¼ˆåœ¨è¯·æ±‚ä½“å‚æ•°ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•°tokenï¼Œè€Œtokençš„å€¼æ˜¯å¯¹æ•´ä¸ªURL Query(é™¤tokenä¹‹å¤–æ‰€æœ‰å‚æ•°)åšåŠ å¯†çš„ç»“æœï¼‰


`addQuery(String name, Lazy lazyValue)` æ·»åŠ Lazyç±»å‹çš„Queryå‚æ•°
- å‚æ•° `lazyValue`: å»¶è¿Ÿæ±‚å€¼çš„Queryå‚æ•°å€¼ï¼ˆå³ Lambdaï¼‰

```java
request.addQuery("name", req -> {
    // req ä¸ºè¯·æ±‚å¯¹è±¡
    // è¿”å›å€¼å°†ä½œä¸ºå‚æ•°å€¼æ·»åŠ åˆ° URL Query ä¸­
    return "";
});
```

åœ¨ Lambda ä»£ç å—ä¸­å¯ä»¥è°ƒç”¨`req.queryString()` æ¥ç”Ÿæˆæ•´ä¸ªè¯·æ±‚çš„URL Queryå­—ç¬¦ä¸²

ä½†ä¼šè‡ªåŠ¨æ’é™¤ Lambda æ‰€å¯¹åº”çš„ Query å‚æ•°ï¼ˆå³ token å‚æ•°ï¼‰ï¼Œè€Œä¸ç”¨æ‹…å¿ƒä¼šé€ æˆæ­»å¾ªç¯

```java
request.addQuery("a", 1)         // æ·»åŠ  Query å‚æ•° a=1
        .addQuery("b", 2)        // æ·»åŠ  Query å‚æ•° b=2
        .addQuery("c", 3)        // æ·»åŠ  Query å‚æ•° c=3
        .addQuery("token", req -> Base64.encode(req.getQueryString())); // æ·»åŠ å»¶è¿Ÿå‚æ•°
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=1&b=2&c=3&token=YT0xJmI9MiZjPTM=
```

## å¼ºåˆ¶ç¼–ç 

:::warning æ³¨æ„
ä½¿ç”¨ `addQuery(String name, String value)` æ–¹æ³•æ—¶, ç»å¤§éƒ¨åˆ†Queryå‚æ•°å€¼éƒ½ä¼šè¢«è‡ªåŠ¨UrlEncodeç¼–ç ï¼Œä½†æœ‰æŸäº›ç‰¹æ®Šçš„å‚æ•°å€¼ä¸ä¼šè¢«ç¼–ç ï¼Œå¦‚: `http://www.baidu.com` è¿™æ ·çš„urlåœ°å€ä¼šè¢«åŸå°ä¸åŠ¨ä¿ç•™ã€‚

è¿™æ—¶å€™éœ€è¦ä½¿ç”¨ `addQuery(String name, String value, boolean isUrlEncode, String charset)` æ–¹æ³•æ¥å¼ºåˆ¶UrlEncodeã€‚
:::

`addQuery(String name, String value, boolean isUrlEncode, String charset)` æ·»åŠ Queryå‚æ•°
- å‚æ•° `name`: Queryå‚æ•°å
- å‚æ•° `value`: Queryå‚æ•°å€¼
- å‚æ•° `isUrlEncode`: æ˜¯å¦å¼ºåˆ¶UrlEncode
- å‚æ•° `charset`: ç¼–ç å­—ç¬¦é›†


```java
Forest.get("http://127.0.0.1:8080/")
         // ä¸å¼ºåˆ¶UrlEncode
        .addQuery("url1", "http://localhost/test");
         // å¼ºåˆ¶UrlEncode
        .addQuery("url2", "http://localhost/test", true, "UTF-8");
// æœ€ç»ˆurlä¸º
// http://127.0.0.1:8080/?url1=http://localhost/test&url2=http%3A%2F%2Flocalhost%2Ftest
```

## ä¿®æ”¹å‚æ•°

ä¿®æ”¹å·²å­˜åœ¨çš„ Query å‚æ•°

`replaceQuery(String name, Object value)` æ›¿æ¢Queryå‚æ•°å€¼
- å‚æ•° `name`: Queryå‚æ•°å
- å‚æ•° `value`: Queryå‚æ•°å€¼

```java
request.addQuery("a", 1)      // æ·»åŠ  Query å‚æ•° a=1
       .replaceQuery("a", 2); // ä¿®æ”¹ Query å‚æ•° a=2
// æœ€åäº§ç”Ÿ Query å‚æ•° ?a=2
```

ForestRequest.replaceQuery å¯ä»¥æ–¹æ³•ä¿®æ”¹ Query å‚æ•°ï¼Œä½†å¯¹äºè¿˜ä¸å­˜åœ¨çš„ Query å‚æ•°å°±æ— æ³•å¤„ç†äº†

```java
// åˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚å¯¹è±¡
// url: http://localhost/
Forest.get("/")
       // è¿™æ—¶å€™è¿˜ä¸å­˜åœ¨ Query å‚æ•° a
       // æ‰€ä»¥æ­¤æ—¶è°ƒç”¨ replaceQuery æ˜¯æ— æ•ˆçš„
      .replaceQuery("a", "1");
// æœ€ååœ°å€è¿˜æ˜¯ä¸º http://localhost/
```

è¿™æ—¶å€™å¯ä»¥ç”¨ ForestRequest.replaceOrAddQuery æ–¹æ³•ï¼Œå®ƒåœ¨ Query å‚æ•°ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ·»åŠ å‚æ•°ï¼Œåœ¨å·²å­˜åœ¨çš„æƒ…å†µä¸‹ä¿®æ”¹å‚æ•°

`replaceOrAddQuery(String name, String value)` æ›¿æ¢æˆ–æ·»åŠ Queryå‚æ•°
- å‚æ•° `name`: Queryå‚æ•°å
- å‚æ•° `value`: Queryå‚æ•°å€¼

```java
// åˆ›å»ºä¸€ä¸ªæ–°è¯·æ±‚å¯¹è±¡
// url: http://localhost/
Forest.get("/");
      .replaceOrAddQuery("a", "1")  // æ·»åŠ æˆ–ä¿®æ”¹ Query å‚æ•° a=1
      .addQuery("b", "2")           // ä¿®æ”¹ Query å‚æ•° a=2
      .replaceOrAddQuery("b", "3"); // æ·»åŠ æˆ–ä¿®æ”¹ Query å‚æ•° b=3
// æœ€ååœ°å€è¿˜æ˜¯ä¸º http://localhost/?a=1&b=3
```

## æ•°ç»„å‚æ•°

æœ‰äº›æ—¶å€™ï¼Œéœ€è¦é€šè¿‡URLå‚æ•°ä¼ é€’ä¸€ä¸ªæ•°ç»„æˆ–è€…ä¸€ä¸ªåˆ—è¡¨

```java
// æ·»åŠ åˆ—è¡¨åˆ°Queryå‚æ•°
List<Integer> list = Arrays.asList(1, 2, 3);
Forest.get("/")
     .addQuery("a", list)
     .execute();
// queryå‚æ•°ä¸º a=1&a=2&a=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•°
Object[] array = new Object[] {1, 2, 3};
Forest.get("/")
     .addQuery("a", array)
     .execute();
// Queryå‚æ•°ä¸º a=1&a=2&a=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•° (å¯å˜å‚æ•°)
Forest.get("/")
     .addQuery("a", 1, 2, 3)
     .execute();
// Queryå‚æ•°ä¸º a=1&a=2&a=3
```

å¸¦æ–¹æ‹¬å·`[]`å‚æ•°åçš„æ ·å¼

```java
// æ·»åŠ åˆ—è¡¨åˆ°Queryå‚æ•°
List<Integer> list = Arrays.asList(1, 2, 3);
Forest.get("/")
     .addArrayQuery("a", list)
     .execute();
// queryå‚æ•°ä¸º a[]=1&a[]=2&a[]=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•°
Object[] array = new Object[] {1, 2, 3};
Forest.get("/")
     .addArrayQuery("a", array)
     .execute();
// Queryå‚æ•°ä¸º a[]=1&a[]=2&a[]=3

// æ·»åŠ æ•°ç»„åˆ°Queryå‚æ•° (å¯å˜å‚æ•°)
Forest.get("/")
     .addArrayQuery("a", 1, 2, 3)
     .execute();
// Queryå‚æ•°ä¸º a[]=1&a[]=2&a[]=3
```

## JSONå‚æ•°

å¦‚æœä¸æƒ³ä»¥URLå‚æ•°çš„æ ‡å‡†æ ¼å¼ä¼ é€’åˆ—è¡¨ï¼ŒJSONå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©

`addJSONQuery(String name, Object value)` æ·»åŠ  JSON Query å‚æ•°
- å‚æ•°`name`:  Queryå‚æ•°å
- å‚æ•°`value`: Queryå‚æ•°å€¼ï¼Œå°†è¢«åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²

```java
// æ·»åŠ åˆ—è¡¨åˆ°Queryæ•°ç»„å‚æ•°
Forest.get("/")
     .addJSONQuery("a", Arrays.asList(1, 2, 3))
     .execute();
// queryå‚æ•°ä¸º a=[1,2,3]
// æ³¨æ„ï¼šè¿™é‡Œçš„JSONæ•°æ®æœ€ç»ˆä¼šè¢« URLEncode
// æ‰€ä»¥æœ€ç»ˆè¯·æ±‚çš„å‚æ•°ä¸º a=%5B1%2C2%2C3%5D
```


## è·å–å‚æ•°

è·å–è¯·æ±‚çš„æ•´ä¸ª Query å‚æ•°è¡¨

`getQuery()` è·å–è¯·æ±‚çš„Queryå‚æ•°è¡¨
- è¿”å›å€¼:  Queryå‚æ•°è¡¨ï¼ŒForestQueryMap ç±»å®ä¾‹

```java
// æ„å»ºè¯·æ±‚
// Query å‚æ•°ä¸º a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2)
        .addQuery("b", 3);
// è·å– Query å‚æ•°è¡¨
ForestQueryMap queries = request.getQuery();
// è¿”å›å‚æ•°ä¸º a=1 çš„ ForestQueryParameter å¯¹è±¡
ForestQueryParameter param1 = queries.getQuery("a");
// è¿”å›åŒ…å« b=2å’Œb=3 çš„ ForestQueryParameter å¯¹è±¡åˆ—è¡¨
List<ForestQueryParameter> params = queries.getQueries("b"); 
```

è·å–å•ä¸ª Query å‚æ•°

`getQuery(String name)` æ ¹æ®åç§°è·å–è¯·æ±‚çš„Queryå‚æ•°å€¼
- å‚æ•°`name`: Queryå‚æ•°åç§°
- è¿”å›å€¼: Queryå‚æ•°å€¼

```java
// æ„å»ºè¯·æ±‚
// Query å‚æ•°ä¸º a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2);

request.getQuery("a"); // è·å– 1
request.getQuery("b"); // è·å– 2
```

è·å–æ•´ä¸ªè¯·æ±‚çš„ Query å‚æ•°å­—ç¬¦ä¸²

`getQueryString()` è·å–è¯·æ±‚çš„URL Queryå‚æ•°å­—ç¬¦ä¸²
- è¿”å›å€¼: Queryå‚æ•°å­—ç¬¦ä¸²

```java
// æ„å»ºè¯·æ±‚
// Query å‚æ•°ä¸º a=1&b=2&b=3
ForestRequest<?> request = Forest.get("/")
        .addQuery("a", 1)
        .addQuery("b", 2)
        .addQuery("c", 3);

request.getQueryString(); // è·å– a=1&b=2&c=3
```
