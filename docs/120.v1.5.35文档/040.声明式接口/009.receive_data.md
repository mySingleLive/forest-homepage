---
id: receive_data
title: ğŸ“¬ æ¥æ”¶æ•°æ®
date: 2022-07-01 12:44:20
permalink: /pages/1.5.35/receive_data/
---

### ååºåˆ—åŒ–

Forestè¯·æ±‚ä¼šè‡ªåŠ¨å°†å“åº”çš„è¿”å›æ•°æ®ååºåˆ—åŒ–æˆæ‚¨è¦çš„æ•°æ®ç±»å‹ã€‚æƒ³è¦æ¥å—æŒ‡å®šç±»å‹çš„æ•°æ®éœ€è¦å®Œæˆä¸¤æ­¥æ“ä½œï¼š

ç¬¬ä¸€æ­¥ï¼šå®šä¹‰`dataType`å±æ€§

`dataType`å±æ€§æŒ‡å®šäº†è¯¥è¯·æ±‚å“åº”è¿”å›çš„æ•°æ®ç±»å‹ï¼Œç›®å‰å¯é€‰çš„æ•°æ®ç±»å‹æœ‰ä¸‰ç§: `text`, `json`, `xml`

Forestä¼šæ ¹æ®æ‚¨æŒ‡å®šçš„`dataType`å±æ€§é€‰æ‹©ä¸åŒçš„ååºåˆ—åŒ–æ–¹å¼ã€‚å…¶ä¸­`dataType`çš„é»˜è®¤å€¼ä¸º`text`ï¼Œå¦‚æœæ‚¨ä¸æŒ‡å®šå…¶ä»–æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆForestå°±ä¸ä¼šåšä»»ä½•å½¢å¼çš„åºåˆ—åŒ–ï¼Œå¹¶ä»¥æ–‡æœ¬å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ç»™ä½ æ•°æ®ã€‚

```java
/**
 * dataTypeä¸ºtextæˆ–ä¸å¡«æ—¶ï¼Œè¯·æ±‚å“åº”çš„æ•°æ®å°†ä»¥æ–‡æœ¬å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›å›æ¥
 */
@Request(
    url = "http://localhost:8080/text/data",
    dataType = "text"
)
String getData();
```

è‹¥æ‚¨æŒ‡å®šä¸º`json`æˆ–`xml`ï¼Œé‚£å°±å‘Šè¯‰äº†Forestè¯¥è¯·æ±‚çš„å“åº”æ•°æ®ç±»å‹ä¸ºJSONæˆ–XMLå½¢å¼çš„æ•°æ®ï¼Œå°±ä¼šä»¥ç›¸åº”çš„å½¢å¼è¿›è¡Œååºåˆ—åŒ–ã€‚

```java
/**
 * dataTypeä¸ºjsonæˆ–xmlæ—¶ï¼ŒForestä¼šè¿›è¡Œç›¸åº”çš„ååºåˆ—åŒ–
 */
@Request(
    url = "http://localhost:8080/text/data",
    dataType = "json"
)
Map getData();
```

ç¬¬äºŒæ­¥ï¼šæŒ‡å®šååºåˆ—åŒ–çš„ç›®æ ‡ç±»å‹

ååºåˆ—åŒ–éœ€è¦ä¸€ä¸ªç›®æ ‡ç±»å‹ï¼Œè€Œè¯¥ç±»å‹å…¶å®å°±æ˜¯æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œå¦‚è¿”å›å€¼ä¸º`String`å°±ä¼šååºåˆ—æˆ`String`å­—ç¬¦ä¸²ï¼Œè¿”å›å€¼ä¸º`Map`å°±ä¼šååºåˆ—åŒ–æˆä¸€ä¸ªHashMapå¯¹è±¡ï¼Œæ‚¨ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºè‡ªå®šä¹‰çš„Classç±»å‹ã€‚

```java
public class User {
    private String username;
    private String score;
    
    // Setterå’ŒGetter ...
}
```

å¦‚æœ‰ä¸Šé¢è¿™æ ·çš„Userç±»ï¼Œå¹¶æŠŠå®ƒæŒ‡å®šä¸ºæ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œè€Œä¸”ç›¸åº”è¿”å›çš„æ•°æ®è¿™æ ·ä¸€æ®µJSONï¼š

```json
{"username":  "Foo", "score":  "82"}
```

é‚£è¯·æ±‚æ¥å£å°±åº”è¯¥å®šä¹‰æˆè¿™æ ·ï¼š

```java
/**
 * dataTypeå±æ€§æŒ‡æ˜äº†è¿”å›çš„æ•°æ®ç±»å‹ä¸ºJSON
 */
@Get(
    url = "http://localhost:8080/user?id=${0}",
    dataType = "json"
)
User getUser(Integer id)
```

ä»`1.4.0`ç‰ˆæœ¬å¼€å§‹ï¼Œ`dataType` å±æ€§é»˜è®¤ä¸º `auto`ï¼ˆè‡ªåŠ¨åˆ¤æ–­æ•°æ®ç±»å‹ï¼‰ï¼Œ ä¹Ÿå°±æ˜¯è¯´ `dataType` å±æ€§å¯ä»¥å®Œå…¨çœç•¥ä¸å¡«ï¼ŒForestä¼šè‡ªè¡Œåˆ¤æ–­è¿”å›çš„æ•°æ®ç±»å‹æ˜¯å“ªç§æ ¼å¼ã€‚

```java
/**
 * çœç•¥dataTypeå±æ€§ä¼šè‡ªåŠ¨åˆ¤æ–­è¿”å›çš„æ•°æ®æ ¼å¼å¹¶è¿›è¡Œååºåˆ—åŒ–
 */
@Get("http://localhost:8080/user?id=${0}")
User getUser(Integer id)
```

### è¿”å›è¯·æ±‚å¯¹è±¡

å¦‚æœå°†`ForestRequest`ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¸ä¼šç«‹å³æ‰§è¡Œè¯·æ±‚å‘é€çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ª`ForestRequest`å¯¹è±¡ã€‚

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥å»¶è¿Ÿå‘é€HTTPè¯·æ±‚ï¼Œå¹¶å¯¹è¦å³å°†å‘é€çš„è¯·æ±‚å‚æ•°åšè¿›ä¸€æ­¥çš„ä¿®æ”¹å’ŒåŠ å·¥ã€‚

```java
public interface MyForestClient {

    /**
     * Getç±»å‹è¯·æ±‚ï¼Œurlè·¯å¾„ä¸º /test
     * <p>ForestRequestæ˜¯å¸¦æ³›å‹å‚æ•°çš„ç±»å‹
     * <p>æ³›å‹å‚æ•°ä»£è¡¨è¿”å›çš„å“åº”æ•°æ®æ‰€æœŸæœ›è½¬åŒ–æˆçš„ç±»å‹
     * 
     * @return Forestè¯·æ±‚å¯¹è±¡
     */
    @Get("/test")
    ForestRequest<?> getForestRequest();
}
```

åœ¨è°ƒç”¨`getForestRequest()`æ–¹æ³•åè·å¾—è¯¥è¯·æ±‚æ–¹æ³•æ‰€å¯¹åº”çš„è¯·æ±‚å¯¹è±¡

```java
// å¦‚æœè¯·æ±‚æ–¹æ³•ä»¥ ForestRequest ä½œä¸ºè¿”å›å€¼ç±»å‹
// ä¸ä¼šç›´æ¥å‘é€è¯·æ±‚
// è€Œæ˜¯ç›´æ¥è¿”å› Forest è¯·æ±‚å¯¹è±¡
ForestRequest<?> request = myForestClient.getForestRequest();
String path = request.path(); // å¾—åˆ°å­—ç¬¦ä¸² /test
// æ‰‹åŠ¨æ‰§è¡Œå‘é€è¯·æ±‚ï¼Œå¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼æ¥å—å“åº”æ•°æ®
String ret = request.execute(String.class); 
```

è·å¾— Forest è¯·æ±‚å¯¹è±¡æ—¶å¹¶ä¸ä¼šè‡ªåŠ¨å‘é€è¯·æ±‚ï¼Œéœ€è¦è°ƒç”¨`execute()`æˆ–`execute(Class)`è¿™ç±»æ–¹æ³•æ‰‹åŠ¨æ‰§è¡Œè¯·æ±‚å‘é€çš„è¿‡ç¨‹ã€‚

:::tip æ–‡æ¡£å¯¼èˆª
è¦è¯¦ç»†äº†è§£å¦‚ä½•æ‰‹åŠ¨æ‰§è¡Œè¯·æ±‚å‘é€ï¼Œè¯·å‚è§ã€Š[æ‰§è¡Œè¯·æ±‚](/pages/1.5.35/api_execute/)ã€‹
:::

### è¿”å›å“åº”å¯¹è±¡

ç›´æ¥ç”¨æ™®é€šçš„å¯¹è±¡ç±»å‹ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œå¯ä»¥å°†å“åº”æ•°æ®æ–¹ä¾¿çš„ååºåˆ—åŒ–ï¼Œä»¥æ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚ä½†è¿˜æœ‰å¾ˆå¤šæ—¶å€™ä¸å…‰éœ€è¦è·å–å“åº”å†…å®¹ï¼Œä¹Ÿéœ€è¦å¾—åˆ°å“åº”å¤´ç­‰ä¿¡æ¯ï¼Œè¿™æ—¶å€™å°±éœ€è¦ `ForestResponse` å‡ºåœºäº†ã€‚

å°†`ForestResponse`ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›å€¼ç±»å‹

```java

/**
 * ForestResponse å¯ä»¥ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›ç±»å‹
 * ForestResponse ä¸ºå¸¦æ³›å‹çš„ç±»ï¼Œå…¶æ³›å‹å‚æ•°ä¸­å¡«çš„ç±»ä½œä¸ºå…¶å“åº”ååºåˆ—åŒ–çš„ç›®æ ‡ç±»å‹
 */
@Post("http://localhost:8080/user")
ForestResponse<String> postUser(@JSONBody User user);
```

ç”¨`ForestResponse`å¯¹è±¡æ¥åˆ°è¯·æ±‚å“åº”æ•°æ®åä¾¿å¯ä»¥è·å–å“åº”å†…å®¹

```java
// ä»¥ForestResponseç±»å‹å˜é‡æ¥å—å“åº”æ•°æ®
ForestResponse<String> response = client.postUser(user);

// ç”¨isErroræ–¹æ³•å»åˆ¤æ–­è¯·æ±‚æ˜¯å¦å¤±è´¥
if (response.isError()) {
    ... ...
}

// ç”¨isSuccessæ–¹æ³•å»åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ
if (response.isSuccess()) {
    ... ...
}

// ä»¥å­—ç¬¦ä¸²æ–¹å¼è¯»å–è¯·æ±‚å“åº”å†…å®¹
String text = response.readAsString();

// getContentæ–¹æ³•å¯ä»¥è·å–è¯·æ±‚å“åº”å†…å®¹æ–‡æœ¬
// å’ŒreadAsStringæ–¹æ³•ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒgetContentæ–¹æ³•ä¸ä¼šè¯»å–äºŒè¿›åˆ¶å½¢å¼æ•°æ®å†…å®¹ï¼Œ
// è€ŒreadAsStringæ–¹æ³•ä¼šå°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆå­—ç¬¦ä¸²è¯»å–
String content = response.getContent();

// è·å–ååºåˆ—åŒ–æˆå¯¹è±¡ç±»å‹çš„è¯·æ±‚å“åº”å†…å®¹
// å› ä¸ºè¿”å›ç±»å‹ä¸ºForetReponse<String>, å…¶æ³›å‹å‚æ•°ä¸ºString
// æ‰€ä»¥è¿™é‡Œä¹Ÿç”¨Stringç±»å‹è·å–ç»“æœ        
String result = response.getResult();

// ä»¥å­—èŠ‚æ•°ç»„çš„å½¢å¼è·å–è¯·æ±‚å“åº”å†…å®¹
byte[] byteArray = response.getByteArray();

// ä»¥è¾“å…¥æµçš„å½¢å¼è·å–è¯·æ±‚å“åº”å†…å®¹
InputStream in = response.getInputStream();
```

å› ä¸º`ForestResponse`ä¸ºå¸¦æ³›å‹çš„ç±»å‹ï¼Œå…¶æ³›å‹å‚æ•°å¯ä»¥æ˜¯ä»»ä½•å…¶ä»–ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®å®ƒçš„æ³›å‹å‚æ•°ä¸­çš„ç±»å‹ä¸åŒï¼Œè€Œå°†å“åº”å†…å®¹ååºåˆ—åŒ–æˆä¸åŒçš„å¯¹è±¡ã€‚

```java

/**
 * ForestResponse å¯ä»¥ä½œä¸ºè¯·æ±‚æ–¹æ³•çš„è¿”å›ç±»å‹
 * ForestResponse ä¸ºå¸¦æ³›å‹çš„ç±»ï¼Œå…¶æ³›å‹å‚æ•°ä¸­å¡«çš„ç±»ä½œä¸ºå…¶å“åº”ååºåˆ—åŒ–çš„ç›®æ ‡ç±»å‹
 */
@Get("http://localhost:8080/user")
ForestResponse<User> getUser(@Query("id") String userId);
```

åŒæ ·æ˜¯ç”¨`ForestResponse`ç±»å‹å˜é‡å»æ¥å—å“åº”æ•°æ®

```java
ForestResponse<User> response = client.postUser(user);
// åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ
if (response.isSuccess()) {
    // é€šè¿‡getResultæ–¹æ³•è·å–å…¶å“åº”å†…å®¹ååºåˆ—åŒ–åçš„ç»“æœ
    // å› ä¸ºè¿”å›ç±»å‹ ForestResponse<User> ä¸­æ³›å‹å‚æ•°ä¸º User,
    // æ‰€ä»¥å¾—åˆ°ååºåˆ—åŒ–åçš„å¯¹è±¡ä¹Ÿæ˜¯Userç±»å‹å¯¹è±¡    
    User user = response.getResult();
}
```


### æ‹¦æˆªå™¨ä¸­è·å–å“åº”å¯¹è±¡

```java
public class SimpleInterceptor1 implements Interceptor<String> {
    ... ...
    /**
     * è¯¥æ–¹æ³•åœ¨è¯·æ±‚å‘é€ä¹‹åè¢«è°ƒç”¨
     */
    @Override
    public void afterExecute(ForestRequest request, ForestResponse response) {
        // æ‰§è¡Œåœ¨å‘é€è¯·æ±‚ä¹‹åå¤„ç†çš„ä»£ç 
        int status = response.getStatusCode(); // è·å–è¯·æ±‚å“åº”çŠ¶æ€ç 
        String content = response.getContent(); // è·å–è¯·æ±‚çš„å“åº”å†…å®¹
        String result = response.getResult(); // è·å–æ–¹æ³•è¿”å›ç±»å‹å¯¹åº”çš„æœ€ç»ˆæ•°æ®ç»“æœ
    }
}
```

:::tip æ–‡æ¡£å¯¼èˆª
æ‹¦æˆªå™¨è¯¦ç»†å†…å®¹è¯·å‚è§ã€Š[æ‹¦æˆªå™¨](docs/1.5.35/interceptor)ã€‹
:::

### å›è°ƒå‡½æ•°ä¸­è·å–å“åº”å¯¹è±¡

```java
@Post("http://localhost:8080/user")
void postUser(@JSONBody User user, OnSuccess<String> onSuccess);

... ...

client.postUser(user, (String resText, ForestRequest request, ForestResponse response) -> {
    // åœ¨æˆåŠŸæ¥æ”¶è¯·æ±‚å“åº”åå¤„ç†
    int status = response.getStatusCode(); // è·å–è¯·æ±‚å“åº”çŠ¶æ€ç 
    String content = response.getContent(); // è·å–è¯·æ±‚çš„å“åº”å†…å®¹
    String result = response.getResult(); // è·å–æ–¹æ³•è¿”å›ç±»å‹å¯¹åº”çš„æœ€ç»ˆæ•°æ®ç»“æœ
});
```

:::tip æ–‡æ¡£å¯¼èˆª
å›è°ƒå‡½æ•°è¯¦ç»†å†…å®¹è¯·å‚è§ã€Š[å›è°ƒå‡½æ•°](016.callback)ã€‹
:::


### è·å–å“åº”å¤´

è¦è·å–å“åº”å¤´é¦–å…ˆè¦è·å–å“åº”å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯`ForestResponse`å¯¹è±¡ï¼Œè¿™ä¸€æ­¥å¯ä»¥å‚è§ã€Š[è·å–å“åº”å¯¹è±¡](009.receive_data#å“åº”å¯¹è±¡)ã€‹ã€‚

è·å–`ForestResponse`å¯¹è±¡åä¾¿å¯ä»¥è·å–å“åº”å¤´äº†

```java

ForestResponse<String> response = client.textXXX();

// æ ¹æ®å“åº”å¤´åç§°è·å–å•ä¸ªè¯·æ±‚å“åº”å¤´
ForestHeader header = response.getHeader("Content-Type");
// å“åº”å¤´åç§°
String headerName = header.getName();
// å“åº”å¤´å€¼
String headerValue = header.getValue();

// æ ¹æ®å“åº”å¤´åç§°è·å–è¯·æ±‚å“åº”å¤´åˆ—è¡¨
List<ForestHeader> heaers = response.getHeaders("Content-Type");

// æ ¹æ®å“åº”å¤´åç§°è·å–è¯·æ±‚å“åº”å¤´å€¼
String val = response.getHeaderValue("Content-Type");

// æ ¹æ®å“åº”å¤´åç§°è·å–è¯·æ±‚å“åº”å¤´å€¼åˆ—è¡¨
List<String> vals = response.getHeaderValues("Content-Type");

```
