---
id: api_request_header
title: ğŸš… è¯·æ±‚å¤´
date: 2022-07-14 12:39:52
permalink: /pages/1.5.32/api_request_header/
---

ä¸€ä¸ªHTTPè¯·æ±‚ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ä¸‰éƒ¨åˆ†ç»„æˆã€‚å…¶ä¸­ï¼Œè¯·æ±‚å¤´æ˜¯HTTPè¯·æ±‚çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç»å¸¸ç”¨äºä¼ é€’å’ŒæœåŠ¡ç«¯é€šè®¯çš„æ§åˆ¶å‚æ•°ã€æ•°æ®æ ¼å¼ã€è¯·æ±‚ç¼–ç ç­‰é‡è¦ä¿¡æ¯ã€‚

è¯·æ±‚å¤´ç”±é›¶åˆ°å¤šä¸ªå¤´å±æ€§æ„æˆï¼Œè€Œä¸€ä¸ªå¤´å±æ€§é€šå¸¸æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ã€‚

## æ·»åŠ è¯·æ±‚å¤´

ForestRequest å¯¹è±¡æä¾›äº†æ·»åŠ å’Œä¿®æ”¹è¯·æ±‚å¤´çš„æ–¹æ³•

> `addHeader(String name, Object value)` æ·»åŠ è¯·æ±‚å¤´
>
>- å‚æ•° `name`: è¯·æ±‚å¤´åç§°
>
>- å‚æ•° `value`: è¯·æ±‚å¤´çš„å€¼

```java
// addHeaderæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¤´å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå¤´å±æ€§çš„å€¼
// æ·»åŠ å¤´å±æ€§ Content-Typeï¼Œå€¼ä¸º application/json
request.addHeader("Content-Type", "application/json");
```

## æ·»åŠ å¤šä¸ªè¯·æ±‚å¤´

ä¸€ä¸ªè¯·æ±‚å¯ä»¥æ·»åŠ å¤šä¸ªå¤´å±æ€§

```java
request.addHeader("Accept", "text/plain")              // æ·»åŠ ç¬¬ä¸€ä¸ªå¤´å±æ€§
       .addHeader("Content-Type", "application/json")  // æ·»åŠ ç¬¬äºŒä¸ªå¤´å±æ€§
       .addHeader("AccessToken", "foobar");            // æ·»åŠ ç¬¬ä¸‰ä¸ªå¤´å±æ€§

// æœ€ç»ˆè¯·æ±‚åŒ…å«ä»¥ä¸‹å¤´å±æ€§ï¼š
// User-Agent: forest/1.5.32
// Accept: text/plain
// Content-Type: application/json
// AccessToken: foobar
```


## User-Agent è¯·æ±‚å¤´

å…¶ä¸­, `User-Agent`æ˜¯ç‰¹æ®Šçš„é€šç”¨è¯·æ±‚å¤´ï¼Œæ‰€æœ‰çš„ Forest è¯·æ±‚éƒ½ä¼šé»˜è®¤è‡ªåŠ¨åŠ ä¸Š`User-Agent: forest/{version}`è¿™æ ·çš„è¯·æ±‚å¤´ã€‚

è¯¥è¯·æ±‚å¤´æ— æ³•åˆ é™¤ï¼Œä½†å¯ä»¥ç”¨å…¶ä»–çš„å€¼æ¥è¦†ç›–



```java
// è¦†ç›–æ–¹æ³•ä¸€
request.addHeader("User-Agent", "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6)");

// è¦†ç›–æ–¹æ³•äºŒ
request.setUserAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6)");
```

è‹¥è¢«è¦†ç›–ï¼Œåˆ™`User-Agent`è¯·æ±‚å¤´çš„å€¼å°±ä¼šè‡ªå®šä¹‰çš„`User-Agent`å†…å®¹


## æ·»åŠ å»¶è¿Ÿè¯·æ±‚å¤´

å»¶è¿Ÿè¯·æ±‚å¤´å‚æ•° ï¼ˆä¹Ÿç§°ä½œ Lambda è¯·æ±‚å¤´å‚æ•°ï¼‰ï¼Œåœ¨æ‚¨éœ€è¦ä¸é©¬ä¸Šæ±‚å€¼çš„æƒ…å†µä½¿ç”¨ã€‚

æœ‰å¾ˆå¤šæƒ…å†µï¼Œè¯·æ±‚å¤´çš„å‚æ•°å€¼ä¸èƒ½é©¬ä¸Šå¾—å‡ºï¼Œè€Œæ˜¯åœ¨è¯·æ±‚å‘é€å‰çš„é‚£ä¸€åˆ»ï¼ˆæ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½åˆ°ä½æ—¶ï¼‰æ‰èƒ½å¾—å‡ºï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯åŠ ç­¾éªŒè¯çš„åœºæ™¯


`addHeader(String name, Lazy lazyValue)` æ·»åŠ Lazyç±»å‹çš„è¯·æ±‚å¤´å‚æ•°
- å‚æ•° `lazyValue`: å»¶è¿Ÿæ±‚å€¼çš„Queryå‚æ•°å€¼ï¼ˆå³ Lambdaï¼‰

```java
request.addHeader("name", req -> {
    // req ä¸ºè¯·æ±‚å¯¹è±¡
    // è¿”å›å€¼å°†ä½œä¸ºå‚æ•°å€¼æ·»åŠ åˆ° URL Query ä¸­
    return "";
});
```

åœ¨ Lambda ä»£ç å—ä¸­å¯ä»¥è°ƒç”¨`req.body().encodeToString()` å°†æ•´ä¸ªè¯·æ±‚ä½“çš„æ•°æ®åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²

```java
request.addHeader("token", req -> Base64.encode(req.body().encodeToString())) // æ·»åŠ å»¶è¿Ÿå‚æ•°
        .addBody("a", 1)
        .addBody("b", 2)
        .addBody("c", 3);
// æœ€åäº§ç”Ÿ Header å‚æ•° token: YT0xJmI9MiZjPTM=
```


## ä¿®æ”¹è¯·æ±‚å¤´

ä¿®æ”¹å’Œè¦†ç›–ä¸€ä¸ªå·²å­˜åœ¨çš„å¤´å±æ€§

```java
request.addHeader("Hello", "A") // æ·»åŠ ç¬¬ä¸€ä¸ªå¤´å±æ€§
       .addHeader("Hello", "B");    // è¦†ç›–ç¬¬ä¸€ä¸ªå¤´å±æ€§
// æœ€ç»ˆè¯·æ±‚åŒ…å«ä»¥ä¸‹å¤´å±æ€§ï¼š
// Hello: B
```

## è·å–è¯·æ±‚å¤´

> `header(String name)` æ ¹æ®è¯·æ±‚å¤´åç§°è·å–è¯·æ±‚å¤´
>- å‚æ•° `name`: è¯·æ±‚å¤´åç§°
>- è¿”å›å€¼: è¯·æ±‚å¤´ï¼ŒForestHeader ç±»å®ä¾‹
>
> `headers()` è·å–æ‰€æœ‰è¯·æ±‚å¤´
>- è¿”å›å€¼: è¯·æ±‚å¤´è¡¨, ForestHeaderMap ç±»å®ä¾‹

```java
// åˆ›å»ºæ–°çš„è¯·æ±‚å¯¹è±¡
// url: http://localhost/test
ForestRequest<?> request = Forest.get("/")
        .addHeader("Accept", "text/plain")              // æ·»åŠ ç¬¬ä¸€ä¸ªå¤´å±æ€§
        .addHeader("Content-Type", "application/json")  // æ·»åŠ ç¬¬äºŒä¸ªå¤´å±æ€§
        
// é€šè¿‡ header æ–¹æ³•å¯ä»¥æ ¹æ®å¤´å±æ€§åè·å–è¯·æ±‚å¤´å¯¹è±¡
// å¹¶è¿”å› ForestHeader ç±»çš„å¯¹è±¡        
ForestHeader header1 = request.header("Accept");        // è·å–å¤´å±æ€§ Accept
ForestHeader header2 = request.header("Content-Type");  // è·å–å¤´å±æ€§ Content-Type
// é€šè¿‡ headers æ–¹æ³•å¯ä»¥è·å–è¯¥è¯·æ±‚çš„æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯
// å¹¶è¿”å› ForestHeaderMap ç±»å¯¹è±¡
ForestHeaderMap headerMap = request.headers();          // è·å–è¯·æ±‚çš„æ‰€æœ‰è¯·æ±‚å¤´
// é€šè¿‡ headerValue æ–¹æ³•å¯ä»¥æ ¹æ®å¤´å±æ€§åè·å–è¯·æ±‚å¤´çš„å±æ€§å€¼
// å¹¶è¿”å›å±æ€§å€¼å­—ç¬¦ä¸²
String headerValue1 = request.headerValue("Accept");          // è·å–å¤´å±æ€§ Accept çš„å±æ€§å€¼
String headerValue2 = request.headerValue("Content-Type");    // è·å–å¤´å±æ€§ Accept çš„å±æ€§å€¼
```

## ç‰¹æ®Šè¯·æ±‚å¤´

Forestä¸ºä¸€äº›ç‰¹æ®Šå¤´å±æ€§å®šä¹‰ä¸“æœ‰çš„æ–¹æ³•ï¼Œä¸ç”¨åœ¨ addHeader æ–¹æ³•ä¸­ä¼ å…¥å¤´å±æ€§åäº†ï¼Œæ¯”å¦‚: Content-Type

> `contentType(String contentType)` è®¾ç½®è¯·æ±‚å¤´ Content-Type çš„å€¼
>- å‚æ•° `contentType`: è¯·æ±‚å¤´ Content-Type çš„å€¼

```java
// è®¾ç½®å¤´å±æ€§ Content-Type çš„å€¼ä¸º application/json
request.contentType("application/json");
```

Forestä¹Ÿä¸º `Content-Type` å¸¸ç”¨å±æ€§å€¼çš„è®¾ç½®æä¾›äº†å¿«æ·æ–¹æ³•

```java
// è®¾ç½®å¤´å±æ€§ Content-Type: application/x-www-form-urlencoded
request.contentFormUrlEncoded();
// è®¾ç½®å¤´å±æ€§ Content-Type: application/json
request.contentTypeJson();
// è®¾ç½®å¤´å±æ€§ Content-Type: application/xml
request.contentTypeXml();
// è®¾ç½®å¤´å±æ€§ Content-Type: multipart/form-data
request.contentTypeMultipartFormData();
// è®¾ç½®å¤´å±æ€§ Content-Type: application/octet-stream
request.contentTypeOctetStream();
```
