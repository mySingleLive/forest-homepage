---
id: sse_declarative
hide_title: true
title: ğŸ¦„ SSE äº‹ä»¶å¤„ç†æ–¹æ³•
date: 2024-12-26 12:44:20
permalink: /pages/1.7.x/sse_method/
---



## SSE äº‹ä»¶å¤„ç†æ–¹æ³•

å¯ä»¥ç›´æ¥åœ¨[è‡ªå®šä¹‰ SSE æ§åˆ¶å™¨](/pages/1.7.x/sse_handler/#è‡ªå®šä¹‰-sse-æ§åˆ¶å™¨)ä¸­æ·»åŠ  SSE çš„äº‹ä»¶æ¶ˆæ¯å¤„ç†æ–¹æ³•ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ [SSE æ‹¦æˆªå™¨](/pages/1.7.x/sse_interceptor/)ä¸­æ·»åŠ ï¼‰ï¼Œç„¶åé€šè¿‡`@SSEDataMessage`æ³¨è§£ã€`@SSEEventMessage`æ³¨è§£ã€`@SSEIdMessage`æ³¨è§£ã€`@SSERetryMessage`æ³¨è§£æ¥ä¿®é¥°è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œè€Œè¿™äº›æ–¹æ³•æ ¹æ®æ‰€æ ‡æ³¨çš„æ³¨è§£å¯ä»¥æ¥å—å’Œå¤„ç†ä¸åŒç±»å‹åç§°çš„äº‹ä»¶æ¶ˆæ¯ã€‚

å¦‚`@SSEDataMessage`æ³¨è§£ä¿®é¥°çš„æ–¹æ³•å°±èƒ½å¤„ç†åç§°ä¸º`data`çš„äº‹ä»¶æ¶ˆæ¯ï¼Œ`@SSEEventMessage`æ³¨è§£ä¿®é¥°çš„æ–¹æ³•èƒ½å¤„ç†`event`äº‹ä»¶æ¶ˆæ¯

```java
@SSEDataMessage
public void onSSEData(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º data çš„äº‹ä»¶
    // å£°æ˜çš„æ–¹æ³•åå’Œå¤„ç†çš„äº‹ä»¶æ¶ˆæ¯åç§°æ²¡æœ‰å…³ç³»ï¼Œæ–¹æ³•åå¯ä»¥æ˜¯ onDataã€onSseDataã€onMessageã€xxxã€ä»¥åŠä»»ä½•åç§°éƒ½å¯ä»¥
    // @SSEName æ³¨è§£ä¿®é¥°çš„å‚æ•° name ä¸ºäº‹ä»¶æ¶ˆæ¯åç§° (åŒ eventSource.name())
    // @SSEValue æ³¨è§£ä¿®é¥°çš„å‚æ•° value ä¸ºäº‹ä»¶æ¶ˆæ¯çš„å€¼
    eventSource.sse(); // è·å– SSE æ§åˆ¶å™¨
    eventSource.request(); // è·å– Forest è¯·æ±‚å¯¹è±¡
    eventSource.response(); // è·å– Forest å“åº”å¯¹è±¡
    eventSource.rawData(); // è·å–äº‹ä»¶æ¶ˆæ¯çš„åŸå§‹æ•°æ®
    eventSource.name(); // è·å–äº‹ä»¶æ¶ˆæ¯çš„åç§°ï¼Œå¦‚ dataã€eventã€id ç­‰
    eventSource.value(); // è·å–äº‹ä»¶æ¶ˆæ¯çš„å€¼ï¼Œè¿”å›å­—ç¬¦ä¸²ç±»å‹æ•°æ®
    // è·å–äº‹ä»¶æ¶ˆæ¯çš„å€¼ï¼Œå¹¶å°†æ¶ˆæ¯è½¬æ¢ä¸ºæŒ‡å®šçš„è‡ªå®šä¹‰ç±»å‹
    eventSource.value(MyUser.class);
    // è·å–äº‹ä»¶æ¶ˆæ¯çš„å€¼ï¼Œå¹¶å°†æ¶ˆæ¯è½¬æ¢ä¸ºæŒ‡å®šçš„è‡ªå®šä¹‰æ³›å‹ç±»å‹
    eventSource.value(new TypeReference<List<MyUser>>() {});
}

@SSEEventMessage
public void onSSEEvent(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º event çš„äº‹ä»¶
}

@SSEIdMessage
public void onSSEId(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º id çš„äº‹ä»¶
}

@SSERetryMessage
public void onSSERetry(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º retry çš„äº‹ä»¶
}
```

## SSE æ¶ˆæ¯åç§°

è¿˜å¯ä»¥ä½¿ç”¨`@SSEMessage`æ³¨è§£ä¸ºäº‹ä»¶å¤„ç†æ–¹æ³•æŒ‡å®šè¦ç›‘å¬çš„ã€éå›ºå®šçš„äº‹ä»¶æ¶ˆæ¯åç§°

```java
// ç­‰ä»·äº @SSEDataMessage æ³¨è§£
@SSEMessage("data")
public void onSSEData(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º data çš„äº‹ä»¶
    // å£°æ˜çš„æ–¹æ³•åå’Œå¤„ç†çš„äº‹ä»¶æ¶ˆæ¯åç§°æ²¡æœ‰å…³ç³»ï¼Œæ–¹æ³•åå¯ä»¥æ˜¯ onDataã€onSseDataã€onMessageã€xxxã€ä»¥åŠä»»ä½•åç§°éƒ½å¯ä»¥
    // @SSEName æ³¨è§£ä¿®é¥°çš„å‚æ•° name ä¸ºäº‹ä»¶æ¶ˆæ¯åç§° (åŒ eventSource.name())
    // @SSEValue æ³¨è§£ä¿®é¥°çš„å‚æ•° value ä¸ºäº‹ä»¶æ¶ˆæ¯çš„å€¼
}

// ç­‰ä»·äº @SSEEventMessage æ³¨è§£
@SSEMessage("event")
public void onSSEEvent(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º event çš„äº‹ä»¶
}

// ç­‰ä»·äº @SSEIdMessage æ³¨è§£
@SSEMessage("id")
public void onSSEId(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º id çš„äº‹ä»¶
}

// ç­‰ä»·äº @SSERetryMessage æ³¨è§£
@SSEMessage("retry")
public void onSSERetry(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º retry çš„äº‹ä»¶
}

// ç›‘å¬éæ ‡å‡†çš„ SSE äº‹ä»¶æ¶ˆæ¯åç§°
@SSEMessage("push")
public void onSSEPush(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º push çš„äº‹ä»¶
}

// é€šè¿‡å­—ç¬¦ä¸²æ¨¡æ¿å¼•ç”¨å˜é‡ï¼Œæ¥æŒ‡å®šè¦ç›‘å¬çš„ SSE äº‹ä»¶æ¶ˆæ¯åç§°
@SSEMessage("{sseMsgName}")
public void onSSEPush(EventSource eventSource, @SSEName String name, @SSEValue String value) {
    // è¦å¤„ç†äº‹ä»¶çš„æ¶ˆæ¯åé€šè¿‡å˜é‡{sseMsgName}æŒ‡å®š
}
```

## SSE å‚æ•°

äº‹ä»¶å¤„ç†æ–¹æ³•çš„å‚æ•°æ•°é‡ã€ä»¥åŠç±»å‹éƒ½ä¸æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå¯ä»¥æ— åºæ’åˆ—

```java
// EventSource ç±»å‹å‚æ•°
@SSEDataMessage
public void onData1(EventSource eventSource) {
    // å¤„ç†äº‹ä»¶æ¶ˆæ¯åç§°ä¸º data çš„äº‹ä»¶
    // å¯ä»¥åªæœ‰ EventSource ä¸€ä¸ªå‚æ•°
    // è€Œè¿™ä¸ªå‚æ•°ä¹Ÿä¸æ˜¯å¿…é¡»çš„
}

// æ¶ˆæ¯åç§°å’Œæ¶ˆæ¯å€¼ä½œä¸ºå‚æ•°
@SSEMessage("data")
public void onData2(@SSEName String name, @SSEValue String value) {
    // å¯ä»¥åªæœ‰ @SSEName å’Œ @SSEValue ä¿®é¥°çš„å‚æ•°
    // æ¥è·å–æ—¶é—´çš„åç§°å’Œå€¼
}

// åŒ¹é…æ¶ˆæ¯å€¼ä¸ºè‡ªå®šä¹‰ç±»å‹çš„å‚æ•°
@SSEMessage("data")
public void onData3(@SSEValue MyUser myUser) {
    // å‚æ•°å¯ä»¥æ˜¯è‡ªå®šä¹‰ç±»å‹çš„å¯¹è±¡
    // å½“äº‹ä»¶æ¶ˆæ¯çš„å€¼å¯ä»¥è¢«æ­£å¸¸ååºåˆ—åŒ–ä¸ºè‡ªå®šä¹‰ç±»å‹çš„æ—¶å€™ï¼Œè°ƒç”¨è¯¥æ–¹æ³•
    // æ¬¡å‚æ•°éœ€è¦ç”¨ @SSEValue æ³¨è§£ä¿®é¥°
}

// å°†è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°
@SSEMessage("data")
public void onData4(ForestRequest request, ForestResponse response) {
    // ä¹Ÿå¯ä»¥è·å– Forest è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡ä½œä¸ºå‚æ•°
}

// ä»»æ„æ’åˆ—ç»„åˆçš„å‚æ•°
@SSEMessage("event")
public void onEvent(ForestRequest request, @SSEValue String value, EventSource eventSource) {
    // ä¹Ÿå¯ä»¥å¯¹è¿™äº›å‚æ•°è¿›è¡Œä»»æ„çš„æ’åˆ—ç»„åˆ
}
```

## SSE äº‹ä»¶åŒ¹é…

é™¤äº† SSE äº‹ä»¶æ¶ˆæ¯åç§°ï¼Œäº‹ä»¶æ–¹æ³•è¿˜å¯ä»¥é€šè¿‡å€¼çš„å‰ç¼€ã€åç¼€ã€ä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ç­‰æ–¹å¼æ¥æ ¹æ®æ¡ä»¶åŠ¨æ€åŒ¹é…æƒ³è¦ç›‘å¬çš„ SSE äº‹ä»¶

```java
// å‰ç¼€åŒ¹é…
@SSEDataMessage(valuePrefix = "close")
public void onDataClose(EventSource eventSource, @SSEValue String value) {
    // åœ¨ç›‘å¬åˆ°åç§°ä¸º data çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å€¼èƒ½åŒ¹é…ç»™å®šå‰ç¼€"close"æ—¶æ‰ä¼šæ‰§è¡Œ
}

// åç¼€åŒ¹é…
@SSEEventMessage(valuePostfix = "open")
public void onEventOpen(EventSource eventSource, @SSEValue String value) {
    // åœ¨ç›‘å¬åˆ°åç§°ä¸º event çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å€¼èƒ½åŒ¹é…ç»™å®šåç¼€"open"æ—¶æ‰ä¼šæ‰§è¡Œ
}

// æ­£åˆ™åŒ¹é…
@SSEMessage(name = "event", valueRegex = "\\{.*name.*\\}")
public void onEvent(@SSEValue Contact contact) {
    // åœ¨ç›‘å¬åˆ°åç§°ä¸º event çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å€¼å’Œç»™å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆåŠŸåæ‰ä¼šæ‰§è¡Œ
}
```