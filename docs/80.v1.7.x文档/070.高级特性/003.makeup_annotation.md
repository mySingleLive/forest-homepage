---
id: makeup_annotation
title: ğŸ‡ ç»„åˆæ³¨è§£
date: 2022-07-01 12:44:20
permalink: /pages/1.7.x/makeup_annotation/
---

Forest é™¤äº†èƒ½ç”¨ç”Ÿå‘½å‘¨æœŸæ¥è‡ªå®šä¹‰æ³¨è§£å¤–ï¼Œä¹Ÿå…è®¸æ‚¨æŠŠå·²æœ‰çš„ Forest æ³¨è§£ç»„åˆæˆä¸€ä¸ªæ–°çš„æ³¨è§£

### ç»„åˆä¸€ä¸ªæ³¨è§£

```java
/**
 * ç”¨Forestç»„åˆæ³¨è§£å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯·æ±‚å¤´æ³¨è§£
 * æ­¤æ³¨è§£åŠ ä¸Šäº† @Headers æ³¨è§£ï¼Œå¹¶ä¸ºæ³¨è§£çš„å‚æ•°èµ‹äº†å€¼
 * é‚£ä¹ˆä»¥åä½¿ç”¨æ­¤æ³¨è§£çš„æ¥å£å’Œæ–¹æ³•ï¼Œä¼šè‡ªåŠ¨æ·»åŠ ä¸Š @Headers æ³¨è§£ä»¥åŠå®ƒçš„å‚æ•°å€¼
 */
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD, ElementType.TYPE})
// è¢«ç»„åˆçš„æ³¨è§£
@Headers({
        "Accept: text/plain",
        "Content-Type: application/json",
        // åœ¨ç»„åˆæ³¨è§£ä¸­å¯ä»¥åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­å¼•ç”¨å˜é‡
        // å®ƒä¼šä»å…¨å±€å˜é‡æˆ–æ–¹æ³•çš„å‚æ•°ä¸­è·å–å˜é‡å€¼
        "Token: ${token}"
})
public @interface MyHeaders {
}
```

ä½¿ç”¨ç»„åˆæ³¨è§£çš„æ–¹æ³•

```java
// è¯¥æ–¹æ³•ä½¿ç”¨äº†è‡ªå®šä¹‰çš„ç»„åˆæ³¨è§£ @MyHeaders
// æ‰€ä»¥è¯¥æ–¹æ³•å‘é€çš„è¯·æ±‚ä¼šè‡ªåŠ¨æ·»åŠ ä»¥ä¸‹è¯·æ±‚å¤´:
// Accept: text/plain
// Content-Type: application/json
// Token: xxx (ä»å½¢å‚ token ä¸­ä¼ å…¥çš„å€¼)
@Get("/data")
@MyHeaders
String getData(@Var("token") String token);
```

:::warning
ç»„åˆæ³¨è§£ç›®å‰æ— æ³•åœ¨å­—ç¬¦ä¸²æ¨¡æ¿ä¸­å¼•ç”¨è‡ªèº«çš„æ³¨è§£å±æ€§

å¦‚éœ€è¦å®šä¹‰å’Œè§£ææ³¨è§£çš„å±æ€§ï¼Œè¯·ä½¿ç”¨ã€Š[è‡ªå®šä¹‰æ³¨è§£](/pages/1.7.x/custom_annotation/)ã€‹
:::


### ç»„åˆå¤šä¸ªæ³¨è§£

Forest è¿˜å¯ä»¥ç»„åˆ2ä¸ªåŠ2ä¸ªä»¥ä¸Šçš„ Forest æ³¨è§£

```java
/**
 * Forest å¯ä»¥åŒæ—¶ç»„åˆå¤šä¸ªæ³¨è§£
 * å¦‚æ–¹æ³•ä½¿ç”¨è¯¥è‡ªå®šä¹‰çš„ @MySite æ³¨è§£
 * é‚£ä¹ˆå°±ç­‰åŒä½¿ç”¨è¿™é‡Œè¢«ç»„åˆçš„ @Headers æ³¨è§£å’Œ @Address æ³¨è§£
 * ä»¥åŠå®ƒä»¬çš„å‚æ•°å€¼
 */
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD, ElementType.TYPE})
// ç»„åˆç¬¬ä¸€ä¸ªæ³¨è§£
@Headers({
        "Accept: text/plain",
        "Content-Type: application/json"
})
// ç»„åˆç¬¬äºŒä¸ªæ³¨è§£
// å¯ä»¥ä»å…¨å±€å˜é‡æˆ–æ–¹æ³•å‚æ•°ä¸­è·å–å˜é‡å€¼
@Address(host = "${my-site.host}", port = "${my-site.port}")
public @interface MySite {
}
```

:::warning
å®šä¹‰ç»„åˆæ³¨è§£çš„æ—¶å€™è¦æ³¨è§£ä¸è¦ç»„åˆè‡ªèº«ï¼Œä»¥åŠç»„åˆè¿‡è‡ªèº«çš„å…¶å®ƒæ³¨è§£ï¼Œä»¥å…å¼•èµ·å¾ªç¯å¼•ç”¨
:::


### å±æ€§é‡å†™

æ³¨è§£çš„ç»„åˆå…³ç³»ï¼Œç±»ä¼¼äº Java ç±»çš„ç»§æ‰¿å…³ç³»ï¼Œç»§æ‰¿å…³ç³»ä¸­æœ‰å¤šæ€ï¼ˆæ¯”å¦‚æ–¹å¼å’Œå±æ€§çš„é‡å†™ï¼‰ï¼Œ Forest çš„ç»„åˆæ³¨è§£ä¹Ÿæœ‰ç±»ä¼¼çš„èƒ½åŠ›

ä»`v1.5.33`ç‰ˆæœ¬å¼€å§‹ï¼ŒForest æä¾›äº†`@OverrideAttribute`æ³¨è§£ï¼Œå°†è¢«è¯¥æ³¨è§£æ ‡è¯†çš„æ³¨è§£å±æ€§å®šä¹‰å¯é‡å†™çš„æ³¨è§£å±æ€§ï¼Œå®ƒå°†è¦†ç›–è¢«ç»„åˆæ³¨è§£ä¸­çš„åŒåå±æ€§å€¼

è¦é‡å†™ç»„åˆæ³¨è§£çš„å±æ€§ï¼Œè¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶:

1. æ³¨è§£å®šä¹‰æ—¶ï¼Œè¦åŠ ä¸Š`@@RequestAttributes`æ³¨è§£ï¼Œä»¥æ ‡è¯†è¯¥æ³¨è§£çš„å±æ€§å¯ä»¥è¢«è§£æ

2. å±æ€§åè¦å’Œè¢«ç»„åˆçš„æ³¨è§£ä¸­çš„å±æ€§åä¸€è‡´

3. å±æ€§å®šä¹‰ä¸Šè¦åŠ ä¸Š`@OverrideAttribute`æ³¨è§£

```java
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD, ElementType.TYPE})
// åŠ ä¸Š @RequestAttributes æ³¨è§£æ‰èƒ½è§£ææ³¨è§£ä¸­å®šä¹‰çš„å±æ€§
@RequestAttributes
// è¢«ç»„åˆçš„ @Address æ³¨è§£
@Address
public @interface MySite {
    
    // é‡å†™ @Address æ³¨è§£çš„ host å±æ€§
    @OverrideAttribute
    String host();
    
    // é‡å†™ @Address æ³¨è§£çš„ port å±æ€§
    @OverrideAttribute
    int port();
}
```

æ­¤æ—¶ï¼Œä½¿ç”¨`@MySite`ï¼Œå¹¶ä¸ºå…¶ host å±æ€§å’Œ port å±æ€§èµ‹å€¼æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨è¦†ç›–è¢«ç»„åˆçš„`@Address`æ³¨è§£çš„ host å±æ€§å’Œ port å±æ€§

```java
// ç­‰ä»·äº @Address(host = "localhost", port = 8080)
@MySite(host = "localhost", port = 8080)
public interface MyClient {
    ...
}
```
